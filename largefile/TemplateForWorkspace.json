{"$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
"contentVersion":"1.0.0.0","parameters":{
"workspaceName":{
"type":"string",
"metadata":"Workspacename",
"defaultValue":"eddydevsynapse"
},
"SqlServer_Reportcluster01_connectionString":{
"type":"secureString",
"metadata":"Securestringfor'connectionString'of'SqlServer_Reportcluster01'"
},
"SqlServer_eddyinfraag_connectionString":{
"type":"secureString",
"metadata":"Securestringfor'connectionString'of'SqlServer_eddyinfraag'"
},
"SqlServer_isdb_connectionString":{
"type":"secureString",
"metadata":"Securestringfor'connectionString'of'SqlServer_isdb'"
},
"eddydevsynapse-WorkspaceDefaultSqlServer_connectionString":{
"type":"secureString",
"metadata":"Securestringfor'connectionString'of'eddydevsynapse-WorkspaceDefaultSqlServer'"
},
"reportcluster01_Tallan_connectionString":{
"type":"secureString",
"metadata":"Securestringfor'connectionString'of'reportcluster01_Tallan'"
},
"AzureSynapseAnalytics_properties_typeProperties_connectionString_secretName":{
"type":"string",
"defaultValue":"AzureSynapseAnalytics-connectionString"
},
"Eddy_Keyvault_properties_typeProperties_baseUrl":{
"type":"string",
"defaultValue":"https://KV-EddyDevSynapse.vault.azure.net/"
},
"HTTP_SuperMetrics_properties_typeProperties_url":{
"type":"string",
"defaultValue":"@{concat('https://supermetrics.com/api/v1/getData?metrics=',linkedService().metrics,'&dimensions=',linkedService().dimensions,'&maxResults=1000000',if(equals(linkedService().settings,''),'',concat('&Settings=',linkedService().settings)),'&dateRangeType=custom&start-date=',linkedService().start_date,'&end-date=',linkedService().end_date,'&profiles=',linkedService().profiles,'&otherParams=%5B%5D&dataSource=',linkedService().datasource,'&dsUser=',linkedService().dsuser,'&apiKey=1&targetAppFormat=qlik')}"
},
"HTTP_SuperMetrics_Analytics_properties_typeProperties_url":{
"type":"string",
"defaultValue":"@{concat('https://supermetrics.com/api/v1/getData?appid=',linkedService().appid,'&metrics=',linkedService().metrics,'&dimensions=',linkedService().dimensions,'&maxResults=1000000&dateRangeType=custom&start-date=',linkedService().start_date,'&end-date=',linkedService().end_date,'&profiles=',linkedService().profiles,'&otherParams=%5B%5D&dataSource=',linkedService().datasource,'&dsUser=',linkedService().dsuser,'&apiKey=1&targetAppFormat=qlik')}"
},
"RestService_MediaAlpha_properties_typeProperties_url":{
"type":"string",
"defaultValue":"@{concat('https://education-exchange.mediaalpha.com/report.json?date_from=',linkedService().start_date,'&date_to=',linkedService().end_date,linkedService().metrics)}"
},
"SqlServer_Reportcluster01_properties_typeProperties_userName":{
"type":"string",
"defaultValue":"eddycorp\\synapsedevlinksvc"
},
"SqlServer_eddyinfraag_properties_typeProperties_userName":{
"type":"string",
"defaultValue":"eddycorp\\synapsedevlinksvc"
},
"SqlServer_isdb_properties_typeProperties_userName":{
"type":"string",
"defaultValue":"eddycorp\\synapsedevlinksvc"
},
"eddydevsynapse-WorkspaceDefaultStorage_properties_typeProperties_url":{
"type":"string",
"defaultValue":"https://eddydevlake.dfs.core.windows.net"
},
"reportcluster01_Tallan_properties_typeProperties_userName":{
"type":"string",
"defaultValue":"eddycorp\\synapsedevlinksvc"
},
"AdNetwork_AdContent_properties_AdContent_Import_parameters_sourceFileName":{
"type":"string",
"defaultValue":"@triggerBody().fileName"
},
"AdNetwork_AdContent_properties_typeProperties_scope":{
"type":"string",
"defaultValue":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Storage/storageAccounts/eddydevlake"
},
"ManagementFees_properties_typeProperties_scope":{
"type":"string",
"defaultValue":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Storage/storageAccounts/eddydevlake"
},
"PerformanceFiles_properties_MainPerformanceData_parameters_SourceFileName":{
"type":"string",
"defaultValue":"@triggerBody().fileName"
},
"PerformanceFiles_properties_typeProperties_scope":{
"type":"string",
"defaultValue":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Storage/storageAccounts/eddydevlake"
},
"TargetFiles_properties_typeProperties_scope":{
"type":"string",
"defaultValue":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Storage/storageAccounts/eddydevlake"
},
"utmtriggertest_properties_typeProperties_scope":{
"type":"string",
"defaultValue":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Storage/storageAccounts/eddydevlake"
}
},
"variables":{
"workspaceId":"[concat('Microsoft.Synapse/workspaces/',parameters('workspaceName'))]"
},
"resources":[
{
"name":"[concat(parameters('workspaceName'),'/AdContent_Import')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"AdContent_Import_StagingfromFile",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"additionalColumns":[
{
"name":"DateImported",
"value":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
}
},
{
"name":"ImportFileName",
"value":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
}
}
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings",
"skipLineCount":2
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"tableOption":"autoCreate",
"writeBehavior":"insert"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"SqlServer_isdb",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"InsertnewrecordsAdContent_Import",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"AdContent_Import_StagingfromFile",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_AdContent_Import_Merge]"
},
"linkedServiceName":{
"referenceName":"SqlServer_isdb",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
}
}
}
},
{
"name":"RemoveFile",
"type":"Delete",
"dependsOn":[
{
"activity":"InsertnewrecordsAdContent_Import",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
},
{
"name":"FailureEmailAdContent_Import_StagingfromFile",
"type":"WebActivity",
"dependsOn":[
{
"activity":"AdContent_Import_StagingfromFile",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('AdContent_Import_StagingfromFile').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailInsertnewrecordsAdContent_Import",
"type":"WebActivity",
"dependsOn":[
{
"activity":"InsertnewrecordsAdContent_Import",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('InsertnewrecordsAdContent_Import').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"concurrency":1,
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"/IG/landing/AdNetwork/AdContent_Import"
},
"sourceFileName":{
"type":"string"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"AdNetwork"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkTableName":{
"type":"string",
"defaultValue":"AdContent_Import_Staging"
}
},
"folder":{
"name":"AdNetwork"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_isdb')]",
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_isdb')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Configuration_EMS_SuperMetrics_SourceSink')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"ExecutePipeline1",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
}
],
"folder":{
"name":"David/Testing"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:17:24Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataDaily')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/CurateMappingFile')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"TabsinMappingFile",
"type":"ForEach",
"dependsOn":[
{
"activity":"TabsinCampaignUpadatexlsx",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('items')",
"type":"Expression"
},
"activities":[
{
"name":"copytoparquetfile",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":false,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"fileName":{
"value":"@variables('fileName')",
"type":"Expression"
},
"container":"datalake",
"folder":"EMS/landing/mapping"
}
}
],
"outputs":[
{
"referenceName":"DataLake_Mapping_Parquet",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"container":"datalake",
"folder":"EMS/curated/mapping"
}
}
]
}
]
}
},
{
"name":"TabsinCampaignUpadatexlsx",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('items_CU')",
"type":"Expression"
},
"activities":[
{
"name":"copyCampaignUpdatexlsxtoparquet_copy1",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":false,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"fileName":{
"value":"@variables('fileName_CU')",
"type":"Expression"
},
"container":"datalake",
"folder":"EMS/landing/mapping"
}
}
],
"outputs":[
{
"referenceName":"DataLake_Mapping_Parquet",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"container":"datalake",
"folder":"EMS/curated/mapping"
}
}
]
}
]
}
}
],
"variables":{
"items":{
"type":"Array",
"defaultValue":[
"AccountOrg"
]
},
"fileName":{
"type":"String",
"defaultValue":"dimMapping.xlsx"
},
"items_CU":{
"type":"Array",
"defaultValue":[
"CampaignUpdate"
]
},
"fileName_CU":{
"type":"String",
"defaultValue":"CampaignUpdate.xlsx"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-05-25T17:44:53Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/DataLake_Mapping_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/CurateMappingFiles')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"ForEachFile",
"description":"GetthecontainerlistfromMetadataactivityandtheniterateseachofthemtoCopyactivity.",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('items')",
"type":"Expression"
},
"batchCount":4,
"activities":[
{
"name":"CopyOneFile",
"description":"Copyeachfilefromsourcestoragestoretodestinationstore.",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":false,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Mapping_EXCEL",
"type":"DatasetReference",
"parameters":{
"sheetName":"@item()",
"fileName":{
"value":"@variables('fileName')",
"type":"Expression"
},
"container":"datalake",
"folder":"landing/mapping"
}
}
],
"outputs":[
{
"referenceName":"DataLake_Mapping_Parquet",
"type":"DatasetReference",
"parameters":{
"sheetName":"@item()",
"container":"datalake",
"folder":"curated/mapping"
}
}
]
}
]
}
}
],
"variables":{
"items":{
"type":"Array",
"defaultValue":[
"DIM_Vendor",
"DIM_Military",
"DIM_UGvGrad",
"DIM_Brand",
"DIM_SupermetricsCampaign"
]
},
"fileName":{
"type":"String",
"defaultValue":"BudgetandFeesOverview-PostandKeiser.xlsx"
}
},
"folder":{
"name":"David/Tallan"
},
"annotations":[],
"lastPublishTime":"2021-06-08T15:15:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Mapping_EXCEL')]",
"[concat(variables('workspaceId'),'/datasets/DataLake_Mapping_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DimDate')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Copydataautocreatetable",
"type":"Copy",
"dependsOn":[
{
"activity":"Copydatatablealreadyexixts",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":";withcte_Datesas\n(\n\tselectcast('2020-01-01'asdatetime)DateValue\nunionall\nselectDateValue+1\nfromcte_Dates\nwhereDateValue+1<'1/1/2050'--CAST(GETDATE()ASDATE)\n)\n\nselect\t--cast(concat(year(DateValue),right(concat(0,month(DateValue)),2),right(concat(0,day(DateValue)),2))asint)asDateKey\n\t\tcast(format(DateValue,'yyyMMdd')asint)asDateDimID\n\t\t,cast(DateValueasdate)asActualDate\n\n\t\t,year(DateValue)asCalendarYear\n\n\t\t,datepart(quarter,DateValue)asQuarter\n\t\t--,dateadd(quarter,datediff(quarter,0,DateValue),0)asFirstDayOfQuarter\n\t\t--,min(DateValue)over(partitionbyyear(DateValue),datepart(quarter,DateValue))asFirstDayOfQuarter\n\t\t--,dateadd(day,-1,dateadd(quarter,datediff(quarter,0,DateValue)+1,0))\n\t\t--,max(DateValue)over(partitionbyyear(DateValue),datepart(quarter,DateValue))asLastDayOfQuarter\n\t\t,convert(varchar(6),casedatepart(quarter,DateValue)when1then'First'\n\t\t\t\t\t\t\t\t\t\twhen2then'Second'\n\t\t\t\t\t\t\t\t\t\t\twhen3then'Third'\n\t\t\t\t\t\t\t\t\t\t\twhen4then'Fourth'\n\t\t\t\t\t\t\t\t\t\t\tend)asQuarterName\n\n\t\t,concat(year(DateValue),right(concat(0,month(DateValue)),2))asMonthKey\n\t\t,datename(month,DateValue)asMonthName\n\t\t,datepart(month,DateValue)asMonthNumber\n\t\t,datename(month,DateValue)+'-'+cast(year(DateValue)asvarchar)asMonthYearDateLabel\n\t\t,dateadd(month,datediff(month,0,DateValue),0)FirstDayOfMonth\n\t\t,cast(eomonth(DateValue)asdatetime)asLastDayOfMOnth\n\n\t\t,dateadd(day,-(datepart(weekday,DateValue)-1),DateValue)asFirstDayOfWeek\n\t\t,dateadd(day,7-(datepart(weekday,DateValue)),DateValue)asLastDayOfWeek\n\t\t,datepart(week,DateValue)-datepart(week,dateadd(month,datediff(month,0,DateValue),0))+1asWeekOfMonth\n\t\t,DATEPART(week,DateValue)asWeekOfYear\n\t\t\t\t\n\t\t,day(DateValue)asDay\n\t\t,datepart(dw,DateValue)asDayOfWeekValue\n\t\t,datename(weekday,DateValue)asDayOfWeekName\n\t\t,datename(dayofyear,DateValue)asDayOfYear\n\n\t\t,casewhendatepart(dw,DateValue)in(1,7)then1else0endasIsWeekend\n\t\t,DATEADD(DAY,CASE(DATEPART(WEEKDAY,DateValue)+@@DATEFIRST)%7\n\t\t\t\t\t\tWHEN1THEN-2\n\t\t\t\t\t\tWHEN2THEN-3\n\t\t\t\t\t\tELSE-1\n\t\t\t\t\t\tEND,DATEDIFF(DAY,0,DateValue))asPreviousBusinessDay\n\t\t,dateadd(day,-7,DateValue)asSameDayLastWeek\n\t\t,dateadd(day,-28,DateValue)asSameDayLast28Days\n\n\t\t\n\ninto#DateTemp\nfromcte_Dates\n--whereday(DateValue)=1--onlythefirstofeverymonth\n\norderbycast(DateValueasdate)desc\n\noption(maxrecursion0)\n\n\nselect\t-1asDateDimID\n\t\t,'1900-01-01'asActualDate\n\t\t,-1asCalendarYear\n\t\t,-1asQuarter\n\t\t,'na'asQuarterName\n\t\t,-1asMonthKey\n\t\t,'na'asMonthName\n\t\t,-1asMonthNumber\n\t\t,'na'asMonthYearDateLabel\n\t\t,'1900-01-0100:00:00.000'FirstDayOfMonth\n\t\t,'1900-01-0100:00:00.000'asLastDayOfMOnth\n\t\t,'1900-01-0100:00:00.000'asFirstDayOfWeek\n\t\t,'1900-01-0100:00:00.000'asLastDayOfWeek\n\t\t,-1asWeekOfMonth\n\t\t,-1asWeekOfYear\n\t\t,-1asDay\n\t\t,-1asDayOfWeekValue\n\t\t,'na'asDayOfWeekName\n\t\t,-1asDayOfYear\n\n\t\t,-1asIsWeekend\n\t\t,'1900-01-0100:00:00.000'asPreviousBusinessDay\n\t\t,'1900-01-0100:00:00.000'asSameDayLastWeek\n\t\t,'1900-01-0100:00:00.000'asSameDayLast28Days\n--intodbo.DimDate\n\t\t\nunion\n\nselect*from#DateTemporderby1\n\ndroptable#DateTemp",
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"SqlDWSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"allowPolyBase":true,
"polyBaseSettings":{
"rejectValue":0,
"rejectType":"value",
"useTypeDefault":true
},
"tableOption":"autoCreate",
"disableMetricsCollection":false
},
"enableStaging":true,
"stagingSettings":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sourceDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"AzureSynapseAnalytics",
"type":"DatasetReference",
"parameters":{
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"Copydatatablealreadyexixts",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":";withcte_Datesas\n(\n\tselectcast('2020-01-01'asdatetime)DateValue\nunionall\nselectDateValue+1\nfromcte_Dates\nwhereDateValue+1<'1/1/2050'--CAST(GETDATE()ASDATE)\n)\n\nselect\t--cast(concat(year(DateValue),right(concat(0,month(DateValue)),2),right(concat(0,day(DateValue)),2))asint)asDateKey\n\t\tcast(format(DateValue,'yyyMMdd')asint)asDateDimID\n\t\t,cast(DateValueasdate)asActualDate\n\n\t\t,year(DateValue)asCalendarYear\n\n\t\t,datepart(quarter,DateValue)asQuarter\n\t\t--,dateadd(quarter,datediff(quarter,0,DateValue),0)asFirstDayOfQuarter\n\t\t--,min(DateValue)over(partitionbyyear(DateValue),datepart(quarter,DateValue))asFirstDayOfQuarter\n\t\t--,dateadd(day,-1,dateadd(quarter,datediff(quarter,0,DateValue)+1,0))\n\t\t--,max(DateValue)over(partitionbyyear(DateValue),datepart(quarter,DateValue))asLastDayOfQuarter\n\t\t,convert(varchar(6),casedatepart(quarter,DateValue)when1then'First'\n\t\t\t\t\t\t\t\t\t\twhen2then'Second'\n\t\t\t\t\t\t\t\t\t\t\twhen3then'Third'\n\t\t\t\t\t\t\t\t\t\t\twhen4then'Fourth'\n\t\t\t\t\t\t\t\t\t\t\tend)asQuarterName\n\n\t\t,concat(year(DateValue),right(concat(0,month(DateValue)),2))asMonthKey\n\t\t,datename(month,DateValue)asMonthName\n\t\t,datepart(month,DateValue)asMonthNumber\n\t\t,datename(month,DateValue)+'-'+cast(year(DateValue)asvarchar)asMonthYearDateLabel\n\t\t,dateadd(month,datediff(month,0,DateValue),0)FirstDayOfMonth\n\t\t,cast(eomonth(DateValue)asdatetime)asLastDayOfMOnth\n\n\t\t,dateadd(day,-(datepart(weekday,DateValue)-1),DateValue)asFirstDayOfWeek\n\t\t,dateadd(day,7-(datepart(weekday,DateValue)),DateValue)asLastDayOfWeek\n\t\t,datepart(week,DateValue)-datepart(week,dateadd(month,datediff(month,0,DateValue),0))+1asWeekOfMonth\n\t\t,DATEPART(week,DateValue)asWeekOfYear\n\t\t\t\t\n\t\t,day(DateValue)asDay\n\t\t,datepart(dw,DateValue)asDayOfWeekValue\n\t\t,datename(weekday,DateValue)asDayOfWeekName\n\t\t,datename(dayofyear,DateValue)asDayOfYear\n\n\t\t,casewhendatepart(dw,DateValue)in(1,7)then1else0endasIsWeekend\n\t\t,DATEADD(DAY,CASE(DATEPART(WEEKDAY,DateValue)+@@DATEFIRST)%7\n\t\t\t\t\t\tWHEN1THEN-2\n\t\t\t\t\t\tWHEN2THEN-3\n\t\t\t\t\t\tELSE-1\n\t\t\t\t\t\tEND,DATEDIFF(DAY,0,DateValue))asPreviousBusinessDay\n\t\t,dateadd(day,-7,DateValue)asSameDayLastWeek\n\t\t,dateadd(day,-28,DateValue)asSameDayLast28Days\n\n\t\t\n\ninto#DateTemp\nfromcte_Dates\n--whereday(DateValue)=1--onlythefirstofeverymonth\n\norderbycast(DateValueasdate)desc\n\noption(maxrecursion0)\n\n\nselect\t-1asDateDimID\n\t\t,'1900-01-01'asActualDate\n\t\t,-1asCalendarYear\n\t\t,-1asQuarter\n\t\t,'na'asQuarterName\n\t\t,-1asMonthKey\n\t\t,'na'asMonthName\n\t\t,-1asMonthNumber\n\t\t,'na'asMonthYearDateLabel\n\t\t,'1900-01-0100:00:00.000'FirstDayOfMonth\n\t\t,'1900-01-0100:00:00.000'asLastDayOfMOnth\n\t\t,'1900-01-0100:00:00.000'asFirstDayOfWeek\n\t\t,'1900-01-0100:00:00.000'asLastDayOfWeek\n\t\t,-1asWeekOfMonth\n\t\t,-1asWeekOfYear\n\t\t,-1asDay\n\t\t,-1asDayOfWeekValue\n\t\t,'na'asDayOfWeekName\n\t\t,-1asDayOfYear\n\n\t\t,-1asIsWeekend\n\t\t,'1900-01-0100:00:00.000'asPreviousBusinessDay\n\t\t,'1900-01-0100:00:00.000'asSameDayLastWeek\n\t\t,'1900-01-0100:00:00.000'asSameDayLast28Days\n--intodbo.DimDate\n\t\t\nunion\n\nselect*from#DateTemporderby1\n\ndroptable#DateTemp",
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"SqlDWSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"allowPolyBase":true,
"polyBaseSettings":{
"rejectValue":0,
"rejectType":"value",
"useTypeDefault":true
},
"disableMetricsCollection":false
},
"enableStaging":true,
"stagingSettings":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sourceDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"AzureSynapseAnalytics",
"type":"DatasetReference",
"parameters":{
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sourceDataBaseName":{
"type":"string",
"defaultValue":"Staging"
},
"sinkTableName":{
"type":"string",
"defaultValue":"Date"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dim"
}
},
"folder":{
"name":"DataWarehouseDimensions"
},
"annotations":[],
"lastPublishTime":"2021-06-11T14:40:49Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/AzureSynapseAnalytics')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/EmailExamples')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"ExecutePipelineMediaAlphaDimensions",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MediaAlphaDimensions",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"ExecutePipelineMediaAlphaFacts",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"ExecutePipelineMediaAlphaDimensions",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MediaAlphaFacts",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"ExecutePipelineMediaAlphaDimensions",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":substring(@{activity('ExecutePipelineMediaAlphaDimensions').error.Message},\"\\\"},\n\"color\":\"Red\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmail_copy1",
"type":"WebActivity",
"dependsOn":[
{
"activity":"ExecutePipelineMediaAlphaFacts",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":substring(@{activity('ExecutePipelineMediaAlphaFacts').error.Message},\"\\\"},\n\"color\":\"Red\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
},
{
"name":"emailSuccess",
"type":"WebActivity",
"dependsOn":[
{
"activity":"ExecutePipelineMediaAlphaFacts",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunSuccess\",\n\"message\":\"Successexecution\",\n\"color\":\"Green\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"David/Testing"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:39:57Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MediaAlphaDimensions')]",
"[concat(variables('workspaceId'),'/pipelines/MediaAlphaFacts')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/EmailExtract')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"EmailExtractGoogleAnalytics",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":\"error\",\n\"color\":\"Green\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/FLDNCUpdate')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"NewPhoneNumber",
"type":"ForEach",
"dependsOn":[
{
"activity":"GetNewDNCPhoneNumbers",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('GetNewDNCPhoneNumbers').output.value",
"type":"Expression"
},
"activities":[
{
"name":"Storedprocedure1",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[ACTIVE].[ACTIVE.Performance_ScrubReport]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"reporting"
}
}
}
]
}
},
{
"name":"GetNewDNCPhoneNumbers",
"type":"Lookup",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":"exec[isdb.eddyprod.local].ContactCenter.dbo.usp_FL_DNC_Update",
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"dataset":{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Reporting",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
}
}
],
"folder":{
"name":"DoNotCall"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Factstest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"df_Clicks",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"df_Facts",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"ClciksRef":{},
"dimCampaign":{},
"dimDate":{},
"factClicks":{},
"InsertNew":{},
"Update":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"SendEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"df_Clicks",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":\"@{activity('df_Clicks').error.message}\",\n\"color\":\"Green\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:16:48Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/df_Facts')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/GetFileNameIfExistsTestdatalake_cdv')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@toLower('')",
"type":"Expression"
}
}
},
"fieldList":[
"childItems"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"ForEach1",
"type":"ForEach",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('IsFilePresent').output.childitems",
"type":"Expression"
},
"activities":[
{
"name":"SourceFixFile",
"type":"Delete",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@item().name",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
}
]
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\utm"
},
"FileName":{
"type":"string"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/GetFileNameIfExistsTestnewdataset')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"IfExistsGetFileName_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
}
}
},
"fieldList":[
"childItems"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"ForEach1",
"type":"ForEach",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('IsFilePresent').output.childitems",
"type":"Expression"
},
"activities":[
{
"name":"SourceFixFile",
"type":"Delete",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@string(item().name)",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
}
]
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\utm"
},
"FileName":{
"type":"string"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/IfExistsGetFileName_csv')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/GetFileNamesforLoopRetrievePerformaceData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"ConvertxlsxtocsvOneFileallhardcoded",
"type":"Copy",
"dependsOn":[
{
"activity":"PerformanceFiles",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":"ImportData",
"fileName":"SampleEUPerformanceUploadTemplate6.12.2021.xlsx",
"container":"datalake",
"folder":"EMS/landing/performance"
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":"datalake",
"Directory":"EMS/raw/performance",
"File":"PerformanceImportData.csv"
}
}
]
},
{
"name":"PerformanceFiles",
"type":"ForEach",
"dependsOn":[
{
"activity":"GetFileNamesForLoop",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('GetFileNamesForLoop').output.childitems",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"Convertxlsxtocsv",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
},
"fileName":{
"value":"@item().name",
"type":"Expression"
},
"container":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"folder":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sinkDirectory",
"type":"Expression"
},
"File":{
"value":"@replace(item().name,'xlsx','csv')",
"type":"Expression"
}
}
}
]
}
]
}
},
{
"name":"GetFileNamesForLoop",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"Excel_GetFileNamesPerformance",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
},
"SheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
}
}
},
"fieldList":[
"childItems"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
},
{
"name":"ConvertxlsxtocsvOneFilewildcardpath",
"type":"Copy",
"dependsOn":[
{
"activity":"ConvertxlsxtocsvOneFileallhardcoded",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"wildcardFolderPath":"EMS/landing/performance",
"wildcardFileName":"*.xlsx",
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":"ImportData",
"fileName":"test",
"container":"datalake",
"folder":"EMS/landing/performance"
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":"datalake",
"Directory":"EMS/raw/performance",
"File":"PerformanceImportData2.csv"
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"EMS/landing/performance"
},
"sourceSheetName":{
"type":"string",
"defaultValue":"ImportData"
},
"sinkDirectory":{
"type":"string",
"defaultValue":"EMS/raw/performance"
}
},
"folder":{
"name":"David"
},
"annotations":[],
"lastPublishTime":"2021-06-16T15:56:37Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/Excel_GetFileNamesPerformance')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/GetContentsOfFolder')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Copydata1",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlDWSink",
"allowCopyCommand":true,
"copyCommandSettings":{}
},
"enableStaging":false
},
"inputs":[
{
"referenceName":"CoreWebVitals",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"AzureSynapseAnalytics",
"type":"DatasetReference",
"parameters":{
"TableName":"davetest",
"TableSchema":"dbo"
}
}
]
}
],
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/CoreWebVitals')]",
"[concat(variables('workspaceId'),'/datasets/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IGMainDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainRetrieveIGCostSuperMetricsDaily",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainRetrieveIGCostSuperMetricsDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"MainProcessIGCostSuperMetrics",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainRetrieveIGCostSuperMetricsDaily",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainProcessIGCostSuperMetrics",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataFacebookIG",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainRetrieveIGCostSuperMetricsDaily",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainRetrieveIGCostSuperMetricsDaily').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainProcessIGCostSuperMetrics",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainProcessIGCostSuperMetrics",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainProcessIGCostSuperMetrics').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"RetrieveMediaAlphaRevenueIGDaily",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainProcessIGCostSuperMetrics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveMediaAlphaRevenueIGDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailRetrieveMediaAlphaRevenueIGDaily",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveMediaAlphaRevenueIGDaily",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveMediaAlphaRevenueIGDaily').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"IG/Marketing"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainRetrieveIGCostSuperMetricsDaily')]",
"[concat(variables('workspaceId'),'/pipelines/MainProcessIGCostSuperMetrics')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveMediaAlphaRevenueIGDaily')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IGMainNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainRetrieveIGCostSuperMetricsNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainRetrieveIGCostSuperMetricsNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"MainProcessIGCostSuperMetrics",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainRetrieveIGCostSuperMetricsNightly",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainProcessIGCostSuperMetrics",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataFacebookIG",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainRetrieveIGCostSuperMetricsNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainRetrieveIGCostSuperMetricsNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainProcessIGCostSuperMetrics",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainProcessIGCostSuperMetrics",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainProcessIGCostSuperMetrics').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"RetrieveMediaAlphaRevenueIGNightly",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainProcessIGCostSuperMetrics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveMediaAlphaRevenueIGNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailRetrieveMediaAlphaRevenueIGNightly",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveMediaAlphaRevenueIGNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveMediaAlphaRevenueIGNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"IG/Marketing"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainRetrieveIGCostSuperMetricsNightly')]",
"[concat(variables('workspaceId'),'/pipelines/MainProcessIGCostSuperMetrics')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveMediaAlphaRevenueIGNightly')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IfFileExistsTest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailFile",
"type":"WebActivity",
"dependsOn":[
{
"activity":"IfCondition1",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"Complete\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
},
"fieldList":[
"exists"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"IfCondition1",
"type":"IfCondition",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"expression":{
"value":"@activity('IsFilePresent').output.exists",
"type":"Expression"
},
"ifFalseActivities":[
{
"name":"FailureEmailFile_copy1",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"False\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"ifTrueActivities":[
{
"name":"FailureEmailSM",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"True\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
]
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\mapping"
},
"FileName":{
"type":"string",
"defaultValue":"2InquiryUTMFix.csv"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IfFileExistsTest_KM')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailFile",
"type":"WebActivity",
"dependsOn":[
{
"activity":"IfCondition1",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"Complete\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
},
"fieldList":[
"exists"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"IfCondition1",
"type":"IfCondition",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"expression":{
"value":"@activity('IsFilePresent').output.exists",
"type":"Expression"
},
"ifFalseActivities":[
{
"name":"FailureEmailFile_copy1",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"False\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"ifTrueActivities":[
{
"name":"FailureEmailSM",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"True\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
]
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\mapping"
},
"FileName":{
"type":"string",
"defaultValue":"2InquiryUTMFix.csv"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"Kalpana"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IfConditionTest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"IfCondition",
"type":"IfCondition",
"dependsOn":[
{
"activity":"TimeOfDay",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"expression":{
"value":"@bool(variables('Nightly'))",
"type":"Expression"
},
"ifFalseActivities":[
{
"name":"FalseEmail",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"False\",\n\"message\":\"False\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"ifTrueActivities":[
{
"name":"TrueEmail",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"True\",\n\"message\":\"True\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
]
}
},
{
"name":"TimeOfDay",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"Nightly",
"value":"1"
}
}
],
"variables":{
"Nightly":{
"type":"String"
}
},
"folder":{
"name":"David/Testing"
},
"annotations":[],
"lastPublishTime":"2021-06-11T14:52:47Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainAdNetwork')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"AdContent_Import",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"AdContent_Import",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":"datalake",
"sourceDirectory":"/IG/landing/AdNetwork/AdContent_Import",
"sourceFileName":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
},
"sinkDataBaseName":"AdNetwork",
"sinkTableSchema":"dbo",
"sinkTableName":"AdContent_Import_Staging"
}
}
},
{
"name":"FailureEmailMainAdContent_Import",
"type":"WebActivity",
"dependsOn":[
{
"activity":"AdContent_Import",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('AdContent_Import').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"parameters":{
"sourceFileName":{
"type":"string"
}
},
"folder":{
"name":"AdNetwork"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/AdContent_Import')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainDimensions')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"dimCampaign",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"dimCampaign",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\dim\\campaign",
"FileName":"dimcampaign.parquet",
"SourceQuery":"SELECTC.CampaignId,c.CampaignName,c.TrackId,sch.SubChannelId,sch.SubChannelName,sch.SubChannelDescription,ch.ChannelId,ch.ChannelName,ch.ChannelDescription,\nV.VendorId,V.VendorName,V.VendorDescription,A.ApplicationId,A.ApplicationName,mu.MarketingUnitId,mu.NameASMarketingUnitName,cc.FirstName+''+cc.LastNameASCampaignCoordinator,\nCOALESCE(vpp.PortalProfileGuid,CAST('00000000-0000-0000-0000-000000000000'asuniqueidentifier))ASPortalProfileGuid\nfromNexus.dbo.Campaignc\nleftouterjoinNexus.dbo.SubChannelsch\nonsch.SubChannelID=c.SubChannelID\nleftouterjoinNexus.dbo.Channelch\nonch.ChannelID=sch.ChannelID\nleftouterjoinNexus.dbo.Vendorv\nonv.VendorID=c.VendorID\nleftouterjoinNexus.dbo.[Application]a\nona.ApplicationID=c.ApplicationID\nleftouterjoinNexus.dbo.MarketingUnitmu\nonmu.MarketingUnitID=c.MarketingUnitID\nLEFTouterjoinNexus.dbo.Userscc\noncc.UserID=c.CampaignCoordinatorID\nLeftOuterJoinStaging.nx.PortalClientRelationship_Vendorvpp--Addingnewcolumn'VendorPortalProfileGuid'toCampaignDimension\nonc.VendorId=vpp.VendorId"
}
}
},
{
"name":"dimClientRelationship",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"dimClientRelationship",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\dim\\clientrelationship",
"FileName":"dimclientrelationship.parquet",
"SourceQuery":"Selectcr.ClientRelationshipID,ISNULL(i.InstitutionID,0)ASInstitutionID,\nLTRIM(RTRIM(ISNULL(i.Name,'unknown')))InstitutionName,\nISNULL(iit.InstitutionIncorporationTypeID,0)ASInstitutionIncorporationTypeID,COALESCE(NULLIF(LTRIM(RTRIM(iit.TypeDescription)),''),'unknown')ASInstitutionIncorporationTypeName,\nLTRIM(RTRIM(ISNULL(c.ClientName,'unknown')))ASClientName,\nISNULL(am.UserID,0)ASAccountManagerID,COALESCE(NULLIF(LTRIM(RTRIM(LTRIM(RTRIM(ISNULL(am.FirstName,'')))+''+LTRIM(RTRIM(ISNULL(am.LastName,''))))),''),'unknown')ASAccountManagerName,\nCOALESCE(NULLIF(LTRIM(RTRIM(am.Email)),''),'unknown')ASAccountManagerEmailAddress,\nISNULL(ac.UserID,0)ASAccountCooridatorID,COALESCE(NULLIF(LTRIM(RTRIM(LTRIM(RTRIM(ISNULL(ac.FirstName,'')))+''+LTRIM(RTRIM(ISNULL(ac.LastName,''))))),''),'unknown')ASAccountCooridatorName,\nCOALESCE(NULLIF(LTRIM(RTRIM(ac.Email)),''),'unknown')ASAccountCooridatorEmailAddress\nfromNexus.dbo.ClientRelationshipcr\nleftouterjoinNexus.dbo.Institutioni\noni.InstitutionID=cr.InstitutionID\nleftouterjoinNexus.dbo.Usersam\nonam.UserID=cr.AccountManagerID\nleftouterjoinNexus.dbo.Usersac\nonac.UserID=cr.AccountCoordinatorID\nleftouterjoinNexus.dbo.BillingCyclebc\nonbc.BillingCycleID=cr.BillingCycleID\nleftouterjoinNexus.dbo.AccreditationOrgao\nonao.AccreditationID=i.AccreditationTypeID\nleftouterjoinNexus.dbo.InstitutionIncorporationTypeiit\noniit.InstitutionIncorporationTypeID=i.InstitutionIncorporationTypeID\nleftouterjoinNexus.dbo.Clientc\nonc.ClientID=cr.ClientID\nWHEREcr.IsEnabled=1\n"
}
}
},
{
"name":"dimProduct",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"dimProduct",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\dim\\product",
"FileName":"dimproduct.parquet",
"SourceQuery":"SELECTProductId,ProductName,ProductDescription\nFROMnexus.dbo.Productp(nolock)"
}
}
},
{
"name":"dimRealtimeDeliveryStatus",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"dimRealtimeDeliveryStatus",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\dim\\realtimedeliverystatus",
"FileName":"dimrealtimedeliverystatus.parquet",
"SourceQuery":"selectr.RealTimeDeliveryStatusIDas[RealTimeDeliveryStatusID],\n\tISNULL(NULLIF(LTRIM(RTRIM(r.RealTimeDeliveryStatusName)),''),'NaN')as[RealTimeDeliveryStatusName],\n\tISNULL(r.CountAgainstCap,0)as[RealTimeDeliveryStatusCountAgainstCap],\n\tISNULL(r.IsEnabled,0)as[RealTimeDeliveryStatusIsActive],\n\tISNULL(rt.RealTimeDeliveryStatusTypeID,0)as[RealTimeDeliveryStatusTypeId],\n\tISNULL(NULLIF(LTRIM(RTRIM(rt.RealTimeDeliveryStatusTypeName)),''),'NaN')as[RealTimeDeliveryStatusTypeName],\n\tISNULL(NULLIF(LTRIM(RTRIM(rt.RealTimeDeliveryStatusTypeDescription)),''),'NaN')as[RealTimeDeliveryStatusTypeDescription],\n\tISNULL(rt.IsEnabled,0)as[RealTimeDeliveryStatusTypeIsActive]\nfromNexus.dbo.RealtimeDeliveryStatusr(nolock)\nleftouterjoinNexus.dbo.RealtimeDeliveryStatusTypert(nolock)onrt.RealtimeDeliveryStatusTypeID=r.RealtimeDeliveryStatusType"
}
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
}
},
"folder":{
"name":"IG/Dimensions"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/dimCampaign')]",
"[concat(variables('workspaceId'),'/pipelines/dimClientRelationship')]",
"[concat(variables('workspaceId'),'/pipelines/dimProduct')]",
"[concat(variables('workspaceId'),'/pipelines/dimRealtimeDeliveryStatus')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSCreateExternalTables')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Re-CreateExternalTableSpend",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_CreateExternalTable_Spend_Daily]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"Re-CreateExternalTableInquiry",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_CreateExternalTable_Inquiry_Daily]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"TruncateandLoadEMSInquiry",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_LoadEMSInquiry]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainEMSRetrievePopulateDimsFacts",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainEMSRetrieveStageCurateDaily",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainEMSPopulateDimsFactsDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"MainEMSRetrieveStageCurateDaily",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainEMSRetrieveStageCurateDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailMainEMSRetrievePopulateDimsFacts",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainEMSRetrievePopulateDimsFacts",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainEMSRetrievePopulateDimsFacts').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainEMSRetrieveStageCurate",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainEMSRetrieveStageCurateDaily",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainEMSRetrieveStageCurateDaily').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainEMSPopulateDimsFactsDaily')]",
"[concat(variables('workspaceId'),'/pipelines/MainEMSRetrieveStageCurateDaily')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainEMSRetrieveStageCurateNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainEMSRetrieveStageCurateNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailMainEMSPopulateDimsFacts",
"type":"WebActivity",
"dependsOn":[
{
"activity":"EMSPopulateMainNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('EMSPopulateMainNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainEMSRetrieveStageCurate",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainEMSRetrieveStageCurateNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainEMSRetrieveStageCurateNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"MainEMSCreateExternalTables",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"MainEMSRetrieveStageCurateNightly",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainEMSCreateExternalTables",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailMainEMSCreateExternalTables",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainEMSCreateExternalTables",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainEMSCreateExternalTables').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"EMSPopulateMainNightly",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"MainEMSCreateExternalTables",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[EMS].[PopulateMainNightly]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainEMSRetrieveStageCurateNightly')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/MainEMSCreateExternalTables')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSPopulateDimsFactsDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailPopulateDimEMS",
"type":"WebActivity",
"dependsOn":[
{
"activity":"PopulateDimEMS",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('PopulateDimEMS').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailPopulateSpendFactsEMS",
"type":"WebActivity",
"dependsOn":[
{
"activity":"PopulateSpendFactsEMS",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('PopulateSpendFactsEMS').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"PopulateDimEMS",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dim].[PopulateDimEMS]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"PopulateSpendFactsEMS",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"PopulateDimEMS",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[PopulataSpendFactsEMS]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSPopulateDimsFactsNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailPopulateDimEMS",
"type":"WebActivity",
"dependsOn":[
{
"activity":"PopulateDimEMS",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('PopulateDimEMS').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailPopulateSpendFactsEMS",
"type":"WebActivity",
"dependsOn":[
{
"activity":"PopulateSpendFactsEMS",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('PopulateSpendFactsEMS').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"PopulateDimEMS",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dim].[PopulateDimEMS]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"PopulateSpendFactsEMS",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"PopulateDimEMS",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[PopulataSpendFactsEMS_ALL]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSRetrieveStageCurateDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainSuperMetricsDaily",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainSuperMetricsDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"MainInquiryDaily",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainInquiryDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailMainSMDaily",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainSuperMetricsDaily",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainSuperMetricsDaily').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainInquiryDaily",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainInquiryDaily",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainInquiryDaily').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainSuperMetricsDaily')]",
"[concat(variables('workspaceId'),'/pipelines/MainInquiryDaily')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainEMSRetrieveStageCurateNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MainSuperMetricsNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainSuperMetricsNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"MainInquiryNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"MainInquiryNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailMainSMNightly",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainSuperMetricsNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainSuperMetricsNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMainInquiryNightly",
"type":"WebActivity",
"dependsOn":[
{
"activity":"MainInquiryNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('MainInquiryNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainSuperMetricsNightly')]",
"[concat(variables('workspaceId'),'/pipelines/MainInquiryNightly')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainExternalInquiries')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageandCurateExternalInquires",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateExternalInquires",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailStageandCurateExternalInquires",
"type":"WebActivity",
"dependsOn":[
{
"activity":"StageandCurateExternalInquires",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('StageandCurateExternalInquires').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/StageandCurateExternalInquires')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainFacts')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"factLead",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"factLead",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\fact\\lead",
"FileName":"factlead.parquet",
"SourceQuery":"SELECTL.Leadid,L.CreatedDate_EST,L.TrackId,L.ClientRelationshipId,L.ProductID,L.RealtimeDeliveryStatusId,CASEWHENr.CountAgainstCap=1THEN1ELSE0ENDASsuccessleads,CASEWHENr.CountAgainstCap=0THEN1ELSE0ENDASfailedleads,1ASTotalLeadsFROMNexus.dbo.LeadLJOINNexus.dbo.RealtimeDeliveryStatusrONL.RealtimeDeliveryStatusId=R.RealTimeDeliveryStatusIdWHEREL.CreatedDate_EST>='1/1/2021'"
}
}
},
{
"name":"factPerformance",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"factPerformance",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"IG\\raw\\fact\\lead",
"FileName":"factlead.parquet",
"SourceQuery":"SELECTL.Leadid,L.CreatedDate_EST,L.TrackId,L.ClientRelationshipId,L.ProductID,L.RealtimeDeliveryStatusId,CASEWHENr.CountAgainstCap=1THEN1ELSE0ENDASsuccessleads,CASEWHENr.CountAgainstCap=0THEN1ELSE0ENDASfailedleads,1ASTotalLeadsFROMNexus.dbo.LeadLJOINNexus.dbo.RealtimeDeliveryStatusrONL.RealtimeDeliveryStatusId=R.RealTimeDeliveryStatusIdWHEREL.CreatedDate_EST>='1/1/2021'"
}
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
}
},
"folder":{
"name":"IG/Facts"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/factLead')]",
"[concat(variables('workspaceId'),'/pipelines/factPerformance')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainInquiryDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveInquiryData",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryDataDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"process_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
}
}
}
},
{
"name":"StageandCurateInquiry",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrieveInquiryData",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateInquiry",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"Setvariable1_copy1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"@variables('EmailBody')",
"type":"Expression"
}
}
},
{
"name":"Setvariable1_copy1",
"type":"SetVariable",
"dependsOn":[
{
"activity":"RetrieveInquiryData",
"dependencyConditions":[
"Failed"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"EmailBody",
"value":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveInquiryData').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmail_copy1",
"type":"WebActivity",
"dependsOn":[
{
"activity":"StageandCurateInquiry",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('StageandCurateInquiry').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:16:18Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryDataDaily')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCurateInquiry')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainInquiryNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveInquiryDataNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryDataNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"process_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
}
}
}
},
{
"name":"StageandCurateInquiryNightly",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrieveInquiryDataNightly",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateInquiryNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"Setvariable1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"@variables('EmailBody')",
"type":"Expression"
}
}
},
{
"name":"FailureEmail_copy1",
"type":"WebActivity",
"dependsOn":[
{
"activity":"StageandCurateInquiryNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('StageandCurateInquiryNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"Setvariable1",
"type":"SetVariable",
"dependsOn":[
{
"activity":"RetrieveInquiryDataNightly",
"dependencyConditions":[
"Failed"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"EmailBody",
"value":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveInquiryDataNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-09T13:50:01Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryDataNightly')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCurateInquiryNightly')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainManagementFees')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageandCurateManagementFees",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateManagementFees",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"EMSPopulateManagementFees",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"StageandCurateManagementFees",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[EMS].[Populate_ManagementFees]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"FailureEmailStageandCurateManagementFees",
"type":"WebActivity",
"dependsOn":[
{
"activity":"StageandCurateManagementFees",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('StageandCurateManagementFees').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailEMSPopulateManagementFees",
"type":"WebActivity",
"dependsOn":[
{
"activity":"EMSPopulateManagementFees",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('EMSPopulateManagementFees').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/StageandCurateManagementFees')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainPerformanceData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrievePerformanceData",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrievePerformaceData",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"FileSystem":"datalake",
"sourceDirectory":"EMS/landing/performance",
"sourceSheetName":"ImportData",
"sinkDirectory":"EMS/raw/performance",
"sourceFileName":{
"value":"@pipeline().parameters.SourceFileName",
"type":"Expression"
}
}
}
},
{
"name":"StageandCuratePerformanceData",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrievePerformanceData",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCuratePerformanceData",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmailStageandCuratePerformanceData",
"type":"WebActivity",
"dependsOn":[
{
"activity":"StageandCuratePerformanceData",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('StageandCuratePerformanceData').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailRetrievePerformanceData",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrievePerformanceData",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrievePerformanceData').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"concurrency":1,
"parameters":{
"SourceFileName":{
"type":"string"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:39:46Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrievePerformaceData')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCuratePerformanceData')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainProcessIGCostSuperMetrics')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"dimURLParameters",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dim].[uspProcessURLParametersRevCost]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"EddyCost",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"dimURLParameters",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[uspPopulateIGCost]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"FailureEmaildimURLParameters",
"type":"WebActivity",
"dependsOn":[
{
"activity":"dimURLParameters",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('dimURLParameters').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailEddyCost",
"type":"WebActivity",
"dependsOn":[
{
"activity":"EddyCost",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('EddyCost').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T20:47:30Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainRetrieveIGCostSuperMetricsDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveSuperMetricsDataFacebookIG",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataFacebookIGDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsFacebook",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"RetrieveSuperMetricsDataGoogleIG",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataGoogleIGDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsGoogle",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"RetrieveSuperMetricsDataMicrosoftIG",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataMicrosoftIGDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsMicrosoft",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataFacebookIG",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataFacebookIG",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataFacebookIG').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataGoogleIG",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataGoogleIG",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataGoogleIG').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataMicrosoftIG",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataMicrosoftIG",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataMicrosoftIG').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T20:47:30Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataFacebookIGDaily')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataGoogleIGDaily')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataMicrosoftIGDaily')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainRetrieveIGCostSuperMetricsNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveSuperMetricsDataFacebookIGNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataFacebookIGNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsFacebook",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"RetrieveSuperMetricsDataGoogleIGNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataGoogleIGNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsGoogle",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"RetrieveSuperMetricsDataMicrosoftIGNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataMicrosoftIGNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"SuperMetricsMicrosoft",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Staging"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataFacebookIGN",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataFacebookIGNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataFacebookIGNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataGoogleIGNite",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataGoogleIGNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataGoogleIGNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailRetrieveSuperMetricsDataMicrosoftIGN",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataMicrosoftIGNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataMicrosoftIGNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T20:47:50Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataFacebookIGNightly')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataGoogleIGNightly')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataMicrosoftIGNightly')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainSuperMetricsDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveSuperMetricsData",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"process_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
},
"lookback":"0"
}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"SpendSuperMetricsandnotSMNotebookStagingCurated",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsData').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"SpendSuperMetricsandnotSMNotebookStagingCurated",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsData",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateSpendSuperMetricsandNonSMDaily",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmail_copy1",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsData",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsData').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:19:46Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataDaily')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCurateSpendSuperMetricsandNonSMDaily')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainSuperMetricsNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveSuperMetricsDataNightly",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsDataNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"process_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
},
"lookback":"0",
"days_back":"-3"
}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"CurateandSpendSuperMetriclandNonSMNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('CurateandSpendSuperMetriclandNonSMNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"CurateandSpendSuperMetriclandNonSMNightly",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataNightly",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateSpendSuperMetricsandNonSMNightly",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
},
{
"name":"FailureEmail_copy1",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsDataNightly",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveSuperMetricsDataNightly').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-14T17:06:35Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsDataNightly')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCurateSpendSuperMetricsandNonSMNightly')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainSupermetricsAnalyticData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveSuperMetricsAnalyticData",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveSuperMetricsAnalyticData",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"process_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
},
"lookback":"0",
"days_back":"-10"
}
}
},
{
"name":"StageandCurateSuperMetricsAnalytics",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"RetrieveSuperMetricsAnalyticData",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateSuperMetricsAnalytics",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveSuperMetricsAnalyticData')]",
"[concat(variables('workspaceId'),'/pipelines/StageandCurateSuperMetricsAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainUTMFixDatav1')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailSM",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromSMtoDL",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveInquiryUTMFixDataFromSMtoDL').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailFile",
"type":"WebActivity",
"dependsOn":[
{
"activity":"IfCondition1",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveInquiryUTMFixDataFromFile').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
},
"fieldList":[
"exists"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"IfCondition1",
"type":"IfCondition",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromSMtoDL",
"dependencyConditions":[
"Completed"
]
}
],
"userProperties":[],
"typeProperties":{
"expression":{
"value":"@activity('IsFilePresent').output.exists",
"type":"Expression"
},
"ifTrueActivities":[
{
"name":"RetrieveInquiryUTMFixDataFromFile",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryUTMFixDataFromFile",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"InquiryUTMFix",
"sinkDataBaseName":"Tallan",
"sinkTableSchema":"dbo",
"sourceFileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"sourceDirectory":"EMS\\landing\\utm",
"sourceFile":"InquiryUTMFix.csv"
}
}
},
{
"name":"SourceFixFile",
"type":"Delete",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromFile",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
}
]
}
},
{
"name":"RetrieveInquiryUTMFixDataFromSMtoDL",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryUTMFixDataFromSuperMetricstoDataLake",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"InquiryUTMFixSM",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Tallan",
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"EMS/raw/supermetrics/utmfixdata",
"FileName":"UTMDataFixFromSM.csv",
"FilteredFileName":"UTMDataFixFiltered.csv"
}
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\utm"
},
"FileName":{
"type":"string",
"defaultValue":"InquiryUTMFix.csv"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryUTMFixDataFromSuperMetricstoDataLake')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryUTMFixDataFromFile')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MainUTMFixData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmailSM",
"type":"WebActivity",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromSMtoDL",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('RetrieveInquiryUTMFixDataFromSMtoDL').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailFile",
"type":"WebActivity",
"dependsOn":[
{
"activity":"FileName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('FileName').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"RetrieveInquiryUTMFixDataFromSMtoDL",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryUTMFixDataFromSuperMetricstoDataLake",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"InquiryUTMFixSM",
"sinkTableSchema":"dbo",
"sinkDataBaseName":"Tallan",
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":"EMS/raw/supermetrics/utmfixdata",
"FileName":"UTMDataFixFromSM.csv",
"FilteredFileName":"UTMDataFixFiltered.csv"
}
}
},
{
"name":"IsFilePresent",
"type":"GetMetadata",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromSMtoDL",
"dependencyConditions":[
"Completed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@toLower('')",
"type":"Expression"
}
}
},
"fieldList":[
"childItems"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
}
},
{
"name":"FileName",
"type":"ForEach",
"dependsOn":[
{
"activity":"IsFilePresent",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('IsFilePresent').output.childitems",
"type":"Expression"
},
"activities":[
{
"name":"SourceFixFile",
"type":"Delete",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromFile",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@item().name",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
},
{
"name":"RetrieveInquiryUTMFixDataFromFile",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveInquiryUTMFixDataFromFile",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"sinkTableName":"InquiryUTMFix",
"sinkDataBaseName":"Tallan",
"sinkTableSchema":"dbo",
"sourceFileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"sourceDirectory":"EMS\\landing\\utm",
"sourceFile":{
"value":"@item().name",
"type":"Expression"
}
}
}
}
]
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS\\landing\\utm"
},
"FileName":{
"type":"string"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryUTMFixDataFromSuperMetricstoDataLake')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/pipelines/RetrieveInquiryUTMFixDataFromFile')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlphaDimensions')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DFClientRelatoinship",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"df_CampaignType1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"DF_DimClientRelationship",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"DimClientRelationship":{},
"MaxKey":{},
"StgClientRelatoinship":{},
"sink1":{},
"sink5":{},
"sink7":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"df_CampaignType1",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"Dataflow1",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"dimCampaign":{},
"StagngCampaign":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:16:56Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/DF_DimClientRelationship')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]",
"[concat(variables('workspaceId'),'/dataflows/Dataflow1')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlphaFacts')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DFMediaAlphaLeads",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"DFMediaAlphaClicks",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"MediaAlpha_Leads",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"SRCStagingMediaAlphaLeads":{},
"SRCDimClientRelationship":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"DFMediaAlphaClicks",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"MediaAlpha_Clicks",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"StagingMediaAlphaClicks":{},
"DimCampaign":{},
"FactMediaAlphaClicks":{},
"sink1":{},
"sink2":{},
"sink3":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:39:27Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/MediaAlpha_Leads')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]",
"[concat(variables('workspaceId'),'/dataflows/MediaAlpha_Clicks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlpha')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DFClientRelatoinship",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"df_CampaignType1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"DF_DimClientRelationship",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"DimClientRelationship":{},
"MaxKey":{},
"StgClientRelatoinship":{},
"sink1":{},
"sink5":{},
"sink7":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"DFMediaAlphaLeads",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"DFMediaAlphaClicks",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"MediaAlpha_Leads",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"SRCStagingMediaAlphaLeads":{},
"SRCDimClientRelationship":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"DFMediaAlphaClicks",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"DFClientRelatoinship",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"MediaAlpha_Clicks",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"StagingMediaAlphaClicks":{},
"DimCampaign":{},
"FactMediaAlphaClicks":{},
"sink1":{},
"sink2":{},
"sink3":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"df_CampaignType1",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"Dataflow1",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"dimCampaign":{},
"StagngCampaign":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:39:20Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/DF_DimClientRelationship')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]",
"[concat(variables('workspaceId'),'/dataflows/MediaAlpha_Leads')]",
"[concat(variables('workspaceId'),'/dataflows/MediaAlpha_Clicks')]",
"[concat(variables('workspaceId'),'/dataflows/Dataflow1')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlpha_copy1')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DFMediaAlphaClicks",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"MediaAlpha_Clicks",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"StagingMediaAlphaClicks":{},
"DimCampaign":{},
"FactMediaAlphaClicks":{},
"sink1":{},
"sink2":{},
"sink3":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:39:25Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/MediaAlpha_Clicks')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MoveNonSuperMetricstoRaw')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"TabsinNSMFile",
"type":"ForEach",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('items')",
"type":"Expression"
},
"activities":[
{
"name":"copytocsvfile",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":false,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"fileName":{
"value":"@variables('fileName')",
"type":"Expression"
},
"container":"datalake",
"folder":"EMS/landing/NotSM"
}
}
],
"outputs":[
{
"referenceName":"DataLake_NonSuperMetrics_CSV",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@item()",
"type":"Expression"
},
"container":"datalake",
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/nonsupermetrics/',variables('folderName'))",
"type":"Expression"
}
}
}
]
}
]
}
},
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"FailureEmailMoveNonSuperMetricstoRaw",
"type":"WebActivity",
"dependsOn":[
{
"activity":"TabsinNSMFile",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('TabsinNSMFile').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-05-01"
},
"lookback":{
"type":"int",
"defaultValue":0
}
},
"variables":{
"items":{
"type":"Array",
"defaultValue":[
"NonSupermetricsTemplate"
]
},
"fileName":{
"type":"String",
"defaultValue":"NotSuperMatrix.xlsx"
},
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:44:33Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/DataLake_NonSuperMetrics_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/NotificationEmailTest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Setvariable1_copy1",
"type":"SetVariable",
"dependsOn":[
{
"activity":"sp1",
"dependencyConditions":[
"Failed"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"EmailBody",
"value":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('sp1').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"Setvariable1_copy1_copy1",
"type":"SetVariable",
"dependsOn":[
{
"activity":"sp2",
"dependencyConditions":[
"Failed"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"EmailBody",
"value":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('sp2').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"sp1",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[aaa_djs_test]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"Staging"
}
}
},
{
"name":"sp2",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"sp1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"aaazzz"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"Staging"
}
}
},
{
"name":"ExecutePipeline1",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"Setvariable1_copy1_copy1",
"dependencyConditions":[
"Succeeded"
]
},
{
"activity":"Setvariable1_copy1",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"NotificationEmail",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"EmailBody":{
"value":"@variables('EmailBody')",
"type":"Expression"
}
}
}
},
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"ExecutePipeline1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"@variables('EmailBody')",
"type":"Expression"
}
}
}
],
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/pipelines/NotificationEmail')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/NotificationEmail')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FailureEmail",
"type":"WebActivity",
"dependsOn":[
{
"activity":"Setvariable1",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"@variables('EmailBody')",
"type":"Expression"
}
}
},
{
"name":"Setvariable1",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"EmailBody",
"value":{
"value":"@pipeline().parameters.EmailBody",
"type":"Expression"
}
}
}
],
"parameters":{
"EmailBody":{
"type":"string"
}
},
"variables":{
"EmailBody":{
"type":"String"
}
},
"folder":{
"name":"Templates"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/PipelineKM')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Copydata1",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false
},
"inputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":"x",
"Directory":"x",
"File":"x"
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":"x",
"Directory":"x",
"File":"x"
}
}
]
}
],
"folder":{
"name":"Kalpana"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RebuildIndexesandUpdateStats')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"usp_UpdateStats",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"usp_RebuildIndexes",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_UpdateStats]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"usp_RebuildIndexes",
"type":"SqlServerStoredProcedure",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_RebuildIndexes]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"FailureEmailusp_RebuildIndexes",
"type":"WebActivity",
"dependsOn":[
{
"activity":"usp_RebuildIndexes",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('usp_RebuildIndexes').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
},
{
"name":"FailureEmailusp_UpdateStats",
"type":"WebActivity",
"dependsOn":[
{
"activity":"usp_UpdateStats",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('usp_UpdateStats').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"DataWarehouseMaintenance"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]",
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveDailySmData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyGoogleDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost_usd%2CBounceRate_perc%2CAverageposition%2CAvailableImpressions%2CConversionsmanyperclick",
"dimensions":"Date%2CAccountname%2CCampaignname%2CfinalURL",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%226504080945%22%2C%22name%22%3A%22Post%20University%22%7D%2C%7B%22ID%22%3A%227226334139%22%2C%22name%22%3A%22PSM%20-%20Keiser%20Culinary%22%7D%2C%7B%22ID%22%3A%224467487353%22%2C%22name%22%3A%22PSM%20-%20Keiser%20University%20New%22%7D%5D",
"datasource":"AW",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('raw/supermetrics/input/google/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyFacebookDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"reach%2Cimpressions%2Ccost_usd%2Clink_clicks%2Clike%2Ccomment%2Cpost_like%2Cpost%2Coffsite_conversion%2Coffsite_conversions_fb_pixel_lead",
"dimensions":"account_name%2CDate%2Ccampaign_group_name%2CdestinationURL",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22act_251599306218603%22%2C%22name%22%3A%22EMS%20-%20Post%20University%22%7D%2C%7B%22ID%22%3A%22act_244959023382239%22%2C%22name%22%3A%22EMS%20Keiser%20University%22%7D%5D",
"datasource":"FA",
"dsuser":"10157271394203579"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('raw/supermetrics/input/facebook/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyMicrosoftDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CConversions%2CAvailableImpressions%2CSpend_usd%2CAveragePosition%2CQualityScore%2CImpressionShares",
"dimensions":"Date%2CCampaignName%2CAccountName",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22867307%22%2C%22name%22%3A%22PSM_Post%20University%22%7D%2C%7B%22ID%22%3A%221239338%22%2C%22name%22%3A%22PSM_Keiser%20eCampus%22%7D%2C%7B%22ID%22%3A%22655070%22%2C%22name%22%3A%22PSM_Keiser%20Culinary%22%7D%2C%7B%22ID%22%3A%22136472%22%2C%22name%22%3A%22PSM_Keiser%20University%22%7D%2C%7B%22ID%22%3A%222658174%22%2C%22name%22%3A%22PSM_Keiser%20University%20New%22%7D%2C%7B%22ID%22%3A%221223838%22%2C%22name%22%3A%22PSM_Keiser%20University%20Brand%22%7D%2C%7B%22ID%22%3A%22957063%22%2C%22name%22%3A%22PSM_Keiser%20University%20-%20Graduate%22%7D%5D",
"datasource":"AC",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('raw/supermetrics/input/microsoft/',variables('folderName'))",
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-02-01"
},
"lookback":{
"type":"int",
"defaultValue":0
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"David/Tallan"
},
"annotations":[],
"lastPublishTime":"2021-06-11T17:10:46Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Spend_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryDataDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(pipeline().parameters.process_date,'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopySQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryDatawith(nolock)whereCreatedDate>=''',pipeline().parameters.process_date,'''andCreatedDate<dateadd(day,1,''',pipeline().parameters.process_date,''')')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/inquiry/input/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-05-05"
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"ddd"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:04:48Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Tallan')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Inquires_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryDataInitial')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(pipeline().parameters.process_date,'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopySQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryDatawith(nolock)whereCreatedDate>=dateadd(day,-143,''',pipeline().parameters.process_date,''')andCreatedDate<dateadd(day,1,''',pipeline().parameters.process_date,''')')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/inquiry/input/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"StageInquiry",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"CopySQLInquiryDatatoDatalake",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/Production/StageInquiry",
"baseParameters":{
"EnableArchive":"True"
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CurateInquiry",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StageInquiry",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/Production/CurateInquiry"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-05-05"
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"ddd"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-05-24T14:18:13Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Tallan')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Inquires_Parquet')]",
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryDataNightly_Dev')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(pipeline().parameters.process_date,'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopySQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryData_devwith(nolock)whereCreatedDate>=dateadd(day,-87,''',pipeline().parameters.process_date,''')andCreatedDate<dateadd(day,1,''',pipeline().parameters.process_date,''')')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/inquiry/input/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-06-10"
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"ddd"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-10T20:14:58Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Tallan')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Inquires_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryDataNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(pipeline().parameters.process_date,'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopySQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryDatawith(nolock)whereCreatedDate>=dateadd(day,-30,''',pipeline().parameters.process_date,''')andCreatedDate<dateadd(day,1,''',pipeline().parameters.process_date,''')')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/inquiry/input/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-06-10"
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"ddd"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-10T20:14:58Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Tallan')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Inquires_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(pipeline().parameters.process_date,'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyKeiserSQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryDatawith(nolock)whereOrganizationId=9171andCreatedDate>=','''',formatDateTime(adddays(utcnow(),-1),'yyyy-MM-dd'),'''')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('raw/inquiry/input/keiser/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyPostSQLInquiryDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@concat('select*fromdbo.InquiryDatawith(nolock)whereOrganizationId=9151andCreatedDate>=''',pipeline().parameters.process_date,'''andCreatedDate<dateadd(day,1,''',pipeline().parameters.process_date,''')')",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"Tallan",
"type":"DatasetReference",
"parameters":{}
}
],
"outputs":[
{
"referenceName":"Datalake_Inquires_Parquet",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('raw/inquiry/input/post/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-04-10"
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"ddd"
}
},
"folder":{
"name":"David/Tallan"
},
"annotations":[],
"lastPublishTime":"2021-06-08T15:15:37Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Tallan')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Inquires_Parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryUTMFixDataFromFile')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"InquiryUTMFixDatatoSQLServer",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"tableOption":"autoCreate"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.sourceFileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.sourceFile",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"usp_InquiryUTMDataFix_File",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"InquiryUTMFixDatatoSQLServer",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_InquiryUTMFix_File]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
}
}
}
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"InquiryUTMFix"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Tallan"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sourceFileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"EMS\\landing\\utm"
},
"sourceFile":{
"type":"string",
"defaultValue":"Geneva_9.1.21_UTM.csv"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-11T16:51:26Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryUTMFixDataFromSuperMetricstoDataLake')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveInquiryUTMFixDataFromSM",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"uniquepageviews",
"dimensions":"Campaign%2CPagePath%2CsourceMedium%2CdeviceCategory%2CchannelGroup%2CKeyword%2CadMatchType%2CBrowser",
"start_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-1),'yyyy-MM-dd')}",
"type":"Expression"
},
"end_date":{
"value":"@{formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')}",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20VIEWS%22%7D%5D",
"datasource":"GA",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
},
{
"name":"ImportFixDatatoSQLServer",
"type":"Copy",
"dependsOn":[
{
"activity":"Checkforleads",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"tableOption":"autoCreate"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FilteredFileName",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"Checkforleads",
"type":"ExecuteDataFlow",
"dependsOn":[
{
"activity":"RetrieveInquiryUTMFixDataFromSM",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"1.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"CheckForLeads",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"source1":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
},
"sink1":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"FileName":{
"value":"@pipeline().parameters.FilteredFileName",
"type":"Expression"
}
}
}
},
"staging":{},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
},
{
"name":"usp_InquiryUTMDataFix_SM",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"ImportFixDatatoSQLServer",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[usp_InquiryUTMFix_SM]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
}
}
}
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"InquiryUTMFixSM"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Tallan"
},
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"EMS/raw/supermetrics/utmfixdata"
},
"FileName":{
"type":"string",
"defaultValue":"UTMDataFixFromSM.csv"
},
"FilteredFileName":{
"type":"string",
"defaultValue":"UTMDataFixFiltered.csv"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-15T13:37:04Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/dataflows/CheckForLeads')]",
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveInquiryUTMFixDataFromSuperMetrics')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"RetrieveInquiryUTMFixDataFromSM",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"tableOption":"autoCreate"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"uniquepageviews",
"dimensions":"Campaign%2CPagePath%2CsourceMedium%2CdeviceCategory%2CchannelGroup%2CKeyword%2CadMatchType%2CBrowser",
"start_date":"2021-06-01",
"end_date":"2021-06-02",
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20VIEWS%22%7D%5D",
"datasource":"GA",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"InquiryUTMFixSM"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Tallan"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-11T19:22:38Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveMediaAlphaRevenueIGDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"uspProcessMedaiAlphaPlacement",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"MediaAlphaClickstoStaging",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dim].[uspProcessMedaiAlphaPlacement]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"MediaAlphaClickstoStaging",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"RestSource",
"httpRequestTimeout":"00:01:40",
"requestInterval":"00.00:00:00.010",
"requestMethod":"GET"
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"mappings":[
{
"source":{
"path":"['Sub2']"
},
"sink":{
"name":"Sub2",
"type":"String"
}
},
{
"source":{
"path":"['Searches']"
},
"sink":{
"name":"Searches",
"type":"Int64"
}
},
{
"source":{
"path":"['Publisher']"
},
"sink":{
"name":"Publisher",
"type":"String"
}
},
{
"source":{
"path":"['Affiliate']"
},
"sink":{
"name":"Affiliate",
"type":"String"
}
},
{
"source":{
"path":"['Sub1']"
},
"sink":{
"name":"Sub1",
"type":"String"
}
},
{
"source":{
"path":"['Revenue']"
},
"sink":{
"name":"Revenue",
"type":"Double"
}
},
{
"source":{
"path":"['Clicks']"
},
"sink":{
"name":"Clicks",
"type":"Int64"
}
},
{
"source":{
"path":"['Sub3']"
},
"sink":{
"name":"Sub3",
"type":"String"
}
},
{
"source":{
"path":"['MediaCost']"
},
"sink":{
"name":"MediaCost",
"type":"Double"
}
},
{
"source":{
"path":"['Uniques']"
},
"sink":{
"name":"Uniques",
"type":"Int64"
}
},
{
"source":{
"path":"['Date']"
},
"sink":{
"name":"Date",
"type":"String"
}
},
{
"source":{
"path":"['Imprs']"
},
"sink":{
"name":"Imprs",
"type":"Int64"
}
},
{
"source":{
"path":"['Placement']"
},
"sink":{
"name":"Placement",
"type":"String"
}
}
],
"collectionReference":"$['rows']"
}
},
"inputs":[
{
"referenceName":"RestService_MediaAlpha",
"type":"DatasetReference",
"parameters":{
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-dd')",
"type":"Expression"
},
"metrics":";a-TVnfCwJRRrEQBxLqfwfa3T4iXe2IsqLotELYDuKDooSu0d3RNziqUzS4pIgMyFiSqlEcqe-7xWAVDJeJhAZ3lvlGdpGcrBrc-Ocl-Y0jby5_1Nlhmc4fYTYMLmXcV244bsedzb_WKlax5ZdsQdC_BZZJ_CvSSpr9KIKVmsDDLIZU-WQ55b_ZzgXx0xp8KiHyW-8m2SRz6UjtSYL-Z1lU_KquIBnrhrLBx9XjLcR3-mvdoaprLtFLC7ChcQeTw0B3gYFoAtIpXK7lKxJl7JbRbgA-eDUBSlYNvXUUKYjW-tvvhf_fowjM8Y4h0zkr2hXac6axS0Z-JdhheYqsqdteAlzBFd1Q"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":"dbo"
}
}
]
},
{
"name":"FactEddyRevenue",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"uspProcessMedaiAlphaPlacement",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[uspPopulateIGRevenue]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"uspPopulateVisitsClicks",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"FactEddyRevenue",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[uspPopulateRevCostVisitsSubmissions]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"MediaAlphaRevenueTracker"
}
},
"folder":{
"name":"IG/Marketing/Revenue"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:48:38Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/RestService_MediaAlpha')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveMediaAlphaRevenueIGNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"uspProcessMedaiAlphaPlacement",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"MediaAlphaClickstoStaging16-30",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dim].[uspProcessMedaiAlphaPlacement]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"MediaAlphaClickstoStaging16-30",
"type":"Copy",
"dependsOn":[
{
"activity":"MediaAlphaClickstoStaging1-15",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"RestSource",
"httpRequestTimeout":"00:01:40",
"requestInterval":"00.00:00:00.010",
"requestMethod":"GET"
},
"sink":{
"type":"SqlServerSink",
"writeBehavior":"insert"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"mappings":[
{
"source":{
"path":"['Sub2']"
},
"sink":{
"name":"Sub2",
"type":"String"
}
},
{
"source":{
"path":"['Searches']"
},
"sink":{
"name":"Searches",
"type":"Int64"
}
},
{
"source":{
"path":"['Publisher']"
},
"sink":{
"name":"Publisher",
"type":"String"
}
},
{
"source":{
"path":"['Affiliate']"
},
"sink":{
"name":"Affiliate",
"type":"String"
}
},
{
"source":{
"path":"['Sub1']"
},
"sink":{
"name":"Sub1",
"type":"String"
}
},
{
"source":{
"path":"['Revenue']"
},
"sink":{
"name":"Revenue",
"type":"Double"
}
},
{
"source":{
"path":"['Clicks']"
},
"sink":{
"name":"Clicks",
"type":"Int64"
}
},
{
"source":{
"path":"['Sub3']"
},
"sink":{
"name":"Sub3",
"type":"String"
}
},
{
"source":{
"path":"['MediaCost']"
},
"sink":{
"name":"MediaCost",
"type":"Double"
}
},
{
"source":{
"path":"['Uniques']"
},
"sink":{
"name":"Uniques",
"type":"Int64"
}
},
{
"source":{
"path":"['Date']"
},
"sink":{
"name":"Date",
"type":"String"
}
},
{
"source":{
"path":"['Imprs']"
},
"sink":{
"name":"Imprs",
"type":"Int64"
}
},
{
"source":{
"path":"['Placement']"
},
"sink":{
"name":"Placement",
"type":"String"
}
}
],
"collectionReference":"$['rows']"
}
},
"inputs":[
{
"referenceName":"RestService_MediaAlpha",
"type":"DatasetReference",
"parameters":{
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-16),'yyyy-MM-dd')",
"type":"Expression"
},
"metrics":";a-TVnfCwJRRrEQBxLqfwfa3T4iXe2IsqLotELYDuKDooSu0d3RNziqUzS4pIgMyFiSqlEcqe-7xWAVDJeJhAZ3lvlGdpGcrBrc-Ocl-Y0jby5_1Nlhmc4fYTYMLmXcV244bsedzb_WKlax5ZdsQdC_BZZJ_CvSSpr9KIKVmsDDLIZU-WQ55b_ZzgXx0xp8KiHyW-8m2SRz6UjtSYL-Z1lU_KquIBnrhrLBx9XjLcR3-mvdoaprLtFLC7ChcQeTw0B3gYFoAtIpXK7lKxJl7JbRbgA-eDUBSlYNvXUUKYjW-tvvhf_fowjM8Y4h0zkr2hXac6axS0Z-JdhheYqsqdteAlzBFd1Q"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":"dbo"
}
}
]
},
{
"name":"FactEddyRevenue",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"uspProcessMedaiAlphaPlacement",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[uspPopulateIGRevenue]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"uspPopulateVisitsClicks",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"FactEddyRevenue",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[uspPopulateRevCostVisitsSubmissions]"
},
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":"DW"
}
}
},
{
"name":"MediaAlphaClickstoStaging1-15",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"RestSource",
"httpRequestTimeout":"00:01:40",
"requestInterval":"00.00:00:00.010",
"requestMethod":"GET"
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"writeBehavior":"insert"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"mappings":[
{
"source":{
"path":"['Sub2']"
},
"sink":{
"name":"Sub2",
"type":"String"
}
},
{
"source":{
"path":"['Searches']"
},
"sink":{
"name":"Searches",
"type":"Int64"
}
},
{
"source":{
"path":"['Publisher']"
},
"sink":{
"name":"Publisher",
"type":"String"
}
},
{
"source":{
"path":"['Affiliate']"
},
"sink":{
"name":"Affiliate",
"type":"String"
}
},
{
"source":{
"path":"['Sub1']"
},
"sink":{
"name":"Sub1",
"type":"String"
}
},
{
"source":{
"path":"['Revenue']"
},
"sink":{
"name":"Revenue",
"type":"Double"
}
},
{
"source":{
"path":"['Clicks']"
},
"sink":{
"name":"Clicks",
"type":"Int64"
}
},
{
"source":{
"path":"['Sub3']"
},
"sink":{
"name":"Sub3",
"type":"String"
}
},
{
"source":{
"path":"['MediaCost']"
},
"sink":{
"name":"MediaCost",
"type":"Double"
}
},
{
"source":{
"path":"['Uniques']"
},
"sink":{
"name":"Uniques",
"type":"Int64"
}
},
{
"source":{
"path":"['Date']"
},
"sink":{
"name":"Date",
"type":"String"
}
},
{
"source":{
"path":"['Imprs']"
},
"sink":{
"name":"Imprs",
"type":"Int64"
}
},
{
"source":{
"path":"['Placement']"
},
"sink":{
"name":"Placement",
"type":"String"
}
}
],
"collectionReference":"$['rows']"
}
},
"inputs":[
{
"referenceName":"RestService_MediaAlpha",
"type":"DatasetReference",
"parameters":{
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-15),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"metrics":";a-TVnfCwJRRrEQBxLqfwfa3T4iXe2IsqLotELYDuKDooSu0d3RNziqUzS4pIgMyFiSqlEcqe-7xWAVDJeJhAZ3lvlGdpGcrBrc-Ocl-Y0jby5_1Nlhmc4fYTYMLmXcV244bsedzb_WKlax5ZdsQdC_BZZJ_CvSSpr9KIKVmsDDLIZU-WQ55b_ZzgXx0xp8KiHyW-8m2SRz6UjtSYL-Z1lU_KquIBnrhrLBx9XjLcR3-mvdoaprLtFLC7ChcQeTw0B3gYFoAtIpXK7lKxJl7JbRbgA-eDUBSlYNvXUUKYjW-tvvhf_fowjM8Y4h0zkr2hXac6axS0Z-JdhheYqsqdteAlzBFd1Q"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":"dbo"
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"MediaAlphaRevenueTracker"
}
},
"folder":{
"name":"IG/Marketing/Revenue"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:46:33Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/RestService_MediaAlpha')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrievePerformaceDataMetadataLoop')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"PerformanceFiles",
"type":"ForEach",
"dependsOn":[
{
"activity":"GetFileNamesForLoop",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@activity('GetFileNamesForLoop').output.childitems",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"Convertxlsxtocsv",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
},
"fileName":{
"value":"@item().name",
"type":"Expression"
},
"container":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"folder":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sinkDirectory",
"type":"Expression"
},
"File":{
"value":"@replace(item().name,'xlsx','csv')",
"type":"Expression"
}
}
}
]
}
]
}
},
{
"name":"GetFileNamesForLoop",
"type":"GetMetadata",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"Excel_GetFileNamesPerformance",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
},
"SheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
}
}
},
"fieldList":[
"childItems"
],
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"EMS/landing/performance"
},
"sourceSheetName":{
"type":"string",
"defaultValue":"ImportData"
},
"sinkDirectory":{
"type":"string",
"defaultValue":"EMS/raw/performance"
}
},
"folder":{
"name":"David"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:31:40Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/Excel_GetFileNamesPerformance')]",
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrievePerformaceDataTriggerParameterTest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Convertxlsxtocsv_copy1",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
},
"fileName":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
},
"container":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"folder":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sinkDirectory",
"type":"Expression"
},
"File":{
"value":"@replace(pipeline().parameters.sourceFileName,'xlsx','csv')",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"EMS/landing/performance"
},
"sourceSheetName":{
"type":"string",
"defaultValue":"ImportData"
},
"sinkDirectory":{
"type":"string",
"defaultValue":"EMS/raw/performance"
},
"sourceFileName":{
"type":"string"
}
},
"folder":{
"name":"David"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:31:40Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrievePerformaceData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Convertxlsxtocsv",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"ExcelSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
},
"fileName":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
},
"container":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"folder":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.sinkDirectory",
"type":"Expression"
},
"File":{
"value":"@replace(pipeline().parameters.sourceFileName,'xlsx','csv')",
"type":"Expression"
}
}
}
]
},
{
"name":"RemoveLandingFiles",
"type":"Delete",
"dependsOn":[
{
"activity":"Convertxlsxtocsv",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataset":{
"referenceName":"MappingExcel",
"type":"DatasetReference",
"parameters":{
"sheetName":{
"value":"@pipeline().parameters.sourceSheetName",
"type":"Expression"
},
"fileName":{
"value":"@pipeline().parameters.sourceFileName",
"type":"Expression"
},
"container":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"folder":{
"value":"@pipeline().parameters.sourceDirectory",
"type":"Expression"
}
}
},
"enableLogging":false,
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
}
}
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"sourceDirectory":{
"type":"string",
"defaultValue":"EMS/landing/performance"
},
"sourceSheetName":{
"type":"string",
"defaultValue":"ImportData"
},
"sinkDirectory":{
"type":"string",
"defaultValue":"EMS/raw/performance"
},
"sourceFileName":{
"type":"string"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:31:40Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/MappingExcel')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSMData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"ForEach1",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('items')",
"type":"Expression"
},
"activities":[
{
"name":"ExecuteRetrieveDailySMPipeline",
"type":"ExecutePipeline",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"RetrieveDailySmData",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{
"lookback":{
"value":"@item()",
"type":"Expression"
}
}
}
}
]
}
}
],
"variables":{
"items":{
"type":"Array",
"defaultValue":[
"0",
"-1",
"-2"
]
}
},
"folder":{
"name":"David/Tallan"
},
"annotations":[],
"lastPublishTime":"2021-06-08T15:15:56Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/RetrieveDailySmData')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsAnalyticData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyGoogleDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics_Analytics",
"type":"DatasetReference",
"parameters":{
"appid":"API",
"metrics":"visits%2Cbounces%2Cpageviews%2Centrancebouncerate_perc%2CsessionDuration",
"dimensions":"Date%2CchannelGroup%2CMetro%2Cprofile",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20VIEWS%22%7D%5D",
"datasource":"GA",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/analytics/google/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-08-01"
},
"lookback":{
"type":"int",
"defaultValue":0
},
"days_back":{
"type":"int",
"defaultValue":-4
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-14T17:06:31Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics_Analytics')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Spend_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyGoogleDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost_usd%2CConversionsmanyperclick",
"dimensions":"Date%2CAccountname%2CCampaignname%2CfinalURL",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D&otherParams=%5B%5D",
"datasource":"AW",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/google/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyFacebookDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Ccost_usd%2Coffsite_conversion",
"dimensions":"Date%2Caccount_name%2Ccampaign_group_name",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B\"ID\"%3A\"ALL_ACTIVE_ACCOUNTS\"%2C\"name\"%3A\"ALLACTIVEACCOUNTS\"%7D%5D",
"datasource":"FA",
"dsuser":"10157271394203579"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/facebook/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyMicrosoftDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CSpend_usd%2CConversions",
"dimensions":"Date%2CAccountName%2CCampaignName%2CFinalURL",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AC",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/microsoft/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopyLinkedInDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Cspend_usd%2Cconversions",
"dimensions":"date%2CaccountName%2CcampaignName%2CcreativeUrl",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"LIA",
"dsuser":"5Idh29s2_W"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/linkedin/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopySnapchatDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cconversion_ad_click%2Ccost_usd",
"dimensions":"date%2Ccampaign_name%2Cad_account_name",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%2236897f35-9be7-468b-80ae-d87093b07936%22%2C%22name%22%3A%22Post%20University%22%7D%5D",
"datasource":"SCM",
"dsuser":"dbca7ca9-0353-42af-a277-cfc3fbb82b72"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/snapchat/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoEUDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"advertiser_name%2Cdate",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":{
"value":"@toLower('')",
"type":"Expression"
},
"datasource":"CRI",
"dsuser":"45969"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/criteo/EU/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoJWUDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"advertiser_name%2Cdate",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":{
"value":"@toLower('')",
"type":"Expression"
},
"datasource":"CRI",
"dsuser":"42335"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/criteo/JWU/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoPostDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"advertiser_name%2Cdate",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":{
"value":"@toLower('')",
"type":"Expression"
},
"datasource":"CRI",
"dsuser":"37147"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/criteo/Post/',variables('folderName'))",
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoUCtoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"advertiser_name%2Cdate",
"start_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":{
"value":"@toLower('')",
"type":"Expression"
},
"datasource":"CRI",
"dsuser":"53952"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":"@concat('EMS/raw/supermetrics/input/criteo/CU/',variables('folderName'))",
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-07-02"
},
"lookback":{
"type":"int",
"defaultValue":0
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-11T17:10:54Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Spend_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataFacebookIGDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FacebookIG",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsFacebook"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:50:14Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataFacebookIGNightlyTest')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FacebookIGFirst15Days",
"type":"Copy",
"dependsOn":[
{
"activity":"FacebookIGAll30",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-16),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"FacebookIGSecond15Days",
"type":"Copy",
"dependsOn":[
{
"activity":"FacebookIGFirst15Days",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-15),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"FacebookIGAll30",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsFacebook"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"David"
},
"annotations":[],
"lastPublishTime":"2021-06-16T20:41:46Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataFacebookIGNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FacebookIGFirst15Days",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-16),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
},
{
"name":"FacebookIGSecond15Days",
"type":"Copy",
"dependsOn":[
{
"activity":"FacebookIGFirst15Days",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Coffsite_conversions_fb_pixel_add_to_cart%2Coffsite_conversions_fb_pixel_lead%2Ccost",
"dimensions":"Date%2Caccount_name%2Caccount_id%2Ccampaign_group_name%2Ccampaign_group_id%2Ccampaign_name%2Ccampaign_id%2CdestinationURL%2Cadgroup_id%2Cadgroup_name",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-15),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"FA",
"dsuser":"246868403796414"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsFacebook"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T20:41:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataFacebook')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyFacebookDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Ccost_usd%2Coffsite_conversion",
"dimensions":"Date%2Caccount_name%2Ccampaign_group_name",
"start_date":"2021-06-01",
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B\"ID\"%3A\"ALL_ACTIVE_ACCOUNTS\"%2C\"name\"%3A\"ALLACTIVEACCOUNTS\"%7D%5D",
"datasource":"FA",
"dsuser":"10157271394203579"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/inputnightly/facebook/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyGoogleDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"CopyFacebookDatatoDatalake",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost_usd%2CConversionsmanyperclick",
"dimensions":"Date%2CAccountname%2CCampaignname%2CfinalURL",
"start_date":"2021-04-1",
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D&otherParams=%5B%5D",
"datasource":"AW",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/inputnightly/google/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-06-14"
},
"lookback":{
"type":"int",
"defaultValue":0
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-14T16:30:07Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Spend_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataGoogleIGDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"GoogleIG",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost%2CConversionsmanyperclick",
"dimensions":"Date%2Cprofileid%2CAccountname%2CCampaignname%2CCampaignID%2CAdgroupID%2CAdgroupname%2CeffectiveFinalURL",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AW",
"dsuser":"supermetricsig%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsGoogle"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:51:58Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataGoogleIGNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"GoogleIG",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost%2CConversionsmanyperclick",
"dimensions":"Date%2Cprofileid%2CAccountname%2CCampaignname%2CCampaignID%2CAdgroupID%2CAdgroupname%2CeffectiveFinalURL",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AW",
"dsuser":"supermetricsig%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsGoogle"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:52:20Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataMicrosoftIGDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MicrosoftIG",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CSpend%2CConversions",
"dimensions":"Date%2CCampaignId%2CCampaignName%2CAdGroupId%2CAdGroupName%2CFinalURL%2CAccountId%2CAccountName",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AC",
"dsuser":"supermetricsig%40hotmail.com"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsMicrosoft"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:54:04Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataMicrosoftIGNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"MicrosoftIG",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CSpend%2CConversions",
"dimensions":"Date%2CCampaignId%2CCampaignName%2CAdGroupId%2CAdGroupName%2CFinalURL%2CAccountId%2CAccountName",
"start_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-30),'yyyy-MM-dd')",
"type":"Expression"
},
"end_date":{
"value":"@formatDateTime(adddays(convertFromUtc(utcnow(),'EasternStandardTime'),-0),'yyyy-MM-dd')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AC",
"dsuser":"supermetricsig%40hotmail.com"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":{
"value":"@pipeline().parameters.sinkDataBaseName",
"type":"Expression"
},
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":{
"value":"@pipeline().parameters.sinkTableSchema",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"sinkTableName":{
"type":"string",
"defaultValue":"SuperMetricsMicrosoft"
},
"sinkTableSchema":{
"type":"string",
"defaultValue":"dbo"
},
"sinkDataBaseName":{
"type":"string",
"defaultValue":"Staging"
}
},
"folder":{
"name":"IG/Marketing/Cost"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:54:33Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RetrieveSuperMetricsDataNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SeteffectiveDate",
"type":"SetVariable",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"variableName":"effectiveDate",
"value":{
"value":"@formatDateTime(adddays(pipeline().parameters.process_date,int(pipeline().parameters.lookback)),'yyyy-MM-dd')",
"type":"Expression"
}
}
},
{
"name":"SetfolderName",
"type":"SetVariable",
"dependsOn":[
{
"activity":"SeteffectiveDate",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"variableName":"folderName",
"value":{
"value":"@replace(variables('effectiveDate'),'-','/')",
"type":"Expression"
}
}
},
{
"name":"CopyGoogleDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CCost_usd%2CConversionsmanyperclick",
"dimensions":"Date%2CAccountname%2CCampaignname%2CfinalURL",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D&otherParams=%5B%5D",
"datasource":"AW",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/google/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyFacebookDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Clink_clicks%2Ccost_usd%2Coffsite_conversion",
"dimensions":"Date%2Caccount_name%2Ccampaign_group_name",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"ACTION_REPORT_TIME_impression",
"profiles":"%5B%7B\"ID\"%3A\"ALL_ACTIVE_ACCOUNTS\"%2C\"name\"%3A\"ALLACTIVEACCOUNTS\"%7D%5D",
"datasource":"FA",
"dsuser":"10157271394203579"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/facebook/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyMicrosoftDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"Impressions%2CClicks%2CSpend_usd%2CConversions",
"dimensions":"Date%2CAccountName%2CCampaignName%2CFinalURL",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"AC",
"dsuser":"supermetricsapi%40educationdynamics.com"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/microsoft/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyLinkedInDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Cspend_usd%2Cconversions",
"dimensions":"date%2CaccountName%2CcampaignName%2CcreativeUrl",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"LIA",
"dsuser":"5Idh29s2_W"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/linkedin/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopySnapchatDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cconversion_ad_click%2Ccost_usd",
"dimensions":"date%2Ccampaign_name%2Cad_account_name",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":{
"value":"@toLower('')",
"type":"Expression"
},
"profiles":"%5B%7B%22ID%22%3A%2236897f35-9be7-468b-80ae-d87093b07936%22%2C%22name%22%3A%22Post%20University%22%7D%5D",
"datasource":"SCM",
"dsuser":"dbca7ca9-0353-42af-a277-cfc3fbb82b72"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/snapchat/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoEUDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"date%2Ccampaign_name",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"CRI",
"dsuser":"45969"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/criteo/EU/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoJWUDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"date%2Ccampaign_name",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"CRI",
"dsuser":"42335"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/criteo/JWU/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
},
{
"name":"CopyCriteoPostDatatoDatalake",
"type":"Copy",
"dependsOn":[
{
"activity":"SetfolderName",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"HttpReadSettings",
"requestMethod":"GET"
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"DelimitedTextSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"DelimitedTextWriteSettings",
"quoteAllText":true,
"fileExtension":".txt"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"HTTP_SuperMetrics",
"type":"DatasetReference",
"parameters":{
"metrics":"impressions%2Cclicks%2Ccost",
"dimensions":"date%2Ccampaign_name",
"start_date":{
"value":"@adddays(variables('effectiveDate'),int(pipeline().parameters.days_back))",
"type":"Expression"
},
"end_date":{
"value":"@variables('effectiveDate')",
"type":"Expression"
},
"settings":"CURRENCY_USD",
"profiles":"%5B%7B%22ID%22%3A%22ALL_ACCOUNTS%22%2C%22name%22%3A%22ALL%20ACCOUNTS%22%7D%5D",
"datasource":"CRI",
"dsuser":"37147"
}
}
],
"outputs":[
{
"referenceName":"Datalake_Spend_CSV",
"type":"DatasetReference",
"parameters":{
"folder":{
"value":"@concat('EMS/raw/supermetrics/input/criteo/Post/',variables('folderName'))",
"type":"Expression"
},
"container":"datalake"
}
}
]
}
],
"parameters":{
"process_date":{
"type":"string",
"defaultValue":"2021-06-22"
},
"lookback":{
"type":"int",
"defaultValue":0
},
"days_back":{
"type":"int",
"defaultValue":-3
}
},
"variables":{
"folderName":{
"type":"String",
"defaultValue":"2021/02/01"
},
"effectiveDate":{
"type":"String",
"defaultValue":"2021/02/01"
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-14T17:06:31Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/HTTP_SuperMetrics')]",
"[concat(variables('workspaceId'),'/datasets/Datalake_Spend_CSV')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SendEmail')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SendEmail",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-.eastus2.logic.azure.com:3/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":\"error\",\n\"color\":\"Green\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"Templates"
},
"annotations":[],
"lastPublishTime":"2021-06-08T21:42:58Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/ServerConnectionParameters')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"CopydataDynamicServerDatabaseTable",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"selecttop(1)*from@{pipeline().parameters.sourceTableName}x(nolock)",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"SqlServerSink",
"preCopyScript":{
"value":"ifobject_id('@{pipeline().parameters.sinkTableName}')isnotnulltruncatetable@{pipeline().parameters.sinkTableName}",
"type":"Expression"
},
"tableOption":"autoCreate"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":{
"value":"@pipeline().parameters.sourceTableName",
"type":"Expression"
},
"TableSchema":"dbo"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":{
"value":"@pipeline().parameters.sinkTableName",
"type":"Expression"
},
"TableSchema":"dbo"
}
}
]
}
],
"parameters":{
"sourceTableName":{
"type":"String",
"defaultValue":"aaadjs2"
},
"sinkTableName":{
"type":"string",
"defaultValue":"aaadjs2"
}
},
"folder":{
"name":"David/Testing/Parameters"
},
"annotations":[],
"lastPublishTime":"2021-06-11T14:40:42Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateExternalInquires')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageExternalInquiriesLoop",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source')",
"type":"Expression"
},
"isSequential":false,
"activities":[
{
"name":"StageExternalInquiries",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/EMS/StageExternalInquiries",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"CurateExternalInquiries",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StageExternalInquiriesLoop",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/EMS/CurateExternalInquiries"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"azusa",
"cumberlands",
"geneva",
"pennlp",
"post"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:11:15Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateInquiryNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"NightlyRefresh_Inquiry",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/NightlyRefresh_Inquiry"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CurateInquiry",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"NightlyRefresh_Inquiry",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateInquiry"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:03:36Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateInquiry')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageInquiry",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/NightlyRefresh_Inquiry",
"baseParameters":{
"EnableArchive":"True"
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CurateInquiry",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StageInquiry",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateInquiry"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T19:54:55Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateManagementFees')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageManagementFeels",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/EMS/StageManagementFees"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CurateManagementFeels",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StageManagementFeels",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/EMS/CurateManagementFees"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCuratePerformanceData')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StagePerformanceData",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/StagePerformance",
"baseParameters":{
"EnableArchive":"True"
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CuratePerformaceData",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StagePerformanceData",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CuratePerformance"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"PopulatePerformace",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"CuratePerformaceData",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[PopulatePerformace]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
},
{
"name":"RemovePerformace",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"PopulatePerformace",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[dbo].[RemovePerformace]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
],
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-16T19:31:44Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateSpendNonSuperMetrics')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageSpendNonSuperMetrics",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/StageSpendNotSM"
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
],
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat"
]
},
"Source_Curated":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat",
"NotSM"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:10:43Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateSpendSuperMetricsandNonSMDaily')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageSpendSuperMetrics",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source')",
"type":"Expression"
},
"isSequential":false,
"activities":[
{
"name":"StageSpend",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/NightlyRefresh_Spend",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
},
"EnableArchive":"True"
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"CurateSpend",
"type":"ForEach",
"dependsOn":[
{
"activity":"StageandCurateSpendNonSuperMetrics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source_Curated')",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"CuratedSpend",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateSpend",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"StageandCurateSpendNonSuperMetrics",
"type":"ExecutePipeline",
"dependsOn":[
{
"activity":"StageSpendSuperMetrics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"pipeline":{
"referenceName":"StageandCurateSpendNonSuperMetrics",
"type":"PipelineReference"
},
"waitOnCompletion":true,
"parameters":{}
}
}
],
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat"
]
},
"Source_Curated":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat",
"NotSM"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:10:43Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/StageandCurateSpendNonSuperMetrics')]",
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateSpendSuperMetricsandNonSMNightly')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageSpendSuperMetrics",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source')",
"type":"Expression"
},
"isSequential":false,
"activities":[
{
"name":"StageSpendNightly",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/NightlyRefresh_Spend",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
},
"EnableArchive":"True"
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"CurateSpend",
"type":"ForEach",
"dependsOn":[
{
"activity":"StageSpendSuperMetrics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source_Curated')",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"CuratedSpend",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateSpend",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
}
],
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat"
]
},
"Source_Curated":{
"type":"Array",
"defaultValue":[
"criteo",
"facebook",
"google",
"linkedin",
"microsoft",
"snapchat",
"NotSM"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:11:15Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateSuperMetricsAnalytics')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"StageSuperMetricsAnalytics",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source')",
"type":"Expression"
},
"isSequential":false,
"activities":[
{
"name":"StageSMAnalytics",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/StageAnalytics",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"CurateSupermetricsAnalytics",
"type":"ForEach",
"dependsOn":[
{
"activity":"StageSuperMetricsAnalytics",
"dependencyConditions":[
"Succeeded"
]
}
],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source_Curated')",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"CuratedSMAnalytics",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateAnalytics",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
}
]
}
}
],
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"google"
]
},
"Source_Curated":{
"type":"Array",
"defaultValue":[
"google"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T20:10:43Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StageandCurateTarget')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"TargetFiles",
"type":"ForEach",
"dependsOn":[],
"userProperties":[],
"typeProperties":{
"items":{
"value":"@variables('Source')",
"type":"Expression"
},
"isSequential":true,
"activities":[
{
"name":"StageTarget",
"type":"DatabricksNotebook",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/StageTarget",
"baseParameters":{
"EnableArchive":"True",
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"CurateTarget",
"type":"DatabricksNotebook",
"dependsOn":[
{
"activity":"StageTarget",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"notebookPath":"/production/CurateTarget",
"baseParameters":{
"Source":{
"value":"@item()",
"type":"Expression"
}
}
},
"linkedServiceName":{
"referenceName":"EddyAzureDatabricks",
"type":"LinkedServiceReference"
}
},
{
"name":"factPopulateTargetEMS_Main_copy1",
"type":"SqlServerStoredProcedure",
"dependsOn":[
{
"activity":"CurateTarget",
"dependencyConditions":[
"Succeeded"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"storedProcedureName":"[fact].[PopulateTargetEMS_Main]"
},
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
}
}
]
}
},
{
"name":"FailureEmailTargetFiles",
"type":"WebActivity",
"dependsOn":[
{
"activity":"TargetFiles",
"dependencyConditions":[
"Failed"
]
}
],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-51.eastus2.logic.azure.com:443/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"@{pipeline().Pipeline}PipelineFailed\",\n\"message\":\"@{activity('TargetFiles').Error.Message}\",\n\"dataFactoryName\":\"@{pipeline().DataFactory}\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyy-MM-ddHH:mm:ss')}\"\n}",
"type":"Expression"
}
}
}
],
"concurrency":1,
"variables":{
"Source":{
"type":"Array",
"defaultValue":[
"original",
"reforecast"
]
}
},
"folder":{
"name":"EMS"
},
"annotations":[],
"lastPublishTime":"2021-06-04T19:55:33Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/linkedServices/EddyAzureDatabricks')]",
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/TriggerStorageEvent')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Copydata1",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"DelimitedTextSource",
"storeSettings":{
"type":"AzureBlobFSReadSettings",
"recursive":true,
"enablePartitionDiscovery":false
},
"formatSettings":{
"type":"DelimitedTextReadSettings"
}
},
"sink":{
"type":"SqlServerSink",
"tableOption":"autoCreate"
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"datalake_csv",
"type":"DatasetReference",
"parameters":{
"FileSystem":"datalake",
"Directory":"EMS/landing/utm",
"File":"utmtriggertest.csv"
}
}
],
"outputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"staging",
"TableName":"utmtriggertest",
"TableSchema":"dbo"
}
}
]
}
],
"folder":{
"name":"David"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/WebActivitySendEmail')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"SendEmail",
"type":"WebActivity",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"url":"https://prod-.eastus2.logic.azure.com:3/workflows/506b872e911f4c74aa9477953015ea8f/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0",
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
},
"method":"POST",
"headers":{
"Content-Type":{
"value":"Application/json",
"type":"Expression"
}
},
"body":{
"value":"{\n\"title\":\"PipeLineRunFailed\",\n\"message\":\"error\",\n\"color\":\"Green\",\n\"dataFactoryName\":\"test\",\n\"pipelineName\":\"@{pipeline().Pipeline}\",\n\"PipelineRunID\":\"@{pipeline().RunId}\",\n\"Time\":\"@{utcnow()}\"\n}",
"type":"Expression"
}
}
}
],
"folder":{
"name":"David/Templates"
},
"annotations":[],
"lastPublishTime":"2021-06-08T21:42:35Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimCampaign')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DimCampaign",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\dim\\campaign"
},
"FileName":{
"type":"string",
"defaultValue":"dimcampaign.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"SELECTC.CampaignId,c.CampaignName,c.TrackId,sch.SubChannelId,sch.SubChannelName,sch.SubChannelDescription,ch.ChannelId,ch.ChannelName,ch.ChannelDescription,V.VendorId,V.VendorName,V.VendorDescription,A.ApplicationId,A.ApplicationName,mu.MarketingUnitId,mu.NameASMarketingUnitName,cc.FirstName+''+cc.LastNameASCampaignCoordinator,COALESCE(vpp.PortalProfileGuid,CAST('00000000-0000-0000-0000-000000000000'asuniqueidentifier))ASPortalProfileGuidfromNexus.dbo.CampaigncleftouterjoinNexus.dbo.SubChannelschonsch.SubChannelID=c.SubChannelIDleftouterjoinNexus.dbo.Channelchonch.ChannelID=sch.ChannelIDleftouterjoinNexus.dbo.Vendorvonv.VendorID=c.VendorIDleftouterjoinNexus.dbo.[Application]aona.ApplicationID=c.ApplicationIDleftouterjoinNexus.dbo.MarketingUnitmuonmu.MarketingUnitID=c.MarketingUnitIDLEFTouterjoinNexus.dbo.Userscconcc.UserID=c.CampaignCoordinatorIDLeftOuterJoinStaging.nx.PortalClientRelationship_Vendorvpp--Addingnewcolumn'VendorPortalProfileGuid'toCampaignDimensiononc.VendorId=vpp.VendorId"
}
},
"folder":{
"name":"IG/Dimensions"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimClientRelationship')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DimClientRelationship",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\dim\\clientrelationship"
},
"FileName":{
"type":"string",
"defaultValue":"dimclientrelationship.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"Selectcr.ClientRelationshipID,ISNULL(i.InstitutionID,0)ASInstitutionID,LTRIM(RTRIM(ISNULL(i.Name,'unknown')))InstitutionName,ISNULL(iit.InstitutionIncorporationTypeID,0)ASInstitutionIncorporationTypeID,COALESCE(NULLIF(LTRIM(RTRIM(iit.TypeDescription)),''),'unknown')ASInstitutionIncorporationTypeName,LTRIM(RTRIM(ISNULL(c.ClientName,'unknown')))ASClientName,ISNULL(am.UserID,0)ASAccountManagerID,COALESCE(NULLIF(LTRIM(RTRIM(LTRIM(RTRIM(ISNULL(am.FirstName,'')))+''+LTRIM(RTRIM(ISNULL(am.LastName,''))))),''),'unknown')ASAccountManagerName,COALESCE(NULLIF(LTRIM(RTRIM(am.Email)),''),'unknown')ASAccountManagerEmailAddress,ISNULL(ac.UserID,0)ASAccountCooridatorID,COALESCE(NULLIF(LTRIM(RTRIM(LTRIM(RTRIM(ISNULL(ac.FirstName,'')))+''+LTRIM(RTRIM(ISNULL(ac.LastName,''))))),''),'unknown')ASAccountCooridatorName,COALESCE(NULLIF(LTRIM(RTRIM(ac.Email)),''),'unknown')ASAccountCooridatorEmailAddressfromNexus.dbo.ClientRelationshipcrleftouterjoinNexus.dbo.Institutionioni.InstitutionID=cr.InstitutionIDleftouterjoinNexus.dbo.Usersamonam.UserID=cr.AccountManagerIDleftouterjoinNexus.dbo.Usersaconac.UserID=cr.AccountCoordinatorIDleftouterjoinNexus.dbo.BillingCyclebconbc.BillingCycleID=cr.BillingCycleIDleftouterjoinNexus.dbo.AccreditationOrgaoonao.AccreditationID=i.AccreditationTypeIDleftouterjoinNexus.dbo.InstitutionIncorporationTypeiitoniit.InstitutionIncorporationTypeID=i.InstitutionIncorporationTypeIDleftouterjoinNexus.dbo.Clientconc.ClientID=cr.ClientIDWHEREcr.IsEnabled=1"
}
},
"folder":{
"name":"IG/Dimensions"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimProduct')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DimProduct",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\dim\\product"
},
"FileName":{
"type":"string",
"defaultValue":"dimproduct.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"SELECTProductId,ProductName,ProductDescriptionFROMnexus.dbo.Productp(nolock)"
}
},
"folder":{
"name":"IG/Dimensions"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimRealtimeDeliveryStatus')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"DimRealtimeDeliveryStatus",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\dim\\realtimedeliverystatus"
},
"FileName":{
"type":"string",
"defaultValue":"dimrealtimedeliverystatus.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"selectr.RealTimeDeliveryStatusIDas[RealTimeDeliveryStatusID],\tISNULL(NULLIF(LTRIM(RTRIM(r.RealTimeDeliveryStatusName)),''),'NaN')as[RealTimeDeliveryStatusName],\tISNULL(r.CountAgainstCap,0)as[RealTimeDeliveryStatusCountAgainstCap],\tISNULL(r.IsEnabled,0)as[RealTimeDeliveryStatusIsActive],\tISNULL(rt.RealTimeDeliveryStatusTypeID,0)as[RealTimeDeliveryStatusTypeId],\tISNULL(NULLIF(LTRIM(RTRIM(rt.RealTimeDeliveryStatusTypeName)),''),'NaN')as[RealTimeDeliveryStatusTypeName],\tISNULL(NULLIF(LTRIM(RTRIM(rt.RealTimeDeliveryStatusTypeDescription)),''),'NaN')as[RealTimeDeliveryStatusTypeDescription],\tISNULL(rt.IsEnabled,0)as[RealTimeDeliveryStatusTypeIsActive]fromNexus.dbo.RealtimeDeliveryStatusr(nolock)leftouterjoinNexus.dbo.RealtimeDeliveryStatusTypert(nolock)onrt.RealtimeDeliveryStatusTypeID=r.RealtimeDeliveryStatusType"
}
},
"folder":{
"name":"IG/Dimensions"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimCampaign')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"Campaign",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"Campaign",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"preCampaign":{},
"CampaignRef":{},
"CampaignDim":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:16:45Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/Campaign')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimCampaign_SCDType1')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"df_CampaignType1",
"type":"ExecuteDataFlow",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"dataflow":{
"referenceName":"Dataflow1",
"type":"DataFlowReference",
"parameters":{},
"datasetParameters":{
"dimCampaign":{},
"StagngCampaign":{},
"sink1":{}
}
},
"staging":{
"linkedService":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"folderPath":"files"
},
"compute":{
"coreCount":8,
"computeType":"General"
},
"traceLevel":"Fine"
}
}
],
"folder":{
"name":"David/Testing/DataFlows"
},
"annotations":[],
"lastPublishTime":"2021-06-07T19:16:52Z"
},
"dependsOn":[
"[concat(variables('workspaceId'),'/dataflows/Dataflow1')]",
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/factLead')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FactLead",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\fact\\lead"
},
"FileName":{
"type":"string",
"defaultValue":"factlead.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"SELECTL.Leadid,L.CreatedDate_EST,L.TrackId,L.ClientRelationshipId,L.ProductID,L.RealtimeDeliveryStatusId,CASEWHENr.CountAgainstCap=1THEN1ELSE0ENDASsuccessleads,CASEWHENr.CountAgainstCap=0THEN1ELSE0ENDASfailedleads,1ASTotalLeadsFROMNexus.dbo.LeadLJOINNexus.dbo.RealtimeDeliveryStatusrONL.RealtimeDeliveryStatusId=R.RealTimeDeliveryStatusIdWHEREL.CreatedDate_EST>='1/1/2021'"
}
},
"folder":{
"name":"IG/Facts"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/factPerformance')]",
"type":"Microsoft.Synapse/workspaces/pipelines",
"apiVersion":"2019-06-01-preview",
"properties":{
"activities":[
{
"name":"FactPerformance",
"type":"Copy",
"dependsOn":[],
"policy":{
"timeout":"7.00:00:00",
"retry":0,
"retryIntervalInSeconds":30,
"secureOutput":false,
"secureInput":false
},
"userProperties":[],
"typeProperties":{
"source":{
"type":"SqlServerSource",
"sqlReaderQuery":{
"value":"@pipeline().parameters.SourceQuery",
"type":"Expression"
},
"queryTimeout":"02:00:00",
"partitionOption":"None"
},
"sink":{
"type":"ParquetSink",
"storeSettings":{
"type":"AzureBlobFSWriteSettings"
},
"formatSettings":{
"type":"ParquetWriteSettings"
}
},
"enableStaging":false,
"translator":{
"type":"TabularTranslator",
"typeConversion":true,
"typeConversionSettings":{
"allowDataTruncation":true,
"treatBooleanAsNumber":false
}
}
},
"inputs":[
{
"referenceName":"SqlServer_Reportcluster01",
"type":"DatasetReference",
"parameters":{
"DataBaseName":"Nexus",
"TableName":{
"value":"@toLower('')",
"type":"Expression"
},
"TableSchema":{
"value":"@toLower('')",
"type":"Expression"
}
}
}
],
"outputs":[
{
"referenceName":"datalake_parquet",
"type":"DatasetReference",
"parameters":{
"FileSystem":{
"value":"@pipeline().parameters.FileSystem",
"type":"Expression"
},
"Directory":{
"value":"@pipeline().parameters.Directory",
"type":"Expression"
},
"File":{
"value":"@pipeline().parameters.FileName",
"type":"Expression"
}
}
}
]
}
],
"parameters":{
"FileSystem":{
"type":"string",
"defaultValue":"datalake"
},
"Directory":{
"type":"string",
"defaultValue":"IG\\raw\\fact\\performance"
},
"FileName":{
"type":"string",
"defaultValue":"factperformance.parquet"
},
"SourceQuery":{
"type":"string",
"defaultValue":"SELECTpi.LeadId,L.CreatedDate_EST,CASEWHENST.CountAgainstCap=1ANDpi.Start=1THEN1ELSENULLENDASStarts,CASEWHENST.CountAgainstCap=1AND(pi.Enrollment=1ORpi.START=1)THEN1ELSENULLENDASEnrollmentStarts,CASEWHENST.CountAgainstCap=1AND(pi.ApplicationSubmitted=1ORpi.Enrollment=1ORpi.START=1)THEN1ELSENULLENDASEngagements,CASEWHENST.CountAgainstCap=1ANDpi.Enrollment=1THEN1ELSENULLENDASEnrollments,CASEWHENST.CountAgainstCap=1ANDpi.Contact=1THEN1ELSENULLENDASContacts,CASEWHENST.CountAgainstCap=1ANDpi.Interview=1THEN1ELSENULLENDASInterviews,CASEWHENST.CountAgainstCap=1ANDpi.PayableScrub=1THEN1ELSENULLENDASPayableScrub,CASEWHENST.CountAgainstCap=1ANDpi.NonPayableScrub=1THEN1ELSENULLENDASNonPayableScrub,CASEWHENST.CountAgainstCap=1ANDpi.ApplicationApproved=1THEN1ELSENULLENDASApplicationApproved,CASEWHENST.CountAgainstCap=1ANDpi.ApplicationSubmitted=1THEN1ELSENULLENDASApplicationSubmitted,CASEWHENST.CountAgainstCap=1ANDpi.Appointment=1THEN1ELSENULLENDASAppointment,pi.ScrubReasonFROMwcs2.Conversion.PostInfoASpiWITH(NOLOCK)JOINNexus.dbo.LeadASLWITH(nolock)ONL.LeadId=pi.LeadIdJOINNexus.dbo.RealTimeDeliveryStatusASSTWITH(nolock)ONST.RealTimeDeliveryStatusId=L.RealtimeDeliveryStatusIdWHEREL.CreatedDate_EST>='1/1/2021'"
}
},
"folder":{
"name":"IG/Facts"
},
"annotations":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/SqlServer_Reportcluster01')]",
"[concat(variables('workspaceId'),'/datasets/datalake_parquet')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/ASAFactMediaAlphaLeads')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CreatedDate_EST",
"type":"date"
},
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"EstimatedRevShare",
"type":"decimal",
"precision":38,
"scale":2
},
{
"name":"CountAgainstCap",
"type":"int",
"precision":10
},
{
"name":"leadid",
"type":"decimal",
"precision":18,
"scale":0
},
{
"name":"ClientRelationshipDimID",
"type":"int",
"precision":10
}
],
"typeProperties":{
"schema":"fact",
"table":"MediaAlpha_Leads"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/ASAStagingMediaAlphaClicks')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"DataPointDate",
"type":"date"
},
{
"name":"CampaignTrackId",
"type":"uniqueidentifier"
},
{
"name":"Clicks",
"type":"int",
"precision":10
},
{
"name":"Revenue",
"type":"decimal",
"precision":38,
"scale":2
}
],
"typeProperties":{
"schema":"Staging",
"table":"Clicks"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/ASAStagingMediaAlphaLeads')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CreatedDate_EST",
"type":"date"
},
{
"name":"TrackId",
"type":"uniqueidentifier"
},
{
"name":"EstimatedRevShare",
"type":"decimal",
"precision":38,
"scale":2
},
{
"name":"CountAgainstCap",
"type":"int",
"precision":10
},
{
"name":"leadid",
"type":"decimal",
"precision":18,
"scale":0
},
{
"name":"ClientRelationshipID",
"type":"int",
"precision":10
}
],
"typeProperties":{
"schema":"Staging",
"table":"MediaAlpha_Leads"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/AzureSynapseAnalytics')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"parameters":{
"TableName":{
"type":"string"
},
"TableSchema":{
"type":"string"
}
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[],
"typeProperties":{
"schema":{
"value":"@dataset().TableSchema",
"type":"Expression"
},
"table":{
"value":"@dataset().TableName",
"type":"Expression"
}
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/AzureSynapseAnalyticsTable1')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CreatedDate_EST",
"type":"date"
},
{
"name":"TrackId",
"type":"uniqueidentifier"
},
{
"name":"EstimatedRevShare",
"type":"decimal",
"precision":38,
"scale":2
},
{
"name":"CountAgainstCap",
"type":"bit"
},
{
"name":"leadid",
"type":"decimal",
"precision":18,
"scale":0
},
{
"name":"ClientRelationshipID",
"type":"int",
"precision":10
}
],
"typeProperties":{
"schema":"Staging",
"table":"Leads"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/CoreWebVitals')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":"*.csv",
"folderPath":"EMS/corewebvitals/output",
"fileSystem":"datalake"
},
"columnDelimiter":",",
"rowDelimiter":"\n",
"escapeChar":"\"",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
},
{
"type":"String"
}
]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DataLake_Mapping_Parquet')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"sheetName":{
"type":"string",
"defaultValue":"DIM_Service"
},
"container":{
"type":"string",
"defaultValue":"datalake"
},
"folder":{
"type":"string"
}
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"Parquet",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@concat(dataset().sheetName,'.parquet')",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"compressionCodec":"snappy"
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DataLake_NonSuperMetrics_CSV')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"sheetName":{
"type":"string"
},
"container":{
"type":"string",
"defaultValue":"datalake"
},
"folder":{
"type":"string"
}
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@concat(dataset().sheetName,'.csv')",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Datalake_Inquires_Parquet')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"folder":{
"type":"string"
},
"container":{
"type":"string",
"defaultValue":"datalake/EMS"
}
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"Parquet",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@concat('data_',formatDateTime(utcnow(),'yyyMMdd'),'.parquet')",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"compressionCodec":"snappy"
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Datalake_Spend_CSV')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"folder":{
"type":"string"
},
"container":{
"type":"string",
"defaultValue":"datalake"
}
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@concat('data_',formatDateTime(convertFromUtc(utcnow(),'EasternStandardTime'),'yyyyMMdd'),'.csv')",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DimClientRelationship')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"ClientRelationshipdimID",
"type":"int",
"precision":10
},
{
"name":"ClientRelationshipID",
"type":"int",
"precision":10
},
{
"name":"ClientID",
"type":"int",
"precision":10
},
{
"name":"ClientName",
"type":"varchar"
},
{
"name":"InstitutionID",
"type":"int",
"precision":10
},
{
"name":"InstitutionName",
"type":"varchar"
},
{
"name":"AccountManagerId",
"type":"int",
"precision":10
},
{
"name":"AccountManager",
"type":"varchar"
},
{
"name":"AccountCoordinatorId",
"type":"int",
"precision":10
},
{
"name":"AccountCooridator",
"type":"varchar"
},
{
"name":"InstitutionIncorporationTypeId",
"type":"int",
"precision":10
},
{
"name":"InstitutionIncorporationTypeName",
"type":"varchar"
},
{
"name":"isActive",
"type":"int",
"precision":10
},
{
"name":"EffDate",
"type":"datetime",
"precision":23,
"scale":3
},
{
"name":"ExpDate",
"type":"datetime",
"precision":23,
"scale":3
},
{
"name":"ModTime",
"type":"datetime",
"precision":23,
"scale":3
}
],
"typeProperties":{
"schema":"dim",
"table":"ClientRelationship"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Excel_GetFileNamesPerformance')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"FileSystem":{
"type":"string"
},
"Directory":{
"type":"string"
},
"SheetName":{
"type":"string"
}
},
"annotations":[],
"type":"Excel",
"typeProperties":{
"sheetName":{
"value":"@dataset().SheetName",
"type":"Expression"
},
"location":{
"type":"AzureBlobFSLocation",
"folderPath":{
"value":"@dataset().Directory",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().FileSystem",
"type":"Expression"
}
},
"firstRowAsHeader":true
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/HTTP_SuperMetrics')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"HTTP_SuperMetrics",
"type":"LinkedServiceReference",
"parameters":{
"metrics":{
"value":"@dataset().metrics",
"type":"Expression"
},
"dimensions":{
"value":"@dataset().dimensions",
"type":"Expression"
},
"start_date":{
"value":"@dataset().start_date",
"type":"Expression"
},
"end_date":{
"value":"@dataset().end_date",
"type":"Expression"
},
"settings":{
"value":"@dataset().settings",
"type":"Expression"
},
"profiles":{
"value":"@dataset().profiles",
"type":"Expression"
},
"datasource":{
"value":"@dataset().datasource",
"type":"Expression"
},
"dsuser":{
"value":"@dataset().dsuser",
"type":"Expression"
}
}
},
"parameters":{
"metrics":{
"type":"string",
"defaultValue":"Impressions%2CClicks%2CCost_usd%2CBounceRate_perc%2CAverageposition%2CAvailableImpressions%2CConversionsmanyperclick"
},
"dimensions":{
"type":"string",
"defaultValue":"Date%2CAccountname%2CCampaignname%2CfinalURL"
},
"start_date":{
"type":"string",
"defaultValue":"2021-02-01"
},
"end_date":{
"type":"string",
"defaultValue":"2021-02-28"
},
"settings":{
"type":"string"
},
"profiles":{
"type":"string",
"defaultValue":"%5B%7B%22ID%22%3A%226504080945%22%2C%22name%22%3A%22Post%20University%22%7D%2C%7B%22ID%22%3A%227226334139%22%2C%22name%22%3A%22PSM%20-%20Keiser%20Culinary%22%7D%2C%7B%22ID%22%3A%224467487353%22%2C%22name%22%3A%22PSM%20-%20Keiser%20University%20New%22%7D%5D"
},
"datasource":{
"type":"string",
"defaultValue":"AW"
},
"dsuser":{
"type":"string",
"defaultValue":"supermetricsapi%40educationdynamics.com"
}
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"HttpServerLocation"
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/HTTP_SuperMetrics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/HTTP_SuperMetrics_Analytics')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"HTTP_SuperMetrics_Analytics",
"type":"LinkedServiceReference",
"parameters":{
"appid":{
"value":"@dataset().appid",
"type":"Expression"
},
"metrics":{
"value":"@dataset().metrics",
"type":"Expression"
},
"dimensions":{
"value":"@dataset().dimensions",
"type":"Expression"
},
"start_date":{
"value":"@dataset().start_date",
"type":"Expression"
},
"end_date":{
"value":"@dataset().end_date",
"type":"Expression"
},
"profiles":{
"value":"@dataset().profiles",
"type":"Expression"
},
"datasource":{
"value":"@dataset().datasource",
"type":"Expression"
},
"dsuser":{
"value":"@dataset().dsuser",
"type":"Expression"
}
}
},
"parameters":{
"appid":{
"type":"string"
},
"metrics":{
"type":"string"
},
"dimensions":{
"type":"string"
},
"start_date":{
"type":"string"
},
"end_date":{
"type":"string"
},
"profiles":{
"type":"string"
},
"datasource":{
"type":"string"
},
"dsuser":{
"type":"string"
}
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"HttpServerLocation"
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/HTTP_SuperMetrics_Analytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/IfExistsGetFileName_csv')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"FileSystem":{
"type":"string"
},
"Directory":{
"type":"string"
}
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"folderPath":{
"value":"@dataset().Directory",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().FileSystem",
"type":"Expression"
}
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Json_GetFileNamesPerformance')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"annotations":[],
"type":"Json",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"folderPath":"EMS/landing/performance",
"fileSystem":"datalake"
}
},
"schema":{}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MappingExcel')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"sheetName":{
"type":"string"
},
"fileName":{
"type":"string"
},
"container":{
"type":"string"
},
"folder":{
"type":"string"
}
},
"annotations":[],
"type":"Excel",
"typeProperties":{
"sheetName":{
"value":"@dataset().sheetName",
"type":"Expression"
},
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@dataset().fileName",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"firstRowAsHeader":true
},
"schema":[
{
"name":"Scope",
"type":"String"
},
{
"name":"Division",
"type":"String"
},
{
"name":"InstitutionName",
"type":"String"
},
{
"name":"ClientRelationshipId",
"type":"String"
},
{
"name":"Accounts/Profiles",
"type":"String"
}
]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Mapping_EXCEL')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"sheetName":{
"type":"string",
"defaultValue":"DIM_Service"
},
"fileName":{
"type":"string",
"defaultValue":"BudgetandFeesOverview-PostandKeiser.xlsx"
},
"container":{
"type":"string",
"defaultValue":"datalake"
},
"folder":{
"type":"string"
}
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"Excel",
"typeProperties":{
"sheetName":{
"value":"@dataset().sheetName",
"type":"Expression"
},
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@dataset().fileName",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().folder",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().container",
"type":"Expression"
}
},
"firstRowAsHeader":true
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RestService_MediaAlpha')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"RestService_MediaAlpha",
"type":"LinkedServiceReference",
"parameters":{
"start_date":{
"value":"@dataset().start_date",
"type":"Expression"
},
"end_date":{
"value":"@dataset().end_date",
"type":"Expression"
},
"metrics":{
"value":"@dataset().metrics",
"type":"Expression"
}
}
},
"parameters":{
"start_date":{
"type":"string"
},
"end_date":{
"type":"string"
},
"metrics":{
"type":"string"
}
},
"annotations":[],
"type":"RestResource",
"typeProperties":{},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/RestService_MediaAlpha')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_Reportcluster01')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"SqlServer_Reportcluster01",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@dataset().DataBaseName",
"type":"Expression"
}
}
},
"parameters":{
"DataBaseName":{
"type":"string"
},
"TableName":{
"type":"string"
},
"TableSchema":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServerTable",
"schema":[],
"typeProperties":{
"schema":{
"value":"@dataset().TableSchema",
"type":"Expression"
},
"table":{
"value":"@dataset().TableName",
"type":"Expression"
}
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_Reportcluster01')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_eddyinfraag')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"SqlServer_eddyinfraag",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@dataset().DataBaseName",
"type":"Expression"
}
}
},
"parameters":{
"DataBaseName":{
"type":"string"
},
"TableName":{
"type":"string"
},
"TableSchema":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServerTable",
"schema":[],
"typeProperties":{
"schema":{
"value":"@dataset().TableSchema",
"type":"Expression"
},
"table":{
"value":"@dataset().TableName",
"type":"Expression"
}
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_eddyinfraag')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_isdb')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"SqlServer_isdb",
"type":"LinkedServiceReference",
"parameters":{
"DataBaseName":{
"value":"@dataset().DataBaseName",
"type":"Expression"
}
}
},
"parameters":{
"DataBaseName":{
"type":"string"
},
"TableName":{
"type":"string"
},
"TableSchema":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServerTable",
"schema":[],
"typeProperties":{
"schema":{
"value":"@dataset().TableSchema",
"type":"Expression"
},
"table":{
"value":"@dataset().TableName",
"type":"Expression"
}
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/SqlServer_isdb')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/StagingClientRelationship')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"ClientRelationshipID",
"type":"int",
"precision":10
},
{
"name":"ClientID",
"type":"int",
"precision":10
},
{
"name":"ClientName",
"type":"varchar"
},
{
"name":"InstitutionID",
"type":"int",
"precision":10
},
{
"name":"InstitutionName",
"type":"varchar"
},
{
"name":"AccountManagerId",
"type":"int",
"precision":10
},
{
"name":"AccountManager",
"type":"varchar"
},
{
"name":"AccountCoordinatorId",
"type":"int",
"precision":10
},
{
"name":"AccountCooridator",
"type":"varchar"
},
{
"name":"InstitutionIncorporationTypeId",
"type":"int",
"precision":10
},
{
"name":"InstitutionIncorporationTypeName",
"type":"varchar"
}
],
"typeProperties":{
"schema":"Staging",
"table":"ClientRelationship"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Tallan')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"reportcluster01_Tallan",
"type":"LinkedServiceReference"
},
"folder":{
"name":"Tallan"
},
"annotations":[],
"type":"SqlServerTable",
"schema":[],
"typeProperties":{
"schema":"dbo",
"table":"InquiryData"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/reportcluster01_Tallan')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/datalake_csv')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"FileSystem":{
"type":"string"
},
"Directory":{
"type":"string"
},
"File":{
"type":"string"
}
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@dataset().File",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().Directory",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().FileSystem",
"type":"Expression"
}
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/datalake_csv_dataflow_sink')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"FileSystem":{
"type":"string"
},
"Directory":{
"type":"string"
},
"FileName":{
"type":"string"
}
},
"annotations":[],
"type":"DelimitedText",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"folderPath":{
"value":"@dataset().Directory",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().FileSystem",
"type":"Expression"
}
},
"columnDelimiter":",",
"escapeChar":"\\",
"firstRowAsHeader":true,
"quoteChar":"\""
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/datalake_parquet')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"eddydevsynapse-WorkspaceDefaultStorage",
"type":"LinkedServiceReference"
},
"parameters":{
"FileSystem":{
"type":"string"
},
"Directory":{
"type":"string"
},
"File":{
"type":"string"
}
},
"annotations":[],
"type":"Parquet",
"typeProperties":{
"location":{
"type":"AzureBlobFSLocation",
"fileName":{
"value":"@dataset().File",
"type":"Expression"
},
"folderPath":{
"value":"@dataset().Directory",
"type":"Expression"
},
"fileSystem":{
"value":"@dataset().FileSystem",
"type":"Expression"
}
},
"compressionCodec":"snappy"
},
"schema":[]
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/eddydevsynapse-WorkspaceDefaultStorage')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimCampaign')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"TrackID",
"type":"uniqueidentifier"
},
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorID",
"type":"int",
"precision":10
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"ChannelID",
"type":"int",
"precision":10
},
{
"name":"ChannelName",
"type":"varchar"
},
{
"name":"SubChannelID",
"type":"int",
"precision":10
},
{
"name":"SubChannelName",
"type":"varchar"
},
{
"name":"ApplicationID",
"type":"int",
"precision":10
},
{
"name":"ApplicationName",
"type":"varchar"
},
{
"name":"MarketingUnitID",
"type":"int",
"precision":10
},
{
"name":"MarketingUnitName",
"type":"varchar"
},
{
"name":"VendorPortalProfileGuid",
"type":"uniqueidentifier"
}
],
"typeProperties":{
"schema":"dbo",
"table":"Campaign"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimCampaign2')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"TrackID",
"type":"uniqueidentifier"
},
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorID",
"type":"int",
"precision":10
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"ChannelID",
"type":"int",
"precision":10
},
{
"name":"ChannelName",
"type":"varchar"
},
{
"name":"SubChannelID",
"type":"int",
"precision":10
},
{
"name":"SubChannelName",
"type":"varchar"
},
{
"name":"ApplicationID",
"type":"int",
"precision":10
},
{
"name":"ApplicationName",
"type":"varchar"
},
{
"name":"MarketingUnitID",
"type":"int",
"precision":10
},
{
"name":"MarketingUnitName",
"type":"varchar"
},
{
"name":"VendorPortalProfileGuid",
"type":"uniqueidentifier"
},
{
"name":"HashDW",
"type":"varchar"
},
{
"name":"InsertedDate",
"type":"datetime",
"precision":23,
"scale":3
},
{
"name":"UpatedDate",
"type":"datetime",
"precision":23,
"scale":3
}
],
"typeProperties":{
"schema":"dim",
"table":"Campaign"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dimDate')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"DateDimID",
"type":"int",
"precision":10
},
{
"name":"ISO8601Date",
"type":"date"
},
{
"name":"DayInYearNumber",
"type":"smallint",
"precision":5
},
{
"name":"DayInMonthNumber",
"type":"tinyint",
"precision":3
},
{
"name":"DayInWeekNumber",
"type":"tinyint",
"precision":3
},
{
"name":"DayInWeekName",
"type":"nvarchar"
},
{
"name":"WeekInYearNumber",
"type":"tinyint",
"precision":3
},
{
"name":"WeekInMonthNumber",
"type":"tinyint",
"precision":3
},
{
"name":"MonthInYearNumber",
"type":"tinyint",
"precision":3
},
{
"name":"MonthInYearName",
"type":"nvarchar"
},
{
"name":"QuarterInYearNumber",
"type":"tinyint",
"precision":3
},
{
"name":"YearNumber",
"type":"smallint",
"precision":5
},
{
"name":"FirstDayWeekDate",
"type":"date"
},
{
"name":"LastDayInWeekDate",
"type":"date"
},
{
"name":"FirstDayOfMonthDate",
"type":"date"
},
{
"name":"LastDayOfMonthDate",
"type":"date"
}
],
"typeProperties":{
"schema":"dbo",
"table":"dim_Date"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dstCampaignBefore')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"TrackID",
"type":"uniqueidentifier"
},
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorID",
"type":"int",
"precision":10
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"ChannelID",
"type":"int",
"precision":10
},
{
"name":"ChannelName",
"type":"varchar"
},
{
"name":"SubChannelID",
"type":"int",
"precision":10
},
{
"name":"SubChannelName",
"type":"varchar"
},
{
"name":"ApplicationID",
"type":"int",
"precision":10
},
{
"name":"ApplicationName",
"type":"varchar"
},
{
"name":"MarketingUnitID",
"type":"int",
"precision":10
},
{
"name":"MarketingUnitName",
"type":"varchar"
},
{
"name":"VendorPortalProfileGuid",
"type":"uniqueidentifier"
}
],
"typeProperties":{
"schema":"Staging",
"table":"Campaign"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dstCampaignRef')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"TrackID",
"type":"uniqueidentifier"
},
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorID",
"type":"int",
"precision":10
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"ChannelID",
"type":"int",
"precision":10
},
{
"name":"ChannelName",
"type":"varchar"
},
{
"name":"SubChannelID",
"type":"int",
"precision":10
},
{
"name":"SubChannelName",
"type":"varchar"
},
{
"name":"ApplicationID",
"type":"int",
"precision":10
},
{
"name":"ApplicationName",
"type":"varchar"
},
{
"name":"MarketingUnitID",
"type":"int",
"precision":10
},
{
"name":"MarketingUnitName",
"type":"varchar"
},
{
"name":"VendorPortalProfileGuid",
"type":"uniqueidentifier"
}
],
"typeProperties":{
"schema":"dbo",
"table":"Campaign"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dstFactCliks')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignTrackID",
"type":"uniqueidentifier"
},
{
"name":"CreatedDate",
"type":"date"
},
{
"name":"CampaignDimID",
"type":"int",
"precision":10
},
{
"name":"DateDimID",
"type":"int",
"precision":10
},
{
"name":"Clicks",
"type":"int",
"precision":10
},
{
"name":"Revenue",
"type":"float",
"precision":15
}
],
"typeProperties":{
"schema":"fact",
"table":"MediaAlpha_Clicks"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/dstStagingClicks')]",
"type":"Microsoft.Synapse/workspaces/datasets",
"apiVersion":"2019-06-01-preview",
"properties":{
"linkedServiceName":{
"referenceName":"AzureSynapseAnalytics",
"type":"LinkedServiceReference"
},
"folder":{
"name":"DataFlow"
},
"annotations":[],
"type":"AzureSqlDWTable",
"schema":[
{
"name":"CampaignName",
"type":"varchar"
},
{
"name":"VendorName",
"type":"varchar"
},
{
"name":"DataPointDate",
"type":"date"
},
{
"name":"CampaignTrackId",
"type":"uniqueidentifier"
},
{
"name":"Clicks",
"type":"int",
"precision":10
},
{
"name":"Revenue",
"type":"decimal",
"precision":38,
"scale":2
}
],
"typeProperties":{
"schema":"Staging",
"table":"Clicks"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/linkedServices/AzureSynapseAnalytics')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/AzureSynapseAnalytics')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"AzureSqlDW",
"typeProperties":{
"connectionString":{
"type":"AzureKeyVaultSecret",
"store":{
"referenceName":"Eddy_Keyvault",
"type":"LinkedServiceReference"
},
"secretName":"[parameters('AzureSynapseAnalytics_properties_typeProperties_connectionString_secretName')]"
}
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]",
"[concat(variables('workspaceId'),'/linkedServices/Eddy_Keyvault')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/EddyAzureDatabricks')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"AzureDatabricks",
"typeProperties":{
"domain":"https://adb-5714920705690739.19.azuredatabricks.net",
"authentication":"MSI",
"workspaceResourceId":"/subscriptions/ae8b7cc3-ab40-4b87-b23c-a4539912ef91/resourceGroups/RG-Reporting/providers/Microsoft.Databricks/workspaces/databricks-eddydev",
"existingClusterId":"0406-022642-lakes765"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/EddyPowerBIProUsersWorkspace')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"PowerBIWorkspace",
"typeProperties":{
"workspaceID":"0836e82b-2041-4e98-89ef-103e02433191",
"tenantID":"1fe36d49-b4c7-41a0-ad49-0fd621b8de98"
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/Eddy_Keyvault')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"AzureKeyVault",
"typeProperties":{
"baseUrl":"[parameters('Eddy_Keyvault_properties_typeProperties_baseUrl')]"
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/HTTP_SuperMetrics')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"metrics":{
"type":"string"
},
"dimensions":{
"type":"string"
},
"start_date":{
"type":"string"
},
"end_date":{
"type":"string"
},
"settings":{
"type":"string"
},
"profiles":{
"type":"string"
},
"datasource":{
"type":"string"
},
"dsuser":{
"type":"string"
}
},
"annotations":[],
"type":"HttpServer",
"typeProperties":{
"url":"[parameters('HTTP_SuperMetrics_properties_typeProperties_url')]",
"enableServerCertificateValidation":true,
"authenticationType":"Anonymous"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/HTTP_SuperMetrics_Analytics')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"appid":{
"type":"string"
},
"metrics":{
"type":"string"
},
"dimensions":{
"type":"string"
},
"start_date":{
"type":"string"
},
"end_date":{
"type":"string"
},
"profiles":{
"type":"string"
},
"datasource":{
"type":"string"
},
"dsuser":{
"type":"string"
}
},
"annotations":[],
"type":"HttpServer",
"typeProperties":{
"url":"[parameters('HTTP_SuperMetrics_Analytics_properties_typeProperties_url')]",
"enableServerCertificateValidation":true,
"authenticationType":"Anonymous"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/RestService_MediaAlpha')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"start_date":{
"type":"string"
},
"end_date":{
"type":"string"
},
"metrics":{
"type":"string"
}
},
"annotations":[],
"type":"RestService",
"typeProperties":{
"url":"[parameters('RestService_MediaAlpha_properties_typeProperties_url')]",
"enableServerCertificateValidation":true,
"authenticationType":"Anonymous"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_Reportcluster01')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"DataBaseName":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServer",
"typeProperties":{
"connectionString":"[parameters('SqlServer_Reportcluster01_connectionString')]",
"userName":"[parameters('SqlServer_Reportcluster01_properties_typeProperties_userName')]",
"password":{
"type":"AzureKeyVaultSecret",
"store":{
"referenceName":"Eddy_Keyvault",
"type":"LinkedServiceReference"
},
"secretName":"SynapseLinkedServicePasswd"
}
},
"connectVia":{
"referenceName":"SelfHostedPavel",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/SelfHostedPavel')]",
"[concat(variables('workspaceId'),'/linkedServices/Eddy_Keyvault')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_eddyinfraag')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"DataBaseName":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServer",
"typeProperties":{
"connectionString":"[parameters('SqlServer_eddyinfraag_connectionString')]",
"userName":"[parameters('SqlServer_eddyinfraag_properties_typeProperties_userName')]",
"password":{
"type":"AzureKeyVaultSecret",
"store":{
"referenceName":"Eddy_Keyvault",
"type":"LinkedServiceReference"
},
"secretName":"SynapseLinkedServicePasswd"
}
},
"connectVia":{
"referenceName":"IntegrationRuntimeSelfHosted",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/IntegrationRuntimeSelfHosted')]",
"[concat(variables('workspaceId'),'/linkedServices/Eddy_Keyvault')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/SqlServer_isdb')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"DataBaseName":{
"type":"string"
}
},
"annotations":[],
"type":"SqlServer",
"typeProperties":{
"connectionString":"[parameters('SqlServer_isdb_connectionString')]",
"userName":"[parameters('SqlServer_isdb_properties_typeProperties_userName')]",
"password":{
"type":"AzureKeyVaultSecret",
"store":{
"referenceName":"Eddy_Keyvault",
"type":"LinkedServiceReference"
},
"secretName":"SynapseLinkedServicePasswd"
}
},
"connectVia":{
"referenceName":"IntegrationRuntimeSelfHosted",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/IntegrationRuntimeSelfHosted')]",
"[concat(variables('workspaceId'),'/linkedServices/Eddy_Keyvault')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/eddydevsynapse-WorkspaceDefaultSqlServer')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"parameters":{
"DBName":{
"type":"String"
}
},
"annotations":[],
"type":"AzureSqlDW",
"typeProperties":{
"connectionString":"[parameters('eddydevsynapse-WorkspaceDefaultSqlServer_connectionString')]"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/eddydevsynapse-WorkspaceDefaultStorage')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"AzureBlobFS",
"typeProperties":{
"url":"[parameters('eddydevsynapse-WorkspaceDefaultStorage_properties_typeProperties_url')]"
},
"connectVia":{
"referenceName":"AutoResolveIntegrationRuntime",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/AutoResolveIntegrationRuntime')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/reportcluster01_Tallan')]",
"type":"Microsoft.Synapse/workspaces/linkedServices",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"type":"SqlServer",
"typeProperties":{
"connectionString":"[parameters('reportcluster01_Tallan_connectionString')]",
"userName":"[parameters('reportcluster01_Tallan_properties_typeProperties_userName')]",
"password":{
"type":"AzureKeyVaultSecret",
"store":{
"referenceName":"Eddy_Keyvault",
"type":"LinkedServiceReference"
},
"secretName":"SynapseLinkedServicePasswd"
}
},
"connectVia":{
"referenceName":"IntegrationRuntimeSelfHosted",
"type":"IntegrationRuntimeReference"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/integrationRuntimes/IntegrationRuntimeSelfHosted')]",
"[concat(variables('workspaceId'),'/linkedServices/Eddy_Keyvault')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/2am')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-07-21T17:00:00",
"timeZone":"EasternStandardTime",
"schedule":{
"hours":[
2
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/20Minutes')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-07-09T11:31:00",
"timeZone":"EasternStandardTime",
"schedule":{
"minutes":[
0,
20,
40
],
"hours":[
7,
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/3am')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-07-09T11:30:00",
"timeZone":"EasternStandardTime",
"schedule":{
"hours":[
3
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/30Minutes')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-07-08T20:23:00",
"timeZone":"EasternStandardTime",
"schedule":{
"minutes":[
10,
40
],
"hours":[
7,
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/4am')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-07-21T22:27:00",
"timeZone":"EasternStandardTime",
"schedule":{
"hours":[
4
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/AdNetwork_AdContent')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[
{
"pipelineReference":{
"referenceName":"AdContent_Import",
"type":"PipelineReference"
},
"parameters":{
"sourceFileName":"[parameters('AdNetwork_AdContent_properties_AdContent_Import_parameters_sourceFileName')]"
}
}
],
"type":"BlobEventsTrigger",
"typeProperties":{
"blobPathBeginsWith":"/datalake/blobs/IG/landing/AdNetwork/AdContent",
"blobPathEndsWith":".csv",
"ignoreEmptyBlobs":true,
"scope":"[parameters('AdNetwork_AdContent_properties_typeProperties_scope')]",
"events":[
"Microsoft.Storage.BlobCreated"
]
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/AdContent_Import')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Every3hoursbetween9amto6pm')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[
{
"pipelineReference":{
"referenceName":"StageandCurateTarget",
"type":"PipelineReference"
},
"parameters":{}
}
],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-08-20T14:01:00",
"timeZone":"EasternStandardTime",
"schedule":{
"hours":[
9,
12,
15,
18
]
}
}
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/StageandCurateTarget')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Hourly')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"ScheduleTrigger",
"typeProperties":{
"recurrence":{
"frequency":"Day",
"interval":1,
"startTime":"2021-03-10T15:58:00",
"timeZone":"EasternStandardTime",
"schedule":{
"minutes":[
5
],
"hours":[
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21
]
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/ManagementFees')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[
{
"pipelineReference":{
"referenceName":"MainManagementFees",
"type":"PipelineReference"
},
"parameters":{}
}
],
"type":"BlobEventsTrigger",
"typeProperties":{
"blobPathBeginsWith":"/datalake/blobs/EMS/landing/fees",
"blobPathEndsWith":".csv",
"ignoreEmptyBlobs":true,
"scope":"[parameters('ManagementFees_properties_typeProperties_scope')]",
"events":[
"Microsoft.Storage.BlobCreated"
]
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainManagementFees')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/PerformanceFiles')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[
{
"pipelineReference":{
"referenceName":"MainPerformanceData",
"type":"PipelineReference"
},
"parameters":{
"SourceFileName":"[parameters('PerformanceFiles_properties_MainPerformanceData_parameters_SourceFileName')]"
}
}
],
"type":"BlobEventsTrigger",
"typeProperties":{
"blobPathBeginsWith":"/datalake/blobs/EMS/landing/performance",
"blobPathEndsWith":".xlsx",
"ignoreEmptyBlobs":true,
"scope":"[parameters('PerformanceFiles_properties_typeProperties_scope')]",
"events":[
"Microsoft.Storage.BlobCreated"
]
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/MainPerformanceData')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/TargetFiles')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[],
"type":"BlobEventsTrigger",
"typeProperties":{
"blobPathBeginsWith":"/datalake/blobs/EMS/landing/target",
"blobPathEndsWith":".csv",
"ignoreEmptyBlobs":true,
"scope":"[parameters('TargetFiles_properties_typeProperties_scope')]",
"events":[
"Microsoft.Storage.BlobCreated"
]
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/utmtriggertest')]",
"type":"Microsoft.Synapse/workspaces/triggers",
"apiVersion":"2019-06-01-preview",
"properties":{
"annotations":[],
"runtimeState":"Stopped",
"pipelines":[
{
"pipelineReference":{
"referenceName":"TriggerStorageEvent",
"type":"PipelineReference"
},
"parameters":{}
}
],
"type":"BlobEventsTrigger",
"typeProperties":{
"blobPathBeginsWith":"/datalake/blobs/EMS/landing/utm",
"blobPathEndsWith":".csv",
"ignoreEmptyBlobs":true,
"scope":"[parameters('utmtriggertest_properties_typeProperties_scope')]",
"events":[
"Microsoft.Storage.BlobCreated"
]
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/pipelines/TriggerStorageEvent')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/AutoResolveIntegrationRuntime')]",
"type":"Microsoft.Synapse/workspaces/integrationRuntimes",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"Managed",
"typeProperties":{
"computeProperties":{
"location":"AutoResolve",
"dataFlowProperties":{
"computeType":"General",
"coreCount":8,
"timeToLive":0
}
}
}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/IntegrationRuntimeSelfHosted')]",
"type":"Microsoft.Synapse/workspaces/integrationRuntimes",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"SelfHosted",
"typeProperties":{}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/SelfHostedPavel')]",
"type":"Microsoft.Synapse/workspaces/integrationRuntimes",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"SelfHosted",
"typeProperties":{}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CR_DF')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"StagingClientRelationship",
"type":"DatasetReference"
},
"name":"CRStaging"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"DimCR"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"MaxKey"
}
],
"sinks":[
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"Select1"
},
{
"name":"Join1"
},
{
"name":"Lookup1"
},
{
"name":"ConditionalSplit1"
},
{
"name":"DerivedColumn1"
}
],
"script":"source(output(\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false)~>CRStaging\nsource(output(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false)~>DimCR\nsource(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tquery:'\\nSelectmax(ClientRelationshipdimID)asMaxKey\\nfromdim.ClientRelationship',\n\tformat:'query',\n\tstaged:false)~>MaxKey\nDimCRselect(mapColumn(\n\t\tDimClientRelationshipdimID=ClientRelationshipdimID,\n\t\tDimClientRelationshipID=ClientRelationshipID,\n\t\tDimClientID=ClientID,\n\t\tDimClientName=ClientName,\n\t\tDimInstitutionID=InstitutionID,\n\t\tDimInstitutionName=InstitutionName,\n\t\tDimAccountManagerId=AccountManagerId,\n\t\tDimAccountManager=AccountManager,\n\t\tDimAccountCoordinatorId=AccountCoordinatorId,\n\t\tDimAccountCooridator=AccountCooridator,\n\t\tDimInstitutionIncorporationTypeId=InstitutionIncorporationTypeId,\n\t\tDimInstitutionIncorporationTypeName=InstitutionIncorporationTypeName,\n\t\tDimisActive=isActive,\n\t\tDimEffDate=EffDate,\n\t\tDimExpDate=ExpDate,\n\t\tDimModTime=ModTime\n\t),\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true)~>Select1\nCRStaging,MaxKeyjoin(1==1,\n\tjoinType:'cross',\n\tbroadcast:'auto')~>Join1\nJoin1,Select1lookup(ClientRelationshipID==DimClientRelationshipID,\n\tmultiple:false,\n\tpickup:'any',\n\tbroadcast:'auto')~>Lookup1\nLookup1split(isNull(DimClientRelationshipID),\n\tdisjoint:false)~>ConditionalSplit1@(New,Exist)\nConditionalSplit1@Newderive(NewisActive=1,\n\t\tNewEffDate=toDate('1/1/2020','MM/dd/yyyy'),\n\t\tNewExpDate=toDate('1/1/2050','MM/dd/yyyy'),\n\t\tNewModTime=currentDate())~>DerivedColumn1\nDerivedColumn1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClientRelationshipID,\n\t\tClientID,\n\t\tClientName,\n\t\tInstitutionID,\n\t\tInstitutionName,\n\t\tAccountManagerId,\n\t\tAccountManager,\n\t\tAccountCoordinatorId,\n\t\tAccountCooridator,\n\t\tInstitutionIncorporationTypeId,\n\t\tInstitutionIncorporationTypeName,\n\t\tisActive=NewisActive,\n\t\tEffDate=NewEffDate,\n\t\tExpDate=NewExpDate,\n\t\tModTime=NewModTime\n\t))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/StagingClientRelationship')]",
"[concat(variables('workspaceId'),'/datasets/DimClientRelationship')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Campaign')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"dstCampaignBefore",
"type":"DatasetReference"
},
"name":"preCampaign"
},
{
"dataset":{
"referenceName":"dstCampaignRef",
"type":"DatasetReference"
},
"name":"CampaignRef"
}
],
"sinks":[
{
"dataset":{
"referenceName":"dstCampaignRef",
"type":"DatasetReference"
},
"name":"CampaignDim"
},
{
"dataset":{
"referenceName":"dstCampaignRef",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"Exists1"
},
{
"name":"Exists2"
},
{
"name":"UpdateRows"
}
],
"script":"source(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>preCampaign\nsource(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>CampaignRef\npreCampaign,CampaignRefexists(preCampaign@TrackID==CampaignRef@TrackID,\n\tnegate:true,\n\tbroadcast:'auto')~>Exists1\npreCampaign,CampaignRefexists(preCampaign@TrackID==CampaignRef@TrackID,\n\tnegate:false,\n\tbroadcast:'auto')~>Exists2\nExists2alterRow(updateIf(1==1),\n\tpartitionBy('hash',1))~>UpdateRows\nExists1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tTrackID,\n\t\tCampaignName,\n\t\tVendorID,\n\t\tVendorName,\n\t\tChannelID,\n\t\tChannelName,\n\t\tSubChannelID,\n\t\tSubChannelName,\n\t\tApplicationID,\n\t\tApplicationName,\n\t\tMarketingUnitID,\n\t\tMarketingUnitName,\n\t\tVendorPortalProfileGuid\n\t))~>CampaignDim\nUpdateRowssink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['TrackID'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tTrackID,\n\t\tCampaignName,\n\t\tVendorID,\n\t\tVendorName,\n\t\tChannelID,\n\t\tChannelName,\n\t\tSubChannelID,\n\t\tSubChannelName,\n\t\tApplicationID,\n\t\tApplicationName,\n\t\tMarketingUnitID,\n\t\tMarketingUnitName,\n\t\tVendorPortalProfileGuid\n\t),\n\tpartitionBy('hash',1))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/dstCampaignBefore')]",
"[concat(variables('workspaceId'),'/datasets/dstCampaignRef')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/CheckForLeads')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference"
},
"name":"source1"
}
],
"sinks":[
{
"dataset":{
"referenceName":"datalake_csv_dataflow_sink",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"MapDrifted1",
"description":"Createsanexplicitmappingforeachdriftedcolumn"
},
{
"name":"Filter1"
}
],
"script":"source(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tignoreNoFilesFound:false)~>source1\nsource1derive(Campaign=toString(byName('Campaign')),\n\t\t{Pagepath}=toString(byName('Pagepath')),\n\t\t{Source&medium}=toString(byName('Source&medium')),\n\t\t{Devicecategory}=toString(byName('Devicecategory')),\n\t\t{Channelgroup}=toString(byName('Channelgroup')),\n\t\tKeyword=toString(byName('Keyword')),\n\t\t{Admatchtype}=toString(byName('Admatchtype')),\n\t\tBrowser=toString(byName('Browser')),\n\t\t{Uniquepageviews}=toString(byName('Uniquepageviews')))~>MapDrifted1\nMapDrifted1filter(like({Pagepath},\"%EILMLeadID=%\"))~>Filter1\nFilter1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tpartitionFileNames:['UTMDataFixFiltered.csv'],\n\tumask:0022,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\tpartitionBy('hash',1))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv_dataflow_sink')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DF_DimClientRelationship')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"DimClientRelationship"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"MaxKey"
},
{
"dataset":{
"referenceName":"StagingClientRelationship",
"type":"DatasetReference"
},
"name":"StgClientRelatoinship"
}
],
"sinks":[
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"sink1"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"sink5"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"sink7"
}
],
"transformations":[
{
"name":"SelectRename"
},
{
"name":"JoinMaxKey"
},
{
"name":"Lookup1"
},
{
"name":"ConditionalSplit1"
},
{
"name":"DerivedColumn1"
},
{
"name":"Filter2"
},
{
"name":"DerivedColumn5"
},
{
"name":"DerivedColumn7"
},
{
"name":"MapDrifted2",
"description":"Createsanexplicitmappingforeachdriftedcolumn"
},
{
"name":"AlterRow2"
},
{
"name":"Filter3"
}
],
"script":"source(output(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false)~>DimClientRelationship\nsource(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tquery:'selectmax(ClientRelationshipdimID)asMaxKey\\nfromdim.Clientrelationshipx(nolock)',\n\tformat:'query',\n\tstaged:false,\n\tpartitionBy('hash',1))~>MaxKey\nsource(output(\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>StgClientRelatoinship\nFilter3select(mapColumn(\n\t\tDimClientRelationshipdimID=ClientRelationshipdimID,\n\t\tDimClientRelationshipID=ClientRelationshipID,\n\t\tDimClientID=ClientID,\n\t\tDimClientName=ClientName,\n\t\tDimInstitutionID=InstitutionID,\n\t\tDimInstitutionName=InstitutionName,\n\t\tDimAccountManagerId=AccountManagerId,\n\t\tDimAccountManager=AccountManager,\n\t\tDimAccountCoordinatorId=AccountCoordinatorId,\n\t\tDimAccountCooridator=AccountCooridator,\n\t\tDimInstitutionIncorporationTypeId=InstitutionIncorporationTypeId,\n\t\tDimInstitutionIncorporationTypeName=InstitutionIncorporationTypeName,\n\t\tDimisActive=isActive,\n\t\tDimEffDate=EffDate,\n\t\tDimExpDate=ExpDate,\n\t\tDimModTime=ModTime\n\t),\n\tpartitionBy('hash',1),\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true)~>SelectRename\nStgClientRelatoinship,MaxKeyjoin(1==1,\n\tjoinType:'cross',\n\tbroadcast:'auto')~>JoinMaxKey\nJoinMaxKey,SelectRenamelookup(ClientRelationshipID==DimClientRelationshipID,\n\tmultiple:false,\n\tpickup:'any',\n\tbroadcast:'auto')~>Lookup1\nLookup1split(isNull(DimClientRelationshipID),\n\tdisjoint:false,\n\tpartitionBy('hash',1))~>ConditionalSplit1@(New,Exists)\nConditionalSplit1@Newderive(IsActiveNew=1,\n\t\tEffDate=toDate('1/1/2021','MM/dd/yyyy'),\n\t\tExpDate=toDate('1/1/2050','MM/dd/yyyy'),\n\t\tModDate=currentDate())~>DerivedColumn1\nConditionalSplit1@Existsfilter(ClientRelationshipID==DimClientRelationshipID&&\r\n(\r\nAccountManagerId!=DimAccountManagerId||\r\nClientID!=DimClientID\r\n),\n\tpartitionBy('hash',1))~>Filter2\nFilter2derive(IsActiveInsert=1,\n\t\tEffDateInsert=currentDate(),\n\t\tExpDateInsert=toDate('1/1/2050','MM/dd/yyyy'),\n\t\tModDateInsert=currentDate())~>DerivedColumn5\nFilter2derive(IsActiveUpate=0,\n\t\tExpDateUpdate=currentDate(),\n\t\tModDateUpdate=currentDate(),\n\tpartitionBy('hash',1))~>DerivedColumn7\nDerivedColumn7derive(MaxKey=toInteger(byName('MaxKey')))~>MapDrifted2\nMapDrifted2alterRow(updateIf(DimClientRelationshipdimID<=MaxKey))~>AlterRow2\nDimClientRelationshipfilter(iif(isNull(isActive),1,isActive)==1)~>Filter3\nDerivedColumn1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClientRelationshipID,\n\t\tClientID,\n\t\tClientName,\n\t\tInstitutionID,\n\t\tInstitutionName,\n\t\tAccountManagerId,\n\t\tAccountManager,\n\t\tAccountCoordinatorId,\n\t\tAccountCooridator,\n\t\tInstitutionIncorporationTypeId,\n\t\tInstitutionIncorporationTypeName,\n\t\tisActive=IsActiveNew,\n\t\tEffDate,\n\t\tExpDate,\n\t\tModTime=ModDate\n\t),\n\tpartitionBy('hash',1))~>sink1\nDerivedColumn5sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClientRelationshipID,\n\t\tClientID,\n\t\tClientName,\n\t\tInstitutionID,\n\t\tInstitutionName,\n\t\tAccountManagerId,\n\t\tAccountManager,\n\t\tAccountCoordinatorId,\n\t\tAccountCooridator,\n\t\tInstitutionIncorporationTypeId,\n\t\tInstitutionIncorporationTypeName,\n\t\tisActive=IsActiveInsert,\n\t\tEffDate=EffDateInsert,\n\t\tExpDate=ExpDateInsert,\n\t\tModTime=ModDateInsert\n\t),\n\tpartitionBy('hash',1))~>sink5\nAlterRow2sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['ClientRelationshipdimID'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClientRelationshipdimID=DimClientRelationshipdimID,\n\t\tisActive=IsActiveUpate,\n\t\tExpDate=ExpDateUpdate,\n\t\tModTime=ModDateUpdate\n\t))~>sink7"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/DimClientRelationship')]",
"[concat(variables('workspaceId'),'/datasets/StagingClientRelationship')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/DataFlow_FilterAndConditional')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"datalake_csv",
"type":"DatasetReference"
},
"name":"source1"
}
],
"sinks":[
{
"dataset":{
"referenceName":"datalake_csv_dataflow_sink",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"ConditionalSplit1"
},
{
"name":"MapDrifted1",
"description":"Createsanexplicitmappingforeachdriftedcolumn"
},
{
"name":"Filter1"
}
],
"script":"source(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tignoreNoFilesFound:false)~>source1\nFilter1split(like({Pagepath},\"%EILMLeadID=%\"),\n\tdisjoint:true)~>ConditionalSplit1@(WithLeadid,WithoutLeadid)\nsource1derive(Campaign=toString(byName('Campaign')),\n\t\t{Pagepath}=toString(byName('Pagepath')),\n\t\t{Source&medium}=toString(byName('Source&medium')),\n\t\t{Devicecategory}=toString(byName('Devicecategory')),\n\t\t{Channelgroup}=toString(byName('Channelgroup')),\n\t\tKeyword=toString(byName('Keyword')),\n\t\t{Admatchtype}=toString(byName('Admatchtype')),\n\t\tBrowser=toString(byName('Browser')),\n\t\t{Uniquepageviews}=toString(byName('Uniquepageviews')))~>MapDrifted1\nMapDrifted1filter(like({Pagepath},\"%EILMLeadID=%\"))~>Filter1\nConditionalSplit1@WithLeadidsink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tpartitionFileNames:['UTMDataFixFiltered.csv'],\n\tumask:0022,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\tpartitionBy('hash',1))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/datalake_csv')]",
"[concat(variables('workspaceId'),'/datasets/datalake_csv_dataflow_sink')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/Dataflow1')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"dimCampaign2",
"type":"DatasetReference"
},
"name":"dimCampaign"
},
{
"dataset":{
"referenceName":"dstCampaignBefore",
"type":"DatasetReference"
},
"name":"StagngCampaign"
}
],
"sinks":[
{
"dataset":{
"referenceName":"dimCampaign2",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"NoExists"
},
{
"name":"LookupDates"
},
{
"name":"SetAttributes"
},
{
"name":"AlterRow1"
},
{
"name":"CreateHash"
},
{
"name":"StrTrackID"
}
],
"script":"source(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring,\n\t\tHashDWasstring,\n\t\tInsertedDateastimestamp,\n\t\tUpatedDateastimestamp\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>dimCampaign\nsource(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>StagngCampaign\nCreateHash,dimCampaignexists(CreateHash@HashDW==dimCampaign@HashDW,\n\tnegate:true,\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>NoExists\nNoExists,dimCampaignlookup(StagngCampaign@TrackID==dimCampaign@TrackID,\n\tmultiple:false,\n\tpickup:'any',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>LookupDates\nLookupDatesderive(InsertedDate=iif(isNull(InsertedDate),currentTimestamp(),InsertedDate),\n\t\tUpatedDate=currentTimestamp(),\n\tpartitionBy('hash',1))~>SetAttributes\nSetAttributesalterRow(upsertIf(true()),\n\tpartitionBy('hash',1))~>AlterRow1\nStrTrackIDderive(HashDW=sha1(strTrackID+CampaignName+VendorName+ChannelName+SubChannelName+ApplicationName+MarketingUnitName),\n\tpartitionBy('hash',1))~>CreateHash\nStagngCampaignderive(strTrackID=toString(TrackID),\n\tpartitionBy('hash',1))~>StrTrackID\nAlterRow1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring,\n\t\tHashDWasstring,\n\t\tInsertedDateastimestamp,\n\t\tUpatedDateastimestamp\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['TrackID'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tTrackID=StagngCampaign@TrackID,\n\t\tCampaignName=StagngCampaign@CampaignName,\n\t\tVendorID=StagngCampaign@VendorID,\n\t\tVendorName=StagngCampaign@VendorName,\n\t\tChannelID=StagngCampaign@ChannelID,\n\t\tChannelName=StagngCampaign@ChannelName,\n\t\tSubChannelID=StagngCampaign@SubChannelID,\n\t\tSubChannelName=StagngCampaign@SubChannelName,\n\t\tApplicationID=StagngCampaign@ApplicationID,\n\t\tApplicationName=StagngCampaign@ApplicationName,\n\t\tMarketingUnitID=StagngCampaign@MarketingUnitID,\n\t\tMarketingUnitName=StagngCampaign@MarketingUnitName,\n\t\tVendorPortalProfileGuid=StagngCampaign@VendorPortalProfileGuid,\n\t\tInsertedDate,\n\t\tUpatedDate,\n\t\tHashDW=CreateHash@HashDW\n\t),\n\tpartitionBy('hash',1))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/dimCampaign2')]",
"[concat(variables('workspaceId'),'/datasets/dstCampaignBefore')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlpha_Clicks')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"ASAStagingMediaAlphaClicks",
"type":"DatasetReference"
},
"name":"StagingMediaAlphaClicks"
},
{
"dataset":{
"referenceName":"dimCampaign",
"type":"DatasetReference"
},
"name":"DimCampaign"
},
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"FactMediaAlphaClicks"
}
],
"sinks":[
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"sink1"
},
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"sink2"
},
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"sink3"
}
],
"transformations":[
{
"name":"Lookup1"
},
{
"name":"SelectOrignalData"
},
{
"name":"CheckForUnknownDimCampaign"
},
{
"name":"Aggregate1"
},
{
"name":"Join1"
},
{
"name":"Exists1"
},
{
"name":"Exists2"
},
{
"name":"SelectFactMediaAlphaClicks"
},
{
"name":"Join2"
},
{
"name":"Aggregate2"
},
{
"name":"Join3"
},
{
"name":"AlterRow1"
},
{
"name":"Filter2"
},
{
"name":"Lookup2"
},
{
"name":"Filter3"
},
{
"name":"AlterRow2"
},
{
"name":"Filter4"
}
],
"script":"source(output(\n\t\tCampaignNameasstring,\n\t\tVendorNameasstring,\n\t\tDataPointDateasdate,\n\t\tCampaignTrackIdasstring,\n\t\tClicksasinteger,\n\t\tRevenueasdecimal(38,2)\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>StagingMediaAlphaClicks\nsource(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>DimCampaign\nsource(output(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>FactMediaAlphaClicks\nExists1,DimCampaignlookup(CampaignTrackId==TrackID,\n\tmultiple:false,\n\tpickup:'any',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Lookup1\nLookup1select(mapColumn(\n\t\tDataPointDate,\n\t\tCampaignTrackId,\n\t\tClicks,\n\t\tRevenue,\n\t\tCampaignDimID\n\t),\n\tpartitionBy('hash',1),\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true)~>SelectOrignalData\nLookup1derive(CampaignTrackId=iif(isNull(TrackID),\"11111111-1111-1111-1111-111111111111\",TrackID),\n\tpartitionBy('hash',1))~>CheckForUnknownDimCampaign\nCheckForUnknownDimCampaignaggregate(groupBy(DataPointDate,\n\t\tCampaignTrackId),\n\tTotalClicks=sum(Clicks),\n\t\tTotalRevenue=sum(Revenue),\n\tpartitionBy('hash',1))~>Aggregate1\nAggregate1,SelectOrignalDatajoin(Aggregate1@CampaignTrackId==SelectOrignalData@CampaignTrackId\n\t&&Aggregate1@DataPointDate==SelectOrignalData@DataPointDate,\n\tjoinType:'inner',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Join1\nStagingMediaAlphaClicks,FactMediaAlphaClicksexists(StagingMediaAlphaClicks@CampaignTrackId==FactMediaAlphaClicks@CampaignTrackID\n\t&&DataPointDate==CreatedDate,\n\tnegate:true,\n\tbroadcast:'auto')~>Exists1\nStagingMediaAlphaClicks,FactMediaAlphaClicksexists(StagingMediaAlphaClicks@CampaignTrackId==FactMediaAlphaClicks@CampaignTrackID\n\t&&DataPointDate==CreatedDate,\n\tnegate:false,\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Exists2\nFactMediaAlphaClicksselect(mapColumn(\n\t\tFactCampaignTrackID=CampaignTrackID,\n\t\tFactCreatedDate=CreatedDate,\n\t\tFactCampaignDimID=CampaignDimID,\n\t\tFactDateDimID=DateDimID,\n\t\tFactClicks=Clicks,\n\t\tFactRevenue=Revenue\n\t),\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true)~>SelectFactMediaAlphaClicks\nExists2,SelectFactMediaAlphaClicksjoin(CampaignTrackId==FactCampaignTrackID\n\t&&DataPointDate==FactCreatedDate,\n\tjoinType:'inner',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Join2\nJoin2aggregate(groupBy(DataPointDate,\n\t\tCampaignTrackId),\n\tTotalClicks=sum(Clicks),\n\t\tTotalRevenue=sum(Revenue),\n\tpartitionBy('hash',1))~>Aggregate2\nAggregate2,SelectFactMediaAlphaClicksjoin(DataPointDate==FactCreatedDate\n\t&&CampaignTrackId==FactCampaignTrackID,\n\tjoinType:'inner',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Join3\nFilter4alterRow(updateIf(1==1))~>AlterRow1\nJoin2filter(FactCampaignTrackID==\"11111111-1111-1111-1111-111111111111\")~>Filter2\nFilter2,DimCampaignlookup(CampaignTrackId==TrackID,\n\tmultiple:false,\n\tpickup:'any',\n\tbroadcast:'auto')~>Lookup2\nLookup2filter(TrackID!='11111111-1111-1111-1111-111111111111')~>Filter3\nFilter3alterRow(updateIf(1==1))~>AlterRow2\nJoin3filter(CampaignTrackId==FactCampaignTrackID&&DataPointDate==FactCreatedDate&&\r\n(\r\nTotalRevenue!=FactRevenue||\r\nTotalClicks!=FactClicks\r\n))~>Filter4\nJoin1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tCampaignTrackID=Aggregate1@CampaignTrackId,\n\t\tCreatedDate=Aggregate1@DataPointDate,\n\t\tCampaignDimID,\n\t\tClicks=TotalClicks,\n\t\tRevenue=TotalRevenue\n\t),\n\tpartitionBy('hash',1))~>sink1\nAlterRow1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['CampaignTrackID','CreatedDate'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClicks=TotalClicks,\n\t\tRevenue=TotalRevenue,\n\t\tCreatedDate=DataPointDate,\n\t\tCampaignTrackID=CampaignTrackId\n\t),\n\tpartitionBy('hash',1))~>sink2\nAlterRow2sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['CampaignTrackID'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tCampaignDimID,\n\t\tCampaignTrackID=CampaignTrackId\n\t))~>sink3"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/ASAStagingMediaAlphaClicks')]",
"[concat(variables('workspaceId'),'/datasets/dimCampaign')]",
"[concat(variables('workspaceId'),'/datasets/dstFactCliks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/MediaAlpha_Leads')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"ASAStagingMediaAlphaLeads",
"type":"DatasetReference"
},
"name":"SRCStagingMediaAlphaLeads"
},
{
"dataset":{
"referenceName":"DimClientRelationship",
"type":"DatasetReference"
},
"name":"SRCDimClientRelationship"
}
],
"sinks":[
{
"dataset":{
"referenceName":"ASAFactMediaAlphaLeads",
"type":"DatasetReference"
},
"name":"sink1"
}
],
"transformations":[
{
"name":"DerivedColumn1"
},
{
"name":"LookupDimClientRelationship"
},
{
"name":"CheckForUnknownDimensions"
},
{
"name":"SelectOriginalData"
},
{
"name":"Aggregate1"
},
{
"name":"Join1"
}
],
"script":"source(output(\n\t\tCreatedDate_ESTasdate,\n\t\tTrackIdasstring,\n\t\tEstimatedRevShareasdecimal(38,2),\n\t\tCountAgainstCapasinteger,\n\t\tleadidasdecimal(18,0),\n\t\tClientRelationshipIDasinteger\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>SRCStagingMediaAlphaLeads\nsource(output(\n\t\tClientRelationshipdimIDasinteger,\n\t\tClientRelationshipIDasinteger,\n\t\tClientIDasinteger,\n\t\tClientNameasstring,\n\t\tInstitutionIDasinteger,\n\t\tInstitutionNameasstring,\n\t\tAccountManagerIdasinteger,\n\t\tAccountManagerasstring,\n\t\tAccountCoordinatorIdasinteger,\n\t\tAccountCooridatorasstring,\n\t\tInstitutionIncorporationTypeIdasinteger,\n\t\tInstitutionIncorporationTypeNameasstring,\n\t\tisActiveasinteger,\n\t\tEffDateastimestamp,\n\t\tExpDateastimestamp,\n\t\tModTimeastimestamp\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>SRCDimClientRelationship\nSRCStagingMediaAlphaLeadsderive(IsActive=1,\n\tpartitionBy('hash',1))~>DerivedColumn1\nDerivedColumn1,SRCDimClientRelationshiplookup(DerivedColumn1@IsActive==SRCDimClientRelationship@isActive\n\t&&SRCStagingMediaAlphaLeads@ClientRelationshipID==SRCDimClientRelationship@ClientRelationshipID,\n\tmultiple:false,\n\tpickup:'any',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>LookupDimClientRelationship\nLookupDimClientRelationshipderive(ClientRelationshipID=iif(isNull(SRCStagingMediaAlphaLeads@ClientRelationshipID),1,SRCStagingMediaAlphaLeads@ClientRelationshipID),\n\tpartitionBy('hash',1))~>CheckForUnknownDimensions\nLookupDimClientRelationshipselect(mapColumn(\n\t\tCreatedDate_EST,\n\t\tTrackId,\n\t\tEstimatedRevShare,\n\t\tCountAgainstCap,\n\t\tleadid,\n\t\tClientRelationshipID=SRCStagingMediaAlphaLeads@ClientRelationshipID,\n\t\tIsActive=DerivedColumn1@IsActive,\n\t\tClientRelationshipdimID,\n\t\tClientRelationshipID=SRCDimClientRelationship@ClientRelationshipID,\n\t\tClientID,\n\t\tClientName,\n\t\tInstitutionID,\n\t\tInstitutionName,\n\t\tAccountManagerId,\n\t\tAccountManager,\n\t\tAccountCoordinatorId,\n\t\tAccountCooridator,\n\t\tInstitutionIncorporationTypeId,\n\t\tInstitutionIncorporationTypeName,\n\t\tisActive=SRCDimClientRelationship@isActive,\n\t\tEffDate,\n\t\tExpDate,\n\t\tModTime\n\t),\n\tpartitionBy('hash',1),\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true)~>SelectOriginalData\nCheckForUnknownDimensionsaggregate(groupBy(leadid),\n\tTotalEstimatedRevShare=sum(EstimatedRevShare),\n\t\tTotalLeads=count(leadid),\n\tpartitionBy('hash',1))~>Aggregate1\nAggregate1,SelectOriginalDatajoin(Aggregate1@leadid==SelectOriginalData@leadid,\n\tjoinType:'inner',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>Join1\nJoin1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCreatedDate_ESTasdate,\n\t\tCampaignDimIDasinteger,\n\t\tEstimatedRevShareasdecimal(38,2),\n\t\tCountAgainstCapasinteger,\n\t\tleadidasdecimal(18,0),\n\t\tClientRelationshipDimIDasinteger\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tCreatedDate_EST,\n\t\tEstimatedRevShare=TotalEstimatedRevShare,\n\t\tCountAgainstCap,\n\t\tleadid=Aggregate1@leadid,\n\t\tClientRelationshipDimID=ClientRelationshipdimID\n\t),\n\tpartitionBy('hash',1))~>sink1"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/ASAStagingMediaAlphaLeads')]",
"[concat(variables('workspaceId'),'/datasets/DimClientRelationship')]",
"[concat(variables('workspaceId'),'/datasets/ASAFactMediaAlphaLeads')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/df_Facts')]",
"type":"Microsoft.Synapse/workspaces/dataflows",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"type":"MappingDataFlow",
"typeProperties":{
"sources":[
{
"dataset":{
"referenceName":"dstStagingClicks",
"type":"DatasetReference"
},
"name":"ClciksRef"
},
{
"dataset":{
"referenceName":"dimCampaign",
"type":"DatasetReference"
},
"name":"dimCampaign"
},
{
"dataset":{
"referenceName":"dimDate",
"type":"DatasetReference"
},
"name":"dimDate"
},
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"factClicks"
}
],
"sinks":[
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"InsertNew"
},
{
"dataset":{
"referenceName":"dstFactCliks",
"type":"DatasetReference"
},
"name":"Update"
}
],
"transformations":[
{
"name":"NoExists"
},
{
"name":"getCampaigndDmID"
},
{
"name":"GetDateDimID"
},
{
"name":"Exists"
},
{
"name":"Join1"
},
{
"name":"Filter1"
},
{
"name":"AlterRow1"
}
],
"script":"source(output(\n\t\tCampaignNameasstring,\n\t\tVendorNameasstring,\n\t\tDataPointDateasdate,\n\t\tCampaignTrackIdasstring,\n\t\tClicksasinteger,\n\t\tRevenueasdecimal(38,2)\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>ClciksRef\nsource(output(\n\t\tCampaignDimIDasinteger,\n\t\tTrackIDasstring,\n\t\tCampaignNameasstring,\n\t\tVendorIDasinteger,\n\t\tVendorNameasstring,\n\t\tChannelIDasinteger,\n\t\tChannelNameasstring,\n\t\tSubChannelIDasinteger,\n\t\tSubChannelNameasstring,\n\t\tApplicationIDasinteger,\n\t\tApplicationNameasstring,\n\t\tMarketingUnitIDasinteger,\n\t\tMarketingUnitNameasstring,\n\t\tVendorPortalProfileGuidasstring\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>dimCampaign\nsource(output(\n\t\tDateDimIDasinteger,\n\t\tISO8601Dateasdate,\n\t\tDayInYearNumberasinteger,\n\t\tDayInMonthNumberasinteger,\n\t\tDayInWeekNumberasinteger,\n\t\tDayInWeekNameasstring,\n\t\tWeekInYearNumberasinteger,\n\t\tWeekInMonthNumberasinteger,\n\t\tMonthInYearNumberasinteger,\n\t\tMonthInYearNameasstring,\n\t\tQuarterInYearNumberasinteger,\n\t\tYearNumberasinteger,\n\t\tFirstDayWeekDateasdate,\n\t\tLastDayInWeekDateasdate,\n\t\tFirstDayOfMonthDateasdate,\n\t\tLastDayOfMonthDateasdate\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false)~>dimDate\nsource(output(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tallowSchemaDrift:true,\n\tvalidateSchema:false,\n\tisolationLevel:'READ_UNCOMMITTED',\n\tformat:'table',\n\tstaged:false,\n\tpartitionBy('hash',1))~>factClicks\nClciksRef,factClicksexists(ClciksRef@CampaignTrackId==factClicks@CampaignTrackID\n\t&&DataPointDate==CreatedDate,\n\tnegate:true,\n\tbroadcast:'auto')~>NoExists\nNoExists,dimCampaignjoin(CampaignTrackId==TrackID,\n\tjoinType:'left',\n\tpartitionBy('hash',1),\n\tbroadcast:'auto')~>getCampaigndDmID\ngetCampaigndDmID,dimDatejoin(DataPointDate==ISO8601Date,\n\tjoinType:'left',\n\tbroadcast:'auto')~>GetDateDimID\nClciksRef,factClicksexists(ClciksRef@CampaignTrackId==factClicks@CampaignTrackID\n\t&&DataPointDate==CreatedDate,\n\tnegate:false,\n\tbroadcast:'auto')~>Exists\nExists,factClicksjoin(ClciksRef@CampaignTrackId==factClicks@CampaignTrackID\n\t&&DataPointDate==CreatedDate,\n\tjoinType:'inner',\n\tbroadcast:'auto')~>Join1\nJoin1filter(ClciksRef@Clicks!=factClicks@Clicks||ClciksRef@Revenue!=factClicks@Revenue)~>Filter1\nFilter1alterRow(updateIf(1==1))~>AlterRow1\nGetDateDimIDsink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tCampaignTrackID=CampaignTrackId,\n\t\tCreatedDate=DataPointDate,\n\t\tCampaignDimID,\n\t\tDateDimID,\n\t\tClicks,\n\t\tRevenue\n\t))~>InsertNew\nAlterRow1sink(allowSchemaDrift:true,\n\tvalidateSchema:false,\n\tinput(\n\t\tCampaignTrackIDasstring,\n\t\tCreatedDateasdate,\n\t\tCampaignDimIDasinteger,\n\t\tDateDimIDasinteger,\n\t\tClicksasinteger,\n\t\tRevenueasdouble\n\t),\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:true,\n\tupsertable:false,\n\tkeys:['Clicks','Revenue'],\n\tformat:'table',\n\tstaged:true,\n\tallowCopyCommand:true,\n\tskipDuplicateMapInputs:true,\n\tskipDuplicateMapOutputs:true,\n\terrorHandlingOption:'stopOnFirstError',\n\tmapColumn(\n\t\tClicks=ClciksRef@Clicks,\n\t\tRevenue=ClciksRef@Revenue\n\t))~>Update"
}
},
"dependsOn":[
"[concat(variables('workspaceId'),'/datasets/dstStagingClicks')]",
"[concat(variables('workspaceId'),'/datasets/dimCampaign')]",
"[concat(variables('workspaceId'),'/datasets/dimDate')]",
"[concat(variables('workspaceId'),'/datasets/dstFactCliks')]"
]
},
{
"name":"[concat(parameters('workspaceName'),'/WorkspaceSystemIdentity')]",
"type":"Microsoft.Synapse/workspaces/credentials",
"apiVersion":"2019-06-01-preview",
"properties":{
"type":"ManagedIdentity",
"typeProperties":{}
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/Base_External_Resouces')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"select 'hello'",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Inquiry_All')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"--IFNOTEXISTS(SELECT*FROMsys.external_file_formatsWHEREname='SynapseParquetFormat')\n--\tCREATEEXTERNALFILEFORMAT[SynapseParquetFormat]\n--\tWITH(FORMAT_TYPE=PARQUET)\n--GO\n\n--IFNOTEXISTS(SELECT*FROMsys.external_data_sourcesWHEREname='datalake_eddydevlake_dfs_core_windows_net')\n--\tCREATEEXTERNALDATASOURCE[datalake_eddydevlake_dfs_core_windows_net]\n--\tWITH(\n--\t\tLOCATION='abfss://datalake@eddydevlake.dfs.core.windows.net',\n--\t\tTYPE=HADOOP\n--\t)\n--GO\n\nIFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Inquiry_All'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.inquiry_All\nGO\n\nCREATEEXTERNALTABLEdbo.Inquiry_All(\n\t[LeadId]int,\n\t[OrganizationId]int,\n\t[CampusId]varchar(100),\n\t[FormName]varchar(100),\n\t[FirstName]varchar(100),\n\t[LastName]varchar(100),\n\t[Email]varchar(300),\n\t[Phone1]varchar(50),\n\t[Address1]varchar(100),\n\t[City]varchar(100),\n\t[PostalCode]varchar(25),\n\t[StateProvince]varchar(50),\n\t[CountryName]varchar(50),\n\t[ClientDegreeName]varchar(300),\n\t[CreatedDate]datetime2(7),\n\t[DateDelivered]varchar(50),\n\t[DeliveryData]varchar(4000),\n\t[Delivered]varchar(5),\n\t[RealTimeDeliveryStatusName]varchar(100),\n\t[InstitutionId]int,\n\t[Organization]varchar(300),\n\t[Location]varchar(300),\n\t[Campaign]varchar(300),\n\t[CategoryName]varchar(100),\n\t[SubjectName]varchar(100),\n\t[captureurl]varchar(2500),\n\t[Keyword]varchar(300),\n\t[Field17]varchar(1),\n\t[Age]varchar(30),\n\t[utm_medium]varchar(300),\n\t[utm_source]varchar(2000),\n\t[utm_campaign]varchar(300),\n\t[utm_term]varchar(300),\n\t[utm_content]varchar(300),\n\t[cpl]varchar(20),\n\t[ItemGPMappingName]varchar(200),\n\t[AdGroup]varchar(300),\n\t[Affiliate]varchar(100),\n\t[Subvendorcode]varchar(300),\n\t[TrackId]varchar(100),\n\t[EducationLevel]varchar(100),\n\t[MilitaryStatusName]varchar(100),\n\t[ProgramLevelName]varchar(100),\n\t[VendorName]varchar(2000),\n\t[GeoKey]varchar(2000),\n\t[utm_key]varchar(2000),\n\t[DegreeKey]varchar(2000),\n\t[SubVendorKey]varchar(2000),\n\t[SourceFile]varchar(2000),\n\t[SourceSystem]varchar(100),\n\t[SuccessLeads]int,\n\t[InquiryKey]varchar(2000),\n\t[DateDimID]varchar(50),\n\t[ProductLevel]varchar(250)\n\t)\n--\tWITH(\n--\tLOCATION='EMS/curated/inquiry/2021/05/11/data.parquet/part-00000-tid-2933748703121453773-01995e1f-7367-4c3d-89c8-4c24a9f14a9a-65-1-c000.snappy.parquet',\n--\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n--\tFILE_FORMAT=[SynapseParquetFormat],\n--\tREJECT_TYPE=VALUE,\n--\tREJECT_VALUE=0\n--\t)\n\tWITH(\n\tLOCATION='EMS/curated/inquiry',--makethisdynamic,findmaxfolder\n\t--LOCATION='curated/inquiry/*/*/*/*/*.parquet',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]--,\n\t--REJECT_TYPE=VALUE,\n\t--REJECT_VALUE=0\n)\nGO\n\nSELECTTOP100*FROMdbo.Inquiry_All\ngo\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Inquiry_Daily')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"\nalterPROCEDUREdbo.usp_CreateExternalTable_Inquiry_Daily\n\nas\n\n--IFNOTEXISTS(SELECT*FROMsys.external_file_formatsWHEREname='SynapseParquetFormat')\n--\tCREATEEXTERNALFILEFORMAT[SynapseParquetFormat]\n--\tWITH(FORMAT_TYPE=PARQUET)\n--GO\n\n--IFNOTEXISTS(SELECT*FROMsys.external_data_sourcesWHEREname='datalake_eddydevlake_dfs_core_windows_net')\n--\tCREATEEXTERNALDATASOURCE[datalake_eddydevlake_dfs_core_windows_net]\n--\tWITH(\n--\t\tLOCATION='abfss://datalake@eddydevlake.dfs.core.windows.net',\n--\t\tTYPE=HADOOP\n--\t)\n--GO\n\nIFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Inquiry'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.inquiry\n\n\ndeclare@LocationVARCHAR(250)='EMS/curated/inquiry/'+cast(datepart(year,getdate())asvarchar)+'/'+right('0'+cast(datepart(month,getdate())asvarchar),2)+'/'+right('0'+cast(datepart(day,getdate())asvarchar),2),\n@sqlnvarchar(max)\n\n--select@Location\n\nset@sql=\n'CREATEEXTERNALTABLEdbo.Inquiry(\n\t[LeadId]int,\n\t[OrganizationId]int,\n\t[CampusId]varchar(100),\n\t[FormName]varchar(100),\n\t[FirstName]varchar(100),\n\t[LastName]varchar(100),\n\t[Email]varchar(300),\n\t[Phone1]varchar(50),\n\t[Address1]varchar(100),\n\t[City]varchar(100),\n\t[PostalCode]varchar(25),\n\t[StateProvince]varchar(50),\n\t[CountryName]varchar(50),\n\t[ClientDegreeName]varchar(300),\n\t[CreatedDate]datetime2(7),\n\t[DateDelivered]varchar(50),\n\t[DeliveryData]varchar(4000),\n\t[Delivered]varchar(5),\n\t[RealTimeDeliveryStatusName]varchar(100),\n\t[InstitutionId]int,\n\t[Organization]varchar(300),\n\t[Location]varchar(300),\n\t[Campaign]varchar(300),\n\t[CategoryName]varchar(100),\n\t[SubjectName]varchar(100),\n\t[captureurl]varchar(2500),\n\t[Keyword]varchar(300),\n\t[Field17]varchar(1),\n\t[Age]varchar(30),\n\t[utm_medium]varchar(300),\n\t[utm_source]varchar(2000),\n\t[utm_campaign]varchar(300),\n\t[utm_term]varchar(300),\n\t[utm_content]varchar(300),\n\t[cpl]varchar(20),\n\t[ItemGPMappingName]varchar(200),\n\t[AdGroup]varchar(300),\n\t[Affiliate]varchar(100),\n\t[Subvendorcode]varchar(300),\n\t[TrackId]varchar(100),\n\t[EducationLevel]varchar(100),\n\t[MilitaryStatusName]varchar(100),\n\t[ProgramLevelName]varchar(100),\n\t[VendorName]varchar(2000),\n\t[GeoKey]varchar(2000),\n\t[utm_key]varchar(2000),\n\t[DegreeKey]varchar(2000),\n\t[SubVendorKey]varchar(2000),\n\t[SourceFile]varchar(2000),\n\t[SourceSystem]varchar(100),\n\t[SuccessLeads]int,\n\t[InquiryKey]varchar(2000),\n\t[DateDimID]varchar(50),\n\t[ProductLevel]varchar(250)\n\t)\n\n\tWITH(\n\tLOCATION='''+@Location+''',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n)\n'\n\n\nexecsp_executesql@sql\n\n--SELECT*FROMdbo.Inquiry\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Performace')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Performance_All'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.Performance_All\nGO\n\nCREATEEXTERNALTABLEdbo.Performance_All(\n\t[CRID]int,\n\t[Institution]varchar(100),\n\t[MetricType]varchar(100),\n\t[MetricEventDate]date,\n\t[LeadID]int,\n\t[LeadDate]date,\n\t[Email]varchar(100),\n\t[Phone]varchar(100),\n\t[Action]varchar(50),\n\t[AccountManagerEmail]varchar(50),\n\t[UploadDate]date\n\t)\n\tWITH(\n\tLOCATION='EMS/curated/performance',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n\t)\nGO\n\nSELECTTOP100*FROMdbo.Performance_All\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Spend_All')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Spend_All'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.Spend_All\nGO\n\nCREATEEXTERNALTABLEdbo.Spend_All(\n\t[SpendKey]varchar(8000),\n\t[SpendDate]date,\n\t[Account]varchar(8000),\n\t[CampaignName]varchar(8000),\n\t[FinalUrl]varchar(8000),\n\t[Organization]varchar(8000),\n\t[CRID]varchar(8000),\n\t[Division]varchar(8000),\n\t[Market]varchar(8000),\n\t[Modality]varchar(8000),\n\t[Cost]real,\n\t[Clicks]real,\n\t[Impressions]real,\n\t[Conversions]real,\n\t[Followers]int,\n\t[Likes]int,\n\t[Comments]int,\n\t[Shares]int,\n\t[Reach]int,\n\t[SourceFile]varchar(8000),\n\t[SourceSystem]varchar(8000),\n\t[DataType]varchar(8000)\n\t)\n\tWITH(\n\t--server\n\tLOCATION='EMS/curated/spend',\n\t--Synapse\n\t--LOCATION='curated/spend/*/*/*/*/*.parquet',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n\t)\nGO\n\nSELECTTOP10*FROMdbo.Spend_All\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Spend_Daily')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"alterPROCEDUREdbo.usp_CreateExternalTable_Spend_Daily\n\nas\n\n\nIFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Spend'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.Spend\n\ndeclare@LocationVARCHAR(250)='EMS/curated/spend/'+cast(datepart(year,getdate())asvarchar)+'/'+right('0'+cast(datepart(month,getdate())asvarchar),2)+'/'+right('0'+cast(datepart(day,getdate())asvarchar),2),\n@sqlnvarchar(max)\n\n--select@Location\n\nset@sql=\n'CREATEEXTERNALTABLEdbo.Spend(\n\t[SpendKey]varchar(8000),\n\t[SpendDate]date,\n\t[Account]varchar(8000),\n\t[CampaignName]varchar(8000),\n\t[FinalUrl]varchar(8000),\n\t[Organization]varchar(8000),\n\t[CRID]varchar(8000),\n\t[Division]varchar(8000),\n\t[Market]varchar(8000),\n\t[Modality]varchar(8000),\n\t[Cost]real,\n\t[Clicks]real,\n\t[Impressions]real,\n\t[Conversions]real,\n\t[Followers]int,\n\t[Likes]int,\n\t[Comments]int,\n\t[Shares]int,\n\t[Reach]int,\n\t[SourceFile]varchar(8000),\n\t[SourceSystem]varchar(8000),\n\t[DataType]varchar(8000)\n\t)\n\tWITH(\n\tLOCATION='''+@Location+''',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n)\n'\n\nexecsp_executesql@sql\n--print@sql\n\n\n--SELECTTOP10*FROMdbo.Spend\n\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Curated_Target')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"EMS/ExternalTables"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Target'ands.name='dbo')\nDROPEXTERNALTABLEdbo.Target\nGO\n\nCREATEEXTERNALTABLEdbo.Target(\n[TargetKey]varchar(250),\n[CRID]int,\n[Service]varchar(250),\n[ProductLevel]varchar(250),\n[TargetDate]date,\n[TargetType]varchar(250),\n[Campaign]varchar(250),\n[Product]varchar(250),\n[Affiliate]varchar(250),\n[CampaignType]varchar(250),\n[CampusLocation]varchar(250),\n[CampusType]varchar(250),\n[Subvendor]varchar(250),\n[ClientDegreeName]varchar(250),\n[IsMilitary]varchar(100),\n[ProgramLevelName]varchar(250),\n[TargetApplicationsCompleted]real,\n[TargetApplicationsStarted]real,\n[TargetClicks]real,\n[TargetComments]real,\n[TargetContacts]real,\n[TargetQualifies]real,\n[TargetConfirms/Nurtures]real,\n[TargetImpressions]real,\n[TargetSpend]real,\n[TargetInquiries]real,\n[TargetLikes]real,\n[TargetNewFollowers]real,\n[TargetShares]real,\n[TargetPlatformConversions]real,\n[TargetStarts]real,\n[TargetInterviews]real,\n[TargetEnrollments]real,\n[UploadDate]DATE,\n[SourceFile]varchar(250)\n)\nWITH(\nLOCATION='EMS/curated/target',\n--LOCATION='curated/inquiry/*/*/*/*/*.parquet',\nDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\nFILE_FORMAT=[SynapseParquetFormat]--,\n)\nGO\n\nSELECTTOP100*FROMdbo.Target\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateExternalTable_Template')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='ParquetTest2'ands.name='dbo')\n\tDROPEXTERNALTABLEParquetTest2\nGO\n\nCREATEEXTERNALTABLEParquetTest2(\n\t[LeadId]varchar(8000),\n\t[OrganizationId]varchar(8000),\n\t[CampusId]varchar(8000),\n\t[FormName]varchar(8000),\n\t[FirstName]varchar(8000),\n\t[LastName]varchar(8000),\n\t[Email]varchar(8000),\n\t[Phone1]varchar(8000),\n\t[Address1]varchar(8000),\n\t[City]varchar(8000),\n\t[PostalCode]varchar(8000),\n\t[StateProvince]varchar(8000),\n\t[CountryName]varchar(8000),\n\t[ClientDegreeName]varchar(8000),\n\t[CreatedDate]datetime2(7),\n\t[UpdatedDate]datetime2(7),\n\t[DateDelivered]varchar(8000),\n\t[DeliveryData]varchar(8000),\n\t[ResponseData]varchar(8000),\n\t[Delivered]varchar(8000),\n\t[RealTimeDeliveryStatusName]varchar(8000),\n\t[InstitutionId]int,\n\t[Organization]varchar(8000),\n\t[Location]varchar(8000),\n\t[Campaign]varchar(8000),\n\t[CategoryName]varchar(8000),\n\t[SubjectName]varchar(8000),\n\t[captureurl]varchar(8000),\n\t[Keyword]varchar(8000),\n\t[Field17]varchar(8000),\n\t[Age]varchar(8000),\n\t[utm_medium]varchar(8000),\n\t[utm_source]varchar(8000),\n\t[utm_campaign]varchar(8000),\n\t[utm_term]varchar(8000),\n\t[utm_content]varchar(8000),\n\t[cpl]varchar(8000),\n\t[ItemGPMappingName]varchar(8000),\n\t[AdGroup]varchar(8000),\n\t[Affiliate]varchar(8000),\n\t[Subvendorcode]varchar(8000),\n\t[TrackId]varchar(8000),\n\t[EducationLevel]varchar(8000),\n\t[MilitaryStatusName]varchar(8000),\n\t[ProgramLevelName]varchar(8000),\n\t[VendorName]varchar(8000)\n\t)\n\tWITH(\n\tLOCATION='curated/inquiry/*/*/*/*/*.parquet',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n\t)\nGO\n\nSELECTTOP100*FROMParquetTest2\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"DataLakeDirectQuery",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateSchema_EMS')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Schemas"
},
"content":{
"query":"CREATESCHEMA[EMS]\nAUTHORIZATIONeddyprodsynapse\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateSchema_Staging')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Schemas"
},
"content":{
"query":"CREATESCHEMA[Staging]\nAUTHORIZATIONeddyprodsynapse\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateSchema_dim')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Schemas"
},
"content":{
"query":"CREATESCHEMA[dim]\nAUTHORIZATIONeddyprodsynapse\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CreateSchema_fact')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Schemas"
},
"content":{
"query":"CREATESCHEMA[fact]\nAUTHORIZATIONeddyprodsynapse\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CriteoDataLakeView')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"content":{
"query":"CREATEDATABASEDataLakeDirectQuery\n\n--Thisisauto-generatedcode\n\nCREATEVIEWCriteoDataLake\nAS\nSELECT\n*\nFROM\nOPENROWSET(\nBULK'https://eddydevlake.dfs.core.windows.net/files/EMS/Criteo.csv',\nFORMAT='CSV',\nPARSER_VERSION='2.0',\nheader_row=true\n)AS[result]\n\n\nCREATEVIEWCriteoDataLake2\nAS\nSELECT\n*\nFROM\nOPENROWSET(\nBULK'https://eddydevlake.dfs.core.windows.net/files/EMS/Criteo.csv',\nFORMAT='CSV',\nPARSER_VERSION='2.0',\nheader_row=true\n)AS[result]",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"DataLakeDirectQuery",
"poolName":"Built-in"
}
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/CuratedInquiryOld')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"Archive"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Inquiry'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.inquiry\nGO\n\n\nCREATEEXTERNALTABLEdbo.inquiry(\n\t[LeadId]Integer,\n\t[OrganizationId]Integer,\n\t[CampusId]Integer,\n\t[FormName]varchar(100),\n\t[FirstName]varchar(100),\n\t[LastName]varchar(100),\n\t[Email]varchar(300),\n\t[Phone1]varchar(50),\n\t[Address1]varchar(100),\n\t[City]varchar(100),\n\t[PostalCode]varchar(25),\n\t[StateProvince]varchar(50),\n\t[CountryName]varchar(50),\n\t[ClientDegreeName]varchar(250),\n\t[CreatedDate]datetime2(7),\n\t[DateDelivered]datetime2(7),\n\t[ResponseData]varchar(2500),\n\t[Delivered]varchar(10),\n\t[RealTimeDeliveryStatusName]varchar(100),\n\t[InstitutionId]Integer,\n\t[Organization]varchar(100),\n\t[Location]varchar(100),\n\t[Campaign]varchar(100),\n\t[CategoryName]varchar(100),\n\t[SubjectName]varchar(100),\n\t[captureurl]varchar(2500),\n\t[Keyword]varchar(100),\n\t[Field17]varchar(1000),\n\t[Age]varchar(5),\n\t[utm_medium]varchar(100),\n\t[utm_source]varchar(100),\n\t[utm_campaign]varchar(100),\n\t[utm_term]varchar(100),\n\t[utm_content]varchar(100),\n\t[cpl]DECIMAL(18,2),\n\t[ItemGPMappingName]varchar(100),\n\t[AdGroup]varchar(100),\n\t[Affiliate]varchar(100),\n\t[Subvendorcode]varchar(100),\n\t[TrackId]varchar(100),\n\t[EducationLevel]varchar(100),\n\t[MilitaryStatusName]varchar(100),\n\t[ProgramLevelName]varchar(100),\n\t[VendorName]varchar(100),\n\t[GeoKey]varchar(100),\n\t[SourceFile]varchar(100),\n\t[SourceSystem]varchar(100),\n\t[SuccessLeads]Integer,\n\t[InquiryKey]varchar(50),\n\t[DateDimID]Integer\n\t)\n\tWITH(\n\tLOCATION='EMS/curated/inquiry',\n\t--LOCATION='curated/inquiry/*/*/*/*/*.parquet',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]--,\n\t--REJECT_TYPE=VALUE,\n\t--REJECT_VALUE=0\n\t)\nGO\n\nSELECTTOP100*FROMdbo.inquiry\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/Curated_Budget')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Budget'ands.name='Curated')\n\tDROPEXTERNALTABLECurated.Budget\nGO\n\nCREATEEXTERNALTABLECurated.Budget(\n\t[BudgetKey]varchar(8000),\n\t[BudgetDate]varchar(8000),\n\t[Location]varchar(8000),\n\t[Dim_Service]varchar(8000),\n\t[BudgetedSpend]real,\n\t[BudgetedInquiries]real,\n\t[BudgetedInterviews]real,\n\t[BudgetedQualifies]real,\n\t[BudgetedApplications]real,\n\t[BudgetedEnrollments]real,\n\t[BudgetedStarts]real,\n\t[Dim_Vendor]varchar(8000),\n\t[GroundvsOnline]varchar(8000),\n\t[DIM_UndergradvsGrad]varchar(8000),\n\t[DIM_MilitaryStatus]varchar(8000),\n\t[ClientDegreeName]varchar(8000),\n\t[SourceFile]varchar(8000),\n\t[SourceSystem]varchar(8000),\n\t[DataType]varchar(8000),\n\t[Organization]varchar(8000),\n\t[OrganizationId]int\n\t)\n\tWITH(\n\tLOCATION='curated/budget/data.parquet',\n\tDATA_SOURCE=[datalake_dpi30storageaccount01_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat],\n\tREJECT_TYPE=VALUE,\n\tREJECT_VALUE=0\n\t)\nGO\n\nSELECTTOP100*FROMCurated.Budget\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_DimCampaign')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.tablestinnerjoinsys.schemassont.schema_id=s.schema_idWHEREt.name='DimCampaign'ands.name='DW')\n\tDROPTABLEDW.DimCampaign\nGO\n\nCREATETABLE[DW].[DimCampaign]\n(\n\t[CampaignName]varchar(255)\t\n)\nWITH\n(\nDISTRIBUTION=HASH(CampaignName),\nCLUSTEREDCOLUMNSTOREINDEX\n)\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_DimDate')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.tablestinnerjoinsys.schemassont.schema_id=s.schema_idWHEREt.name='DimDate'ands.name='DW')\n\tDROPTABLEDW.DimDate\nGO\n\nCREATETABLE[DW].[DimDate](\n[DateKey][int]NOTNULL,\n[Date][date]NOTNULL,\n[Day][tinyint]NOTNULL,\n[DaySuffix][char](2)NOTNULL,\n[Weekday][tinyint]NOTNULL,\n[WeekDayName][varchar](10)NOTNULL,\n[WeekDayName_Short][char](3)NOTNULL,\n[WeekDayName_FirstLetter][char](1)NOTNULL,\n[DOWInMonth][tinyint]NOTNULL,\n[DayOfYear][smallint]NOTNULL,\n[WeekOfMonth][tinyint]NOTNULL,\n[WeekOfYear][tinyint]NOTNULL,\n[Month][tinyint]NOTNULL,\n[MonthName][varchar](10)NOTNULL,\n[MonthName_Short][char](3)NOTNULL,\n[MonthName_FirstLetter][char](1)NOTNULL,\n[Quarter][tinyint]NOTNULL,\n[QuarterName][varchar](6)NOTNULL,\n[Year][int]NOTNULL,\n[MMYYYY][char](6)NOTNULL,\n[MonthYear][char](7)NOTNULL,\nIsWeekendBITNOTNULL,\nIsHolidayBITNOTNULL,\nHolidayNameVARCHAR(20)NULL,\nSpecialDaysVARCHAR(20)NULL,\n[FinancialYear][int]NULL,\n[FinancialQuater][int]NULL,\n[FinancialMonth][int]NULL,\n[FirstDateofYear]DATENULL,\n[LastDateofYear]DATENULL,\n[FirstDateofQuater]DATENULL,\n[LastDateofQuater]DATENULL,\n[FirstDateofMonth]DATENULL,\n[LastDateofMonth]DATENULL,\n[FirstDateofWeek]DATENULL,\n[LastDateofWeek]DATENULL,\nCurrentYearSMALLINTNULL,\nCurrentQuaterSMALLINTNULL,\nCurrentMonthSMALLINTNULL,\nCurrentWeekSMALLINTNULL,\nCurrentDaySMALLINTNULL\n)\nWITH\n(\nDISTRIBUTION=HASH(DateKey),\nCLUSTEREDCOLUMNSTOREINDEX\n)\nGO\n\n\nSETNOCOUNTON\n\nTRUNCATETABLEDW.DimDate\n\nDECLARE@CurrentDateDATE='2016-01-01'\nDECLARE@EndDateDATE='2021-12-31'\n\nWHILE@CurrentDate<@EndDate\nBEGIN\nINSERTINTO[DW].[DimDate](\n[DateKey],\n[Date],\n[Day],\n[DaySuffix],\n[Weekday],\n[WeekDayName],\n[WeekDayName_Short],\n[WeekDayName_FirstLetter],\n[DOWInMonth],\n[DayOfYear],\n[WeekOfMonth],\n[WeekOfYear],\n[Month],\n[MonthName],\n[MonthName_Short],\n[MonthName_FirstLetter],\n[Quarter],\n[QuarterName],\n[Year],\n[MMYYYY],\n[MonthYear],\n[IsWeekend],\n[IsHoliday],\n[FirstDateofYear],\n[LastDateofYear],\n[FirstDateofQuater],\n[LastDateofQuater],\n[FirstDateofMonth],\n[LastDateofMonth],\n[FirstDateofWeek],\n[LastDateofWeek]\n)\nSELECTDateKey=YEAR(@CurrentDate)*10000+MONTH(@CurrentDate)*100+DAY(@CurrentDate),\nDATE=@CurrentDate,\nDay=DAY(@CurrentDate),\n[DaySuffix]=CASE\nWHENDAY(@CurrentDate)=1\nORDAY(@CurrentDate)=21\nORDAY(@CurrentDate)=31\nTHEN'st'\nWHENDAY(@CurrentDate)=2\nORDAY(@CurrentDate)=22\nTHEN'nd'\nWHENDAY(@CurrentDate)=3\nORDAY(@CurrentDate)=23\nTHEN'rd'\nELSE'th'\nEND,\nWEEKDAY=DATEPART(dw,@CurrentDate),\nWeekDayName=DATENAME(dw,@CurrentDate),\nWeekDayName_Short=UPPER(LEFT(DATENAME(dw,@CurrentDate),3)),\nWeekDayName_FirstLetter=LEFT(DATENAME(dw,@CurrentDate),1),\n[DOWInMonth]=DAY(@CurrentDate),\n[DayOfYear]=DATENAME(dy,@CurrentDate),\n[WeekOfMonth]=DATEPART(WEEK,@CurrentDate)-DATEPART(WEEK,DATEADD(MM,DATEDIFF(MM,0,@CurrentDate),0))+1,\n[WeekOfYear]=DATEPART(wk,@CurrentDate),\n[Month]=MONTH(@CurrentDate),\n[MonthName]=DATENAME(mm,@CurrentDate),\n[MonthName_Short]=UPPER(LEFT(DATENAME(mm,@CurrentDate),3)),\n[MonthName_FirstLetter]=LEFT(DATENAME(mm,@CurrentDate),1),\n[Quarter]=DATEPART(q,@CurrentDate),\n[QuarterName]=CASE\nWHENDATENAME(qq,@CurrentDate)=1\nTHEN'First'\nWHENDATENAME(qq,@CurrentDate)=2\nTHEN'second'\nWHENDATENAME(qq,@CurrentDate)=3\nTHEN'third'\nWHENDATENAME(qq,@CurrentDate)=4\nTHEN'fourth'\nEND,\n[Year]=YEAR(@CurrentDate),\n[MMYYYY]=RIGHT('0'+CAST(MONTH(@CurrentDate)ASVARCHAR(2)),2)+CAST(YEAR(@CurrentDate)ASVARCHAR(4)),\n[MonthYear]=CAST(YEAR(@CurrentDate)ASVARCHAR(4))+UPPER(LEFT(DATENAME(mm,@CurrentDate),3)),\n[IsWeekend]=CASE\nWHENDATENAME(dw,@CurrentDate)='Sunday'\nORDATENAME(dw,@CurrentDate)='Saturday'\nTHEN1\nELSE0\nEND,\n[IsHoliday]=0,\n[FirstDateofYear]=CAST(CAST(YEAR(@CurrentDate)ASVARCHAR(4))+'-01-01'ASDATE),\n[LastDateofYear]=CAST(CAST(YEAR(@CurrentDate)ASVARCHAR(4))+'-12-31'ASDATE),\n[FirstDateofQuater]=DATEADD(qq,DATEDIFF(qq,0,GETDATE()),0),\n[LastDateofQuater]=DATEADD(dd,-1,DATEADD(qq,DATEDIFF(qq,0,GETDATE())+1,0)),\n[FirstDateofMonth]=CAST(CAST(YEAR(@CurrentDate)ASVARCHAR(4))+'-'+CAST(MONTH(@CurrentDate)ASVARCHAR(2))+'-01'ASDATE),\n[LastDateofMonth]=EOMONTH(@CurrentDate),\n[FirstDateofWeek]=DATEADD(dd,-(DATEPART(dw,@CurrentDate)-1),@CurrentDate),\n[LastDateofWeek]=DATEADD(dd,7-(DATEPART(dw,@CurrentDate)),@CurrentDate)\n\nSET@CurrentDate=DATEADD(DD,1,@CurrentDate)\nEND\n\n--UpdateHolidayinformation\nUPDATEDW.DimDate\nSET[IsHoliday]=1,\n[HolidayName]='Christmas'\nWHERE[Month]=12\nAND[DAY]=25\n\nUPDATEDW.DimDate\nSETSpecialDays='ValentinesDay'\nWHERE[Month]=2\nAND[DAY]=14\n\n--Updatecurrentdateinformation\nUPDATEDW.DimDate\nSETCurrentYear=DATEDIFF(yy,GETDATE(),DATE),\nCurrentQuater=DATEDIFF(q,GETDATE(),DATE),\nCurrentMonth=DATEDIFF(m,GETDATE(),DATE),\nCurrentWeek=DATEDIFF(ww,GETDATE(),DATE),\nCurrentDay=DATEDIFF(dd,GETDATE(),DATE)",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_FactBudget')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.tablestinnerjoinsys.schemassont.schema_id=s.schema_idWHEREt.name='FactBudget'ands.name='DW')\n\tDROPTABLEDW.FactBudget\nGO\n\nCREATETABLE[DW].[FactBudget]\n(\n\t[BudgetKey]varchar(8000),\n\t[BudgetDate]varchar(8000),\n\t[Location]varchar(8000),\n\t[Dim_Service]varchar(8000),\n\t[BudgetedSpend]real,\n\t[BudgetedInquiries]real,\n\t[BudgetedInterviews]real,\n\t[BudgetedQualifies]real,\n\t[BudgetedApplications]real,\n\t[BudgetedEnrollments]real,\n\t[BudgetedStarts]real,\n\t[Dim_Vendor]varchar(8000),\n\t[GroundvsOnline]varchar(8000),\n\t[DIM_UndergradvsGrad]varchar(8000),\n\t[DIM_MilitaryStatus]varchar(8000),\n\t[ClientDegreeName]varchar(8000),\n\t[SourceFile]varchar(8000),\n\t[SourceSystem]varchar(8000),\n\t[DataType]varchar(8000),\n\t[Organization]varchar(8000),\n\t[OrganizationId]int,\n[DateKey]int\n)\nWITH\n(\nDISTRIBUTION=HASH(BudgetKey),\nCLUSTEREDCOLUMNSTOREINDEX\n)\nGO\n\nEXEC[DW].[spReloadFactBudget]\nGO\n\nSELECT*FROM[DW].[FactBudget]\nGO",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_FactSpend_LoadFromUSP')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"IFEXISTS(SELECT*FROMsys.tablestinnerjoinsys.schemassont.schema_id=s.schema_idWHEREt.name='FactSpend'ands.name='DW')\n\tDROPTABLEDW.FactSpend\nGO\n\nCREATETABLE[DW].[FactSpend]\n(\n\t[SpendKey]varchar(8000),\n\t[SpendDate]date,\n\t[OrganizationId]int,\n\t[Account]varchar(8000),\n\t[CampaignName]varchar(8000),\n\t[FinalUrl]varchar(8000),\n\t[Impressions]varchar(8000),\n\t[Clicks]real,\n\t[CostUsd]real,\n\t[BounceRate]real,\n\t[AveragePosition]real,\n\t[AvailableImpressions]real,\n\t[Conversions]real,\n\t[QualityScore]real,\n\t[ImpressionShares]real,\n\t[Reach]varchar(8000),\n\t[PageLikes]real,\n\t[PostComments]real,\n\t[PostReactions]real,\n\t[PostShares]real,\n\t[WebsiteLeads]real,\n\t[SourceFile]varchar(8000),\n\t[SourceSystem]varchar(8000),\n\t[DataType]varchar(8000),\n[DateKey]int\n)\nWITH\n(\nDISTRIBUTION=HASH(SpendKey),\nCLUSTEREDCOLUMNSTOREINDEX\n)\nGO\n\nEXEC[DW].[spReloadFactSpend]\nGO\n\nSELECT*FROM[DW].[FactSpend]\nGO",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_spReloadDimensions')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"\nIFEXISTS(SELECT*FROMsys.objectsoinnerjoinsys.schemassono.schema_id=s.schema_idWHEREo.name='spReloadDimensions'ando.type='P'ands.name='DW')\nDROPPROCEDUREDW.spReloadDimensions\nGO\n\nCREATEPROC[DW].[spReloadDimensions]\nAS\nBEGIN\nDELETE[DW].[DimMilitaryStatus]\nDELETE[DW].[DimService]\nDELETE[DW].[DimVendor]\nDELETE[DW].[DimLocation]\nDELETE[DW].[DimGradStatus]\nDELETE[DW].[DimCampaign]\nDELETE[DW].[DimOrganization]\n\nINSERT[DW].[DimMilitaryStatus]([MilitaryStatus])\nSELECTDISTINCTTRIM([DIM_MilitaryStatus])FROMCurated.BudgetWHERELEN([DIM_MilitaryStatus])>0\nUNION\nSELECTDISTINCTTRIM([DIM_MilitaryStatus])FROMCurated.InquiryWHERELEN([DIM_MilitaryStatus])>0\n--UNION\n--SELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERE[CampaignName]ISNOTNULL\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimService]([Service])\nSELECTDISTINCTTRIM([Dim_Service])FROMCurated.BudgetWHERELEN([Dim_Service])>0\nUNION\nSELECTDISTINCTTRIM([Dim_Service])FROMCurated.InquiryWHERELEN([Dim_Service])>0\n--UNION\n--SELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERE[CampaignName]ISNOTNULL\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimVendor]([Vendor])\nSELECTDISTINCTTRIM([Dim_Vendor])FROMCurated.BudgetWHERELEN([Dim_Vendor])>0\nUNION\nSELECTDISTINCTTRIM([Dim_Vendor])FROMCurated.InquiryWHERELEN([Dim_Vendor])>0\n--UNION\n--SELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERE[CampaignName]ISNOTNULL\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimLocation]([Location])\nSELECTDISTINCTTRIM([Location])FROMCurated.BudgetWHERELEN([Location])>0\nUNION\nSELECTDISTINCTTRIM([Location])FROMCurated.InquiryWHERELEN([Location])>0\n--UNION\n--SELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERE[CampaignName]ISNOTNULL\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimGradStatus]([GradStatus])\nSELECTDISTINCTTRIM([DIM_UndergradvsGrad])FROMCurated.BudgetWHERELEN([DIM_UndergradvsGrad])>0\nUNION\nSELECTDISTINCTTRIM([DIM_UndergradvsGrad])FROMCurated.InquiryWHERELEN([DIM_UndergradvsGrad])>0\n--UNION\n--SELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERE[CampaignName]ISNOTNULL\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimCampaign]([CampaignName])\n--SELECTDISTINCTTRIM([Campaign])FROMCurated.BudgetWHERELEN([Campaign])>0\n--UNION\nSELECTDISTINCTTRIM([utm_campaign])FROMCurated.InquiryWHERELEN([utm_campaign])>0\nUNION\nSELECTDISTINCTTRIM([CampaignName])FROMCurated.SpendWHERELEN([CampaignName])>0\nUNION\nSELECT'Unknown'\n\nINSERT[DW].[DimOrganization]([Organization],[OrganizationId])\nSELECTDISTINCT[Organization],[OrganizationId]FROMCurated.BudgetWHERELEN([OrganizationId])>0\nUNION\nSELECTDISTINCT[Organization],[OrganizationId]FROMCurated.InquiryWHERELEN([OrganizationId])>0\nUNION\nSELECTDISTINCT[Organization],[OrganizationId]FROMCurated.SpendWHERELEN([OrganizationId])>0\nUNION\nSELECT'Unknown',-1\n\nEND\nGO\n\nEXEC[DW].[spReloadDimensions]\nGO\n\nSELECT*FROM[DW].[DimMilitaryStatus]\nGO\n\nSELECT*FROM[DW].[DimLocation]\nGO\n\nSELECT*FROM[DW].[DimVendor]\nGO\n\nSELECT*FROM[DW].[DimService]\nGO\n\nSELECT*FROM[DW].[DimGradStatus]\nGO\n\nSELECT*FROM[DW].[DimCampaign]\nGO\n\nSELECT*FROM[DW].[DimOrganization]\nGO",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/DW_spReloadFactSpend')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David/Tallan"
},
"content":{
"query":"\nIFEXISTS(SELECT*FROMsys.objectsoinnerjoinsys.schemassono.schema_id=s.schema_idWHEREo.name='spReloadFactSpend'ando.type='P'ands.name='DW')\nDROPPROCEDUREDW.spReloadFactSpend\nGO\n\nCREATEPROC[DW].[spReloadFactSpend]\nAS\nBEGIN\nDELETE[DW].[FactSpend]\n\nINSERT[DW].[FactSpend]([SpendKey]\n,[SpendDate]\n,[OrganizationId]\n,[Account]\n,[CampaignName]\n,[FinalUrl]\n,[Impressions]\n,[Clicks]\n,[CostUsd]\n,[BounceRate]\n,[AveragePosition]\n,[AvailableImpressions]\n,[Conversions]\n,[QualityScore]\n,[ImpressionShares]\n,[Reach]\n,[PageLikes]\n,[PostComments]\n,[PostReactions]\n,[PostShares]\n,[WebsiteLeads]\n,[SourceFile]\n,[SourceSystem]\n,[DataType]\n,[DateKey])\nSELECT[SpendKey]\n,[SpendDate]\n,[OrganizationId]\n,[Account]\n,ISNULL(NULLIF([CampaignName],''),'Unknown')\n,[FinalUrl]\n,[Impressions]\n,[Clicks]\n,[CostUsd]\n,[BounceRate]\n,[AveragePosition]\n,[AvailableImpressions]\n,[Conversions]\n,[QualityScore]\n,[ImpressionShares]\n,[Reach]\n,[PageLikes]\n,[PostComments]\n,[PostReactions]\n,[PostShares]\n,[WebsiteLeads]\n,[SourceFile]\n,[SourceSystem]\n,[DataType]\n,YEAR(SpendDate)*10000+MONTH(SpendDate)*100+DAY(SpendDate)\nFROMCurated.Spend\n\nEND\nGO\n\nEXEC[DW].[spReloadFactSpend]\nGO\n\nSELECT*FROM[DW].[FactSpend]\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/ExternalTableDynamicLocation')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"content":{
"query":"--IFNOTEXISTS(SELECT*FROMsys.external_file_formatsWHEREname='SynapseParquetFormat')\n--\tCREATEEXTERNALFILEFORMAT[SynapseParquetFormat]\n--\tWITH(FORMAT_TYPE=PARQUET)\n--GO\n\n--IFNOTEXISTS(SELECT*FROMsys.external_data_sourcesWHEREname='datalake_eddydevlake_dfs_core_windows_net')\n--\tCREATEEXTERNALDATASOURCE[datalake_eddydevlake_dfs_core_windows_net]\n--\tWITH(\n--\t\tLOCATION='abfss://datalake@eddydevlake.dfs.core.windows.net',\n--\t\tTYPE=HADOOP\n--\t)\n--GO\n\nIFEXISTS(SELECT*FROMsys.external_tablesetinnerjoinsys.schemassonet.schema_id=s.schema_idWHEREet.name='Inquiry'ands.name='dbo')\n\tDROPEXTERNALTABLEdbo.inquiry\nGO\n\ndeclare@LocationVARCHAR(250)='EMS/curated/inquiry/'+cast(datepart(year,getdate())asvarchar)+'/'+right('0'+cast(datepart(month,getdate())asvarchar),2)+'/'+right('0'+cast(datepart(day,getdate())asvarchar),2),\n@sqlnvarchar(max)\n\n--select@Location\n\nset@sql=\n'CREATEEXTERNALTABLEdbo.Inquiry(\n\t[LeadId]int,\n\t[OrganizationId]int,\n\t[CampusId]varchar(100),\n\t[FormName]varchar(100),\n\t[FirstName]varchar(100),\n\t[LastName]varchar(100),\n\t[Email]varchar(300),\n\t[Phone1]varchar(50),\n\t[Address1]varchar(100),\n\t[City]varchar(100),\n\t[PostalCode]varchar(25),\n\t[StateProvince]varchar(50),\n\t[CountryName]varchar(50),\n\t[ClientDegreeName]varchar(300),\n\t[CreatedDate]datetime2(7),\n\t[DateDelivered]varchar(50),\n\t[DeliveryData]varchar(4000),\n\t[Delivered]varchar(5),\n\t[RealTimeDeliveryStatusName]varchar(100),\n\t[InstitutionId]int,\n\t[Organization]varchar(300),\n\t[Location]varchar(300),\n\t[Campaign]varchar(300),\n\t[CategoryName]varchar(100),\n\t[SubjectName]varchar(100),\n\t[captureurl]varchar(2500),\n\t[Keyword]varchar(300),\n\t[Field17]varchar(1),\n\t[Age]varchar(30),\n\t[utm_medium]varchar(300),\n\t[utm_source]varchar(2000),\n\t[utm_campaign]varchar(300),\n\t[utm_term]varchar(300),\n\t[utm_content]varchar(300),\n\t[cpl]varchar(20),\n\t[ItemGPMappingName]varchar(200),\n\t[AdGroup]varchar(300),\n\t[Affiliate]varchar(100),\n\t[Subvendorcode]varchar(300),\n\t[TrackId]varchar(100),\n\t[EducationLevel]varchar(100),\n\t[MilitaryStatusName]varchar(100),\n\t[ProgramLevelName]varchar(100),\n\t[VendorName]varchar(2000),\n\t[GeoKey]varchar(2000),\n\t[utm_key]varchar(2000),\n\t[DegreeKey]varchar(2000),\n\t[SubVendorKey]varchar(2000),\n\t[SourceFile]varchar(2000),\n\t[SourceSystem]varchar(100),\n\t[SuccessLeads]int,\n\t[InquiryKey]varchar(2000),\n\t[DateDimID]varchar(50)\n\t)\n\n\tWITH(\n\tLOCATION='''+@Location+''',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n)\n'\n\n\nexecsp_executesql@sql\n\nSELECT*FROMdbo.Inquiry\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"eddydevdw",
"poolName":"eddydevdw"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/ReadParquetFiles')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"David"
},
"content":{
"query":"selecttop10*\nfromopenrowset(\nbulk'https://eddydevlake.blob.core.windows.net/datalake/curated/inquiry/2021/04/21/data.parquet/part-00000-tid-200234344107655095-a2ce3ba5-7013-43af-a9b2-382762f474e0-8-1-c000.snappy.parquet',\nformat='parquet')asrows",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/URLDecode')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Functions"
},
"content":{
"query":"\n/******Object:UserDefinedFunction[dbo].[URLDecode]ScriptDate:6/29/20218:20:24AM******/\nSETANSI_NULLSON\nGO\nSETQUOTED_IDENTIFIERON\nGO\nCREATEFUNCTION[dbo].[URLDecode](@str[nvarchar](max))RETURNSvarchar(600)\nAS\nbegin\nif@strisnullreturnnull\ndeclare@outnvarchar(max)=N''\nset@str=replace(@str,N'+',N'%20')\nwhilelen(@str)>0\nbegin\ndeclare@ibigint=patindex(N'%[%][0-9a-fA-F][0-9a-fA-F]%',@str)\nif@i=0break\nset@out=@out+substring(@str,0,@i)+convert(nchar(2),convert(varbinary,'0x'+substring(@str,@i+1,2),1))\nset@str=substring(@str,@i+3,len(@str))\nend\nreturn@out+@str\nend\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/row_inquiry')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"Archive"
},
"content":{
"query":"IFNOTEXISTS(SELECT*FROMsys.external_file_formatsWHEREname='SynapseParquetFormat')\n\tCREATEEXTERNALFILEFORMAT[SynapseParquetFormat]\n\tWITH(FORMAT_TYPE=PARQUET)\nGO\n\nIFNOTEXISTS(SELECT*FROMsys.external_data_sourcesWHEREname='datalake_eddydevlake_dfs_core_windows_net')\n\tCREATEEXTERNALDATASOURCE[datalake_eddydevlake_dfs_core_windows_net]\n\tWITH(\n\t\tLOCATION='https://eddydevlake.dfs.core.windows.net/datalake',\n\t)\nGo\n\nCREATEEXTERNALTABLErow_inquiry(\n\t[LeadId]varchar(8000),\n\t[OrganizationId]varchar(8000),\n\t[CampusId]varchar(8000),\n\t[FormName]varchar(8000),\n\t[FirstName]varchar(8000),\n\t[LastName]varchar(8000),\n\t[Email]varchar(8000),\n\t[Phone1]varchar(8000),\n\t[Address1]varchar(8000),\n\t[City]varchar(8000),\n\t[PostalCode]varchar(8000),\n\t[StateProvince]varchar(8000),\n\t[CountryName]varchar(8000),\n\t[ClientDegreeName]varchar(8000),\n\t[CreatedDate]datetime2(7),\n\t[UpdatedDate]datetime2(7),\n\t[DateDelivered]varchar(8000),\n\t[DeliveryData]varchar(8000),\n\t[ResponseData]varchar(8000),\n\t[Delivered]varchar(8000),\n\t[RealTimeDeliveryStatusName]varchar(8000),\n\t[InstitutionId]int,\n\t[Organization]varchar(8000),\n\t[Location]varchar(8000),\n\t[Campaign]varchar(8000),\n\t[CategoryName]varchar(8000),\n\t[SubjectName]varchar(8000),\n\t[captureurl]varchar(8000),\n\t[Keyword]varchar(8000),\n\t[Field17]varchar(8000),\n\t[Age]varchar(8000),\n\t[utm_medium]varchar(8000),\n\t[utm_source]varchar(8000),\n\t[utm_campaign]varchar(8000),\n\t[utm_term]varchar(8000),\n\t[utm_content]varchar(8000),\n\t[cpl]varchar(8000),\n\t[ItemGPMappingName]varchar(8000),\n\t[AdGroup]varchar(8000),\n\t[Affiliate]varchar(8000),\n\t[Subvendorcode]varchar(8000),\n\t[TrackId]varchar(8000),\n\t[EducationLevel]varchar(8000),\n\t[MilitaryStatusName]varchar(8000),\n\t[ProgramLevelName]varchar(8000),\n\t[VendorName]varchar(8000)\n\t)\n\tWITH(\n\tLOCATION='raw/inquiry/input/keiser/2021/04/01/data_20210406_030603.parquet',\n\tDATA_SOURCE=[datalake_eddydevlake_dfs_core_windows_net],\n\tFILE_FORMAT=[SynapseParquetFormat]\n\t)\nGO\n\nSELECTTOP100*FROMrow_inquiry\nGO\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"DataLakeDirectQuery",
"poolName":"Built-in"
},
"resultLimit":-1
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/ufn_decodeHTTPParameterValue')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Functions"
},
"content":{
"query":"/******Object:UserDefinedFunction[dbo].[ufn_decodeHTTPParameterValue]ScriptDate:6/29/20218:20:24AM******/\nSETANSI_NULLSON\nGO\nSETQUOTED_IDENTIFIERON\nGO\nCREATEFUNCTION[dbo].[ufn_decodeHTTPParameterValue](@value[VARCHAR](100))RETURNSVARCHAR(600)\nAS\nBEGIN\n\n\tSET@value=REPLACE(@value,'+','')\n\tSET@value=REPLACE(@value,'=','')\n\n\tSET@value=REPLACE(@value,'%25','%')--thisneedstobefirst(sometimesthingsaredouble-encoded)\n\tSET@value=REPLACE(@value,'%20','')\n\tSET@value=REPLACE(@value,'%3B',';')\n\tSET@value=REPLACE(@value,'%3F','?')\n\tSET@value=REPLACE(@value,'%2F','/')\n\tSET@value=REPLACE(@value,'%5C','\\')\n\tSET@value=REPLACE(@value,'%3A',':')\n\tSET@value=REPLACE(@value,'%23','#')\n\tSET@value=REPLACE(@value,'%24','$')\n\tSET@value=REPLACE(@value,'%3D','=')\n\tSET@value=REPLACE(@value,'%2B','+')\n\tSET@value=REPLACE(@value,'%26','&')\n\tSET@value=REPLACE(@value,'%2C',',')\n\tSET@value=REPLACE(@value,'%3C','<')\n\tSET@value=REPLACE(@value,'%3E','>')\n\tSET@value=REPLACE(@value,'%7E','~')\n\tSET@value=REPLACE(@value,'%2E','.')\n\tSET@value=REPLACE(@value,'%2D','-')\n\tSET@value=REPLACE(@value,'%28','(')\n\tSET@value=REPLACE(@value,'%29',')')\n\tSET@value=REPLACE(@value,'%22','\"')\n\tSET@value=REPLACE(@value,'%27','''')\n\tSET@value=REPLACE(@value,'%40','@')\n\t\n\tSET@value=REPLACE(@value,'','')\n\n\tRETURN@value\nEND\nGO\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/vColumnstoreDensity')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Views"
},
"content":{
"query":"/******Object:View[dbo].[vColumnstoreDensity]ScriptDate:6/29/20218:39:07AM******/\nSETANSI_NULLSON\nGO\n\nSETQUOTED_IDENTIFIERON\nGO\n\nCREATEVIEW[dbo].[vColumnstoreDensity]\nASSELECT\nGETDATE()AS[execution_date]\n,DB_Name()AS[database_name]\n,s.nameAS[schema_name]\n,t.nameAS[table_name]\n,COUNT(DISTINCTrg.[partition_number])AS[table_partition_count]\n,SUM(rg.[total_rows])AS[row_count_total]\n,SUM(rg.[total_rows])/COUNT(DISTINCTrg.[distribution_id])AS[row_count_per_distribution_MAX]\n,CEILING((SUM(rg.[total_rows])*1.0/COUNT(DISTINCTrg.[distribution_id]))/1048576)AS[rowgroup_per_distribution_MAX]\n,SUM(CASEWHENrg.[State]=0THEN1ELSE0END)AS[INVISIBLE_rowgroup_count]\n,SUM(CASEWHENrg.[State]=0THENrg.[total_rows]ELSE0END)AS[INVISIBLE_rowgroup_rows]\n,MIN(CASEWHENrg.[State]=0THENrg.[total_rows]ELSENULLEND)AS[INVISIBLE_rowgroup_rows_MIN]\n,MAX(CASEWHENrg.[State]=0THENrg.[total_rows]ELSENULLEND)AS[INVISIBLE_rowgroup_rows_MAX]\n,AVG(CASEWHENrg.[State]=0THENrg.[total_rows]ELSENULLEND)AS[INVISIBLE_rowgroup_rows_AVG]\n,SUM(CASEWHENrg.[State]=1THEN1ELSE0END)AS[OPEN_rowgroup_count]\n,SUM(CASEWHENrg.[State]=1THENrg.[total_rows]ELSE0END)AS[OPEN_rowgroup_rows]\n,MIN(CASEWHENrg.[State]=1THENrg.[total_rows]ELSENULLEND)AS[OPEN_rowgroup_rows_MIN]\n,MAX(CASEWHENrg.[State]=1THENrg.[total_rows]ELSENULLEND)AS[OPEN_rowgroup_rows_MAX]\n,AVG(CASEWHENrg.[State]=1THENrg.[total_rows]ELSENULLEND)AS[OPEN_rowgroup_rows_AVG]\n,SUM(CASEWHENrg.[State]=2THEN1ELSE0END)AS[CLOSED_rowgroup_count]\n,SUM(CASEWHENrg.[State]=2THENrg.[total_rows]ELSE0END)AS[CLOSED_rowgroup_rows]\n,MIN(CASEWHENrg.[State]=2THENrg.[total_rows]ELSENULLEND)AS[CLOSED_rowgroup_rows_MIN]\n,MAX(CASEWHENrg.[State]=2THENrg.[total_rows]ELSENULLEND)AS[CLOSED_rowgroup_rows_MAX]\n,AVG(CASEWHENrg.[State]=2THENrg.[total_rows]ELSENULLEND)AS[CLOSED_rowgroup_rows_AVG]\n,SUM(CASEWHENrg.[State]=3THEN1ELSE0END)AS[COMPRESSED_rowgroup_count]\n,SUM(CASEWHENrg.[State]=3THENrg.[total_rows]ELSE0END)AS[COMPRESSED_rowgroup_rows]\n,SUM(CASEWHENrg.[State]=3THENrg.[deleted_rows]ELSE0END)AS[COMPRESSED_rowgroup_rows_DELETED]\n,MIN(CASEWHENrg.[State]=3THENrg.[total_rows]ELSENULLEND)AS[COMPRESSED_rowgroup_rows_MIN]\n,MAX(CASEWHENrg.[State]=3THENrg.[total_rows]ELSENULLEND)AS[COMPRESSED_rowgroup_rows_MAX]\n,AVG(CASEWHENrg.[State]=3THENrg.[total_rows]ELSENULLEND)AS[COMPRESSED_rowgroup_rows_AVG]\n,'ALTERINDEXALLON'+s.name+'.'+t.NAME+'REBUILD;'AS[Rebuild_Index_SQL]\nFROMsys.[pdw_nodes_column_store_row_groups]rg\nJOINsys.[pdw_nodes_tables]ntONrg.[object_id]=nt.[object_id]\nANDrg.[pdw_node_id]=nt.[pdw_node_id]\nANDrg.[distribution_id]=nt.[distribution_id]\nJOINsys.[pdw_table_mappings]mpONnt.[name]=mp.[physical_name]\nJOINsys.[tables]tONmp.[object_id]=t.[object_id]\nJOINsys.[schemas]sONt.[schema_id]=s.[schema_id]\nGROUPBY\ns.[name]\n,t.[name];\nGO\n\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/vTableSizes')]",
"type":"Microsoft.Synapse/workspaces/sqlscripts",
"apiVersion":"2019-06-01-preview",
"properties":{
"folder":{
"name":"DWDatabaseObjects/Views"
},
"content":{
"query":"/******Object:View[dbo].[vTableSizes]ScriptDate:6/29/20218:39:21AM******/\nSETANSI_NULLSON\nGO\n\nSETQUOTED_IDENTIFIERON\nGO\n\nCREATEVIEW[dbo].[vTableSizes]\nASWITHbase\nAS\n(\nSELECT\nGETDATE()AS[execution_time]\n,DB_NAME()AS[database_name]\n,s.nameAS[schema_name]\n,t.nameAS[table_name]\n,QUOTENAME(s.name)+'.'+QUOTENAME(t.name)AS[two_part_name]\n,nt.[name]AS[node_table_name]\n,ROW_NUMBER()OVER(PARTITIONBYnt.[name]ORDERBY(SELECTNULL))AS[node_table_name_seq]\n,tp.[distribution_policy_desc]AS[distribution_policy_name]\n,c.[name]AS[distribution_column]\n,nt.[distribution_id]AS[distribution_id]\n,i.[type]AS[index_type]\n,i.[type_desc]AS[index_type_desc]\n,nt.[pdw_node_id]AS[pdw_node_id]\n,pn.[type]AS[pdw_node_type]\n,pn.[name]AS[pdw_node_name]\n,di.nameAS[dist_name]\n,di.positionAS[dist_position]\n,nps.[partition_number]AS[partition_nmbr]\n,nps.[reserved_page_count]AS[reserved_space_page_count]\n,nps.[reserved_page_count]-nps.[used_page_count]AS[unused_space_page_count]\n,nps.[in_row_data_page_count]\n+nps.[row_overflow_used_page_count]\n+nps.[lob_used_page_count]AS[data_space_page_count]\n,nps.[reserved_page_count]\n-(nps.[reserved_page_count]-nps.[used_page_count])\n-([in_row_data_page_count]\n+[row_overflow_used_page_count]+[lob_used_page_count])AS[index_space_page_count]\n,nps.[row_count]AS[row_count]\nfrom\nsys.schemass\nINNERJOINsys.tablest\nONs.[schema_id]=t.[schema_id]\nINNERJOINsys.indexesi\nONt.[object_id]=i.[object_id]\nANDi.[index_id]<=1\nINNERJOINsys.pdw_table_distribution_propertiestp\nONt.[object_id]=tp.[object_id]\nINNERJOINsys.pdw_table_mappingstm\nONt.[object_id]=tm.[object_id]\nINNERJOINsys.pdw_nodes_tablesnt\nONtm.[physical_name]=nt.[name]\nINNERJOINsys.dm_pdw_nodespn\nONnt.[pdw_node_id]=pn.[pdw_node_id]\nINNERJOINsys.pdw_distributionsdi\nONnt.[distribution_id]=di.[distribution_id]\nINNERJOINsys.dm_pdw_nodes_db_partition_statsnps\nONnt.[object_id]=nps.[object_id]\nANDnt.[pdw_node_id]=nps.[pdw_node_id]\nANDnt.[distribution_id]=nps.[distribution_id]\nLEFTOUTERJOIN(select*fromsys.pdw_column_distribution_propertieswheredistribution_ordinal=1)cdp\nONt.[object_id]=cdp.[object_id]\nLEFTOUTERJOINsys.columnsc\nONcdp.[object_id]=c.[object_id]\nANDcdp.[column_id]=c.[column_id]\nWHEREpn.[type]='COMPUTE'\n)\n,size\nAS\n(\nSELECT\n[execution_time]\n,[database_name]\n,[schema_name]\n,[table_name]\n,[two_part_name]\n,[node_table_name]\n,[node_table_name_seq]\n,[distribution_policy_name]\n,[distribution_column]\n,[distribution_id]\n,[index_type]\n,[index_type_desc]\n,[pdw_node_id]\n,[pdw_node_type]\n,[pdw_node_name]\n,[dist_name]\n,[dist_position]\n,[partition_nmbr]\n,[reserved_space_page_count]\n,[unused_space_page_count]\n,[data_space_page_count]\n,[index_space_page_count]\n,[row_count]\n,([reserved_space_page_count]*8.0)AS[reserved_space_KB]\n,([reserved_space_page_count]*8.0)/1000AS[reserved_space_MB]\n,([reserved_space_page_count]*8.0)/1000000AS[reserved_space_GB]\n,([reserved_space_page_count]*8.0)/1000000000AS[reserved_space_TB]\n,([unused_space_page_count]*8.0)AS[unused_space_KB]\n,([unused_space_page_count]*8.0)/1000AS[unused_space_MB]\n,([unused_space_page_count]*8.0)/1000000AS[unused_space_GB]\n,([unused_space_page_count]*8.0)/1000000000AS[unused_space_TB]\n,([data_space_page_count]*8.0)AS[data_space_KB]\n,([data_space_page_count]*8.0)/1000AS[data_space_MB]\n,([data_space_page_count]*8.0)/1000000AS[data_space_GB]\n,([data_space_page_count]*8.0)/1000000000AS[data_space_TB]\n,([index_space_page_count]*8.0)AS[index_space_KB]\n,([index_space_page_count]*8.0)/1000AS[index_space_MB]\n,([index_space_page_count]*8.0)/1000000AS[index_space_GB]\n,([index_space_page_count]*8.0)/1000000000AS[index_space_TB]\nFROMbase\n)\nSELECT*\nFROMsize;\nGO\n\n\n",
"metadata":{
"language":"sql"
},
"currentConnection":{
"databaseName":"master",
"poolName":"Built-in"
},
"resultLimit":5000
},
"type":"SqlQuery"
},
"dependsOn":[]
},
{
"name":"[concat(parameters('workspaceName'),'/eddydevdw')]",
"type":"Microsoft.Synapse/workspaces/sqlPools",
"apiVersion":"2019-06-01-preview",
"properties":{
"collation":"SQL_Latin1_General_CP1_CI_AS",
"maxSizeBytes":263882790666240,
"restorePointInTime":"0001-01-01T00:00:00",
"annotations":[]
},
"dependsOn":[],
"location":"eastus2"
}
]
}